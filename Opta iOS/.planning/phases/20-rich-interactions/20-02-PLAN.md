# Plan 20-02: Design System Evolution

**Phase:** 20 - Rich Interactions
**Feature:** Premium Design System Updates
**Scope:** Small-Medium (1-2 days)
**Dependencies:** 20-00 (WebGL Foundation), 20-01 (Animation System)

---

## Summary

Update DESIGN_SYSTEM.md and core CSS with premium patterns from Gemini research. Implements #09090b base background (avoids OLED black smear), adds neon accent tokens, documents glass effect layers, adds animation preset documentation, and creates WebGL component guidelines.

---

## Why This Matters

- **OLED optimization** - True black causes "black smear" on scroll
- **Unified aesthetic** - All components use same visual language
- **Developer guidance** - Clear rules for using premium effects
- **Consistency** - Neon used only for active states, not everywhere
- **Documentation** - New team members understand system immediately

---

## Gemini Research Context

From Premium App UI/UX Investigation:
- "Avoid true black (#000000) - causes OLED 'black smear' on scroll"
- "Use deep grey-purple (#09090b or #121212) keeps pixels active"
- "Neon for active states only - cursor, current line, active borders"
- "'Pastel-neon' for content - hue matches brand, adjusted for WCAG 4.5:1"
- "Glass Implementation Stack: Backdrop → Blur → Noise → Specular"

---

## Implementation Tasks

### Task 1: Update base background color
**File:** `src/index.css`

**Actions:**
1. Change `--background` from current value to `#09090b`
2. Update any hardcoded dark backgrounds
3. Verify no true black (#000000) anywhere
4. Test for OLED black smear (if testable)

**CSS changes:**
```css
:root {
  /* Base colors - updated for OLED optimization */
  --background: 5 5 11; /* #09090b - deep grey-purple, avoids black smear */
  --foreground: 250 250 250;

  /* Card should be slightly lighter than background */
  --card: 12 12 18; /* Subtle elevation from background */
  --card-foreground: 250 250 250;
}
```

**Verification:** Background is #09090b, no true black in codebase

---

### Task 2: Add neon accent color tokens
**File:** `src/index.css`, `tailwind.config.js`

**Actions:**
1. Add neon color variants (neon-purple, neon-blue, neon-green)
2. Add neon-glow utility for text/borders
3. Document when to use neon vs standard colors
4. Ensure WCAG 4.5:1 contrast for neon text

**CSS additions:**
```css
:root {
  /* Neon accents - USE SPARINGLY (active states only) */
  --neon-purple: 139 92 246;  /* #8b5cf6 - primary neon */
  --neon-blue: 59 130 246;    /* #3b82f6 - secondary neon */
  --neon-green: 34 197 94;    /* #22c55e - success neon */
  --neon-amber: 245 158 11;   /* #f59e0b - warning neon */
  --neon-red: 239 68 68;      /* #ef4444 - danger neon */

  /* Neon glow intensities */
  --neon-glow-sm: 0 0 10px;
  --neon-glow-md: 0 0 20px;
  --neon-glow-lg: 0 0 30px;
}

/* Neon glow utilities */
.neon-glow {
  text-shadow: var(--neon-glow-sm) rgb(var(--neon-purple) / 0.5);
}

.neon-glow-border {
  box-shadow: var(--neon-glow-md) rgb(var(--neon-purple) / 0.3);
}

/* Active state neon (per Gemini: "neon for active states only") */
.neon-active {
  box-shadow:
    0 0 0 1px rgb(var(--neon-purple)),
    var(--neon-glow-md) rgb(var(--neon-purple) / 0.4);
}
```

**Tailwind config additions:**
```javascript
// tailwind.config.js
theme: {
  extend: {
    colors: {
      neon: {
        purple: 'rgb(var(--neon-purple) / <alpha-value>)',
        blue: 'rgb(var(--neon-blue) / <alpha-value>)',
        green: 'rgb(var(--neon-green) / <alpha-value>)',
        amber: 'rgb(var(--neon-amber) / <alpha-value>)',
        red: 'rgb(var(--neon-red) / <alpha-value>)',
      },
    },
  },
}
```

**Verification:** Neon colors available in Tailwind, glow utilities work

---

### Task 3: Document glass effect layers
**File:** `DESIGN_SYSTEM.md`

**Actions:**
1. Add "Glass Effects" section with 4-layer explanation
2. Document when to use glass vs glass-subtle vs glass-strong
3. Add code examples for each glass variant
4. Reference WebGL GlassPanel from 20-00

**Documentation content:**
```markdown
## Glass Effects

Opta uses a 4-layer glass implementation based on optical simulation:

### Glass Layers (Bottom to Top)
1. **Backdrop** - Content visible behind the glass element
2. **Blur Pass** - Gaussian blur (12px default, animatable 0-20px)
3. **Noise Overlay** - Subtle grain prevents color banding (Soft Light blend)
4. **Specular Highlight** - Simulated light reflection (rotating light source)

### CSS Glass Classes

| Class | Use Case | Blur | Border |
|-------|----------|------|--------|
| `.glass-subtle` | Cards, secondary containers | 8px | 10% white |
| `.glass` | Primary containers, modals | 12px | 15% white |
| `.glass-strong` | Hero elements, overlays | 20px | 20% white |

### WebGL Glass (Premium)
For full optical simulation with animated specular highlights, use the
`<GlassPanel>` component from `@/components/effects`:

\`\`\`tsx
import { GlassPanel } from '@/components/effects';

<GlassPanel blurAmount={12} specularEnabled animateSpecular>
  <YourContent />
</GlassPanel>
\`\`\`
```

**Verification:** Documentation clear, examples work

---

### Task 4: Add animation preset documentation
**File:** `DESIGN_SYSTEM.md`

**Actions:**
1. Add "Animation" section with spring presets
2. Document when to use each preset
3. Add reduced motion guidelines
4. Reference Framer Motion vs WebGL usage

**Documentation content:**
```markdown
## Animation

### Spring Presets

All animations use physics-based springs. Never use duration-based timing.

| Preset | Stiffness | Damping | Use Case |
|--------|-----------|---------|----------|
| `snappy` | 500 | 30 | Buttons, toggles, small elements |
| `bouncy` | 300 | 20 | Modals, score reveals, celebrations |
| `smooth` | 200 | 25 | Page transitions, content updates |
| `gentle` | 150 | 20 | Hover states, micro-interactions |

### Usage

\`\`\`tsx
import { springs } from '@/lib/animation/springs';

<motion.div
  animate={{ scale: 1 }}
  transition={springs.snappy}
/>
\`\`\`

### Animation Patterns

| Pattern | Implementation | Notes |
|---------|---------------|-------|
| **Staggered Entry** | `<StaggeredList>` | 20ms delay between items |
| **Blur-Back** | `<BlurBackProvider>` | Scale 0.95 + blur on overlay |
| **Shared Element** | `useSharedElement()` | Morphs between routes |
| **Micro-interaction** | `useMicroInteraction()` | Subtle hover position shift |

### Reduced Motion

ALWAYS respect `prefers-reduced-motion`:

\`\`\`tsx
import { useReducedMotion } from '@/hooks/useReducedMotion';

const prefersReducedMotion = useReducedMotion();
const transition = prefersReducedMotion ? { duration: 0 } : springs.smooth;
\`\`\`
```

**Verification:** Documentation accurate, matches implementation from 20-01

---

### Task 5: Add WebGL component guidelines
**File:** `DESIGN_SYSTEM.md`

**Actions:**
1. Add "WebGL Effects" section
2. Document when to use CSS vs WebGL
3. Add performance guidelines
4. List available WebGL components

**Documentation content:**
```markdown
## WebGL Effects

Premium visual effects use WebGL shaders via Three.js / react-three-fiber.

### When to Use WebGL vs CSS

| Effect | CSS | WebGL | Reason |
|--------|-----|-------|--------|
| Simple blur | ✅ | - | `backdrop-filter` sufficient |
| Animated specular | - | ✅ | Rotating light source needs shader |
| Static border | ✅ | - | CSS border-image works |
| Traveling neon border | - | ✅ | SweepGradient needs shader |
| Basic glow | ✅ | - | `box-shadow` sufficient |
| Halation (exponential glow) | - | ✅ | Requires distance field shader |

### WebGL Components

| Component | Purpose | Import |
|-----------|---------|--------|
| `<GlassPanel>` | Full optical glass simulation | `@/components/effects` |
| `<NeonBorder>` | Traveling light border effect | `@/components/effects` |

### Performance Guidelines

1. **Limit WebGL usage** - One or two WebGL elements per view maximum
2. **Test on integrated graphics** - Must maintain 60fps minimum
3. **Provide CSS fallback** - Detect WebGL failure, fall back to CSS glass
4. **Monitor memory** - WebGL textures can leak, test on unmount

### Fallback Pattern

\`\`\`tsx
const [webglSupported, setWebglSupported] = useState(true);

useEffect(() => {
  // Check WebGL support
  const canvas = document.createElement('canvas');
  const gl = canvas.getContext('webgl2') || canvas.getContext('webgl');
  setWebglSupported(!!gl);
}, []);

return webglSupported
  ? <GlassPanel>{children}</GlassPanel>
  : <div className="glass">{children}</div>;
\`\`\`
```

**Verification:** Guidelines clear, fallback pattern documented

---

### Task 6: Update existing glass CSS classes
**File:** `src/index.css`

**Actions:**
1. Update `.glass-subtle`, `.glass`, `.glass-strong` classes
2. Add noise texture overlay (inline SVG data URI)
3. Ensure progressive blur at edges
4. Add specular-like highlight gradient

**CSS updates:**
```css
/* Enhanced glass effects with noise and specular simulation */
.glass-subtle {
  background: linear-gradient(
    135deg,
    rgb(var(--card) / 0.4) 0%,
    rgb(var(--card) / 0.2) 100%
  );
  backdrop-filter: blur(8px) saturate(150%);
  -webkit-backdrop-filter: blur(8px) saturate(150%);
  border: 1px solid rgb(255 255 255 / 0.1);

  /* Noise overlay for anti-banding */
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.02'/%3E%3C/svg%3E");
}

.glass {
  background: linear-gradient(
    135deg,
    rgb(var(--card) / 0.5) 0%,
    rgb(var(--card) / 0.3) 100%
  );
  backdrop-filter: blur(12px) saturate(160%);
  -webkit-backdrop-filter: blur(12px) saturate(160%);
  border: 1px solid rgb(255 255 255 / 0.15);

  /* Specular-like top highlight */
  box-shadow:
    inset 0 1px 0 0 rgb(255 255 255 / 0.1),
    0 4px 24px -4px rgb(0 0 0 / 0.3);

  /* Noise overlay */
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.03'/%3E%3C/svg%3E");
}

.glass-strong {
  background: linear-gradient(
    135deg,
    rgb(var(--card) / 0.6) 0%,
    rgb(var(--card) / 0.4) 100%
  );
  backdrop-filter: blur(20px) saturate(180%);
  -webkit-backdrop-filter: blur(20px) saturate(180%);
  border: 1px solid rgb(255 255 255 / 0.2);

  /* Stronger specular highlight */
  box-shadow:
    inset 0 1px 0 0 rgb(255 255 255 / 0.15),
    0 8px 32px -8px rgb(0 0 0 / 0.4);

  /* Noise overlay */
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.04'/%3E%3C/svg%3E");
}
```

**Verification:** Glass classes have noise texture and specular highlight

---

### Task 7: Update DESIGN_SYSTEM.md header and structure
**File:** `DESIGN_SYSTEM.md`

**Actions:**
1. Add version note (v2.0 - Premium Enhancement)
2. Reorganize sections for new content
3. Add changelog section
4. Cross-reference Gemini research source

**Header update:**
```markdown
# Opta Design System v2.0

**Premium Enhancement Update** - Based on Gemini "Neon Luminal Glassmorphism" research

## What's New in v2.0
- #09090b base background (OLED optimized)
- 4-layer glass effect system
- Physics-based animation presets
- WebGL shader components
- Neon accent guidelines

## Table of Contents
1. [Colors](#colors)
2. [Typography](#typography)
3. [Glass Effects](#glass-effects) ← New
4. [Animation](#animation) ← New
5. [WebGL Effects](#webgl-effects) ← New
6. [Components](#components)
7. [Icons](#icons)
8. [Accessibility](#accessibility)
```

**Verification:** Design system document is comprehensive and organized

---

### Task 8: Verify and test all updates
**File:** Various

**Actions:**
1. Run `npm run build` to verify no CSS errors
2. Visual inspection of glass effects
3. Verify neon colors render correctly
4. Test on both light and dark backgrounds (if applicable)
5. Confirm no regressions in existing components

**Verification:** Build passes, visual inspection confirms premium look

---

## Verification Checklist

- [ ] Background color is #09090b (not true black)
- [ ] No #000000 anywhere in codebase
- [ ] Neon color tokens available in Tailwind
- [ ] Neon glow utilities work correctly
- [ ] Glass classes include noise texture
- [ ] Glass classes include specular highlight
- [ ] DESIGN_SYSTEM.md has Glass Effects section
- [ ] DESIGN_SYSTEM.md has Animation section
- [ ] DESIGN_SYSTEM.md has WebGL Effects section
- [ ] Spring preset table is accurate
- [ ] WebGL vs CSS decision table is clear
- [ ] Fallback pattern is documented
- [ ] `npm run build` passes with no errors

---

## Files Created/Modified

| File | Action |
|------|--------|
| `src/index.css` | Update colors, glass classes |
| `tailwind.config.js` | Add neon color tokens |
| `DESIGN_SYSTEM.md` | Major update with new sections |

---

## Research Reference

From Gemini Premium App UI/UX Investigation:
- "Avoid true black (#000000) - causes OLED 'black smear' on scroll"
- "Use deep grey-purple (#09090b or #121212)"
- "Neon for active states only"
- "Glass Implementation Stack: Backdrop → Blur → Noise → Specular"
- "Noise grain prevents color banding on OLED"

---

*Plan created: 2026-01-17*
*Ready for execution: yes*
*Foundation plan - execute after 20-00, 20-01*
