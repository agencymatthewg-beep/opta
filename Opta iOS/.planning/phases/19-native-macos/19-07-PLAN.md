---
phase: 19-native-macos
plan: 07
type: execute
wave: 4
depends_on: ["19-03", "19-04", "19-05"]
files_modified: [OptaNative/Views/MainWindow/]
autonomous: false
---

<objective>
Create main window dashboard with hardware monitoring and process management (Stealth Mode).

Purpose: Provide full Opta experience with detailed telemetry visualization and process control matching Tauri version functionality.
Output: Complete dashboard with telemetry cards, charts, and process list.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
@~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/19-native-macos/19-RESEARCH.md
@.planning/phases/19-native-macos/19-03-SUMMARY.md
@.planning/phases/19-native-macos/19-04-SUMMARY.md
@.planning/phases/19-native-macos/19-05-SUMMARY.md
@DESIGN_SYSTEM.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create telemetry dashboard cards</name>
  <files>OptaNative/Views/MainWindow/DashboardView.swift, OptaNative/Views/MainWindow/TelemetryCard.swift</files>
  <action>
Create dashboard with telemetry cards using glass styling:

```swift
struct DashboardView: View {
    @Environment(TelemetryViewModel.self) var telemetry

    var body: some View {
        ZStack {
            Color.optaBackground

            ScrollView {
                VStack(spacing: 16) {
                    // Hardware overview row
                    HStack(spacing: 16) {
                        TelemetryCard(
                            title: "CPU",
                            value: "\(Int(telemetry.cpuTemperature))°C",
                            usage: telemetry.cpuUsage,
                            icon: "cpu"
                        )

                        TelemetryCard(
                            title: "GPU",
                            value: "\(Int(telemetry.gpuTemperature))°C",
                            usage: nil,
                            icon: "rectangle.stack.fill"
                        )

                        TelemetryCard(
                            title: "Memory",
                            value: String(format: "%.1f/%.1fGB", telemetry.memoryUsedGB, telemetry.memoryTotalGB),
                            usage: telemetry.memoryPercent,
                            icon: "memorychip"
                        )
                    }

                    // Process list section
                    ProcessListSection()
                }
                .padding()
            }
        }
    }
}

struct TelemetryCard: View {
    let title: String
    let value: String
    let usage: Double?
    let icon: String

    var body: some View {
        GlassCard {
            VStack(alignment: .leading, spacing: 8) {
                HStack {
                    Image(systemName: icon)
                        .foregroundStyle(Color.optaPrimary)
                    Text(title)
                        .font(.headline)
                }

                Text(value)
                    .font(.system(size: 28, weight: .semibold))

                if let usage = usage {
                    ProgressView(value: usage, total: 100)
                        .tint(progressColor(for: usage))
                }
            }
            .padding()
        }
    }
}
```

Use GlassCard from 19-03.
Color-code progress bars (green < 60%, yellow < 80%, red >= 80%).
  </action>
  <verify>Build succeeds, DashboardView renders with cards</verify>
  <done>Telemetry cards show live data with glass styling</done>
</task>

<task type="auto">
  <name>Task 2: Create process list with Stealth Mode</name>
  <files>OptaNative/Views/MainWindow/ProcessListSection.swift, OptaNative/ViewModels/ProcessViewModel.swift</files>
  <action>
Create process list with filtering and termination:

```swift
@Observable
class ProcessViewModel {
    var processes: [ProcessInfo] = []
    var filter: ProcessFilter = .all
    var searchText: String = ""

    private let processService = ProcessService()
    private let helperManager = HelperManager()

    enum ProcessFilter: String, CaseIterable {
        case all = "All"
        case user = "User Apps"
        case bloatware = "Bloatware"
    }

    func refreshProcesses() {
        processes = processService.getRunningProcesses()
            .filter { matchesFilter($0) && matchesSearch($0) }
    }

    func terminateProcess(_ process: ProcessInfo) async {
        do {
            _ = try await helperManager.terminateProcess(pid: process.id)
            refreshProcesses()
        } catch {
            // Show error
        }
    }
}

struct ProcessListSection: View {
    @State private var viewModel = ProcessViewModel()

    var body: some View {
        GlassCard {
            VStack(alignment: .leading, spacing: 12) {
                HStack {
                    Text("Processes")
                        .font(.headline)
                    Spacer()

                    // Filter picker
                    Picker("Filter", selection: $viewModel.filter) {
                        ForEach(ProcessViewModel.ProcessFilter.allCases, id: \.self) { filter in
                            Text(filter.rawValue).tag(filter)
                        }
                    }
                    .pickerStyle(.segmented)
                    .frame(width: 200)
                }

                // Search field
                TextField("Search processes...", text: $viewModel.searchText)
                    .textFieldStyle(.roundedBorder)

                // Process list
                ForEach(viewModel.processes) { process in
                    ProcessRow(process: process) {
                        Task { await viewModel.terminateProcess(process) }
                    }
                }
            }
            .padding()
        }
        .onAppear { viewModel.refreshProcesses() }
    }
}
```

Connect to HelperManager for privileged termination.
Show confirmation dialog before terminating system processes.
  </action>
  <verify>Process list renders, filter/search work</verify>
  <done>Process management UI functional with termination</done>
</task>

<task type="auto">
  <name>Task 3: Create MainWindow container</name>
  <files>OptaNative/Views/MainWindow/MainWindow.swift</files>
  <action>
Create MainWindow as the root view for WindowGroup:

```swift
struct MainWindow: View {
    @Environment(TelemetryViewModel.self) var telemetry
    @State private var selectedTab: Tab = .dashboard

    enum Tab: String, CaseIterable {
        case dashboard = "Dashboard"
        case processes = "Processes"
        case settings = "Settings"
    }

    var body: some View {
        ZStack {
            Color.optaBackground
                .ignoresSafeArea()

            VStack(spacing: 0) {
                // Toolbar area with title and chip info
                HStack {
                    Text("Opta Native")
                        .font(.title2)
                        .fontWeight(.semibold)

                    Spacer()

                    Text(telemetry.chipName)
                        .foregroundStyle(.secondary)
                }
                .padding()
                .background(GlassBackground(material: .headerView))

                // Tab content
                TabView(selection: $selectedTab) {
                    DashboardView()
                        .tabItem { Label("Dashboard", systemImage: "gauge.high") }
                        .tag(Tab.dashboard)

                    ProcessListSection()
                        .tabItem { Label("Processes", systemImage: "list.bullet") }
                        .tag(Tab.processes)

                    SettingsView()
                        .tabItem { Label("Settings", systemImage: "gearshape") }
                        .tag(Tab.settings)
                }
            }
        }
        .task {
            await telemetry.startMonitoring()
        }
    }
}
```

Use native macOS TabView for navigation.
Start monitoring when window appears.
Apply glass header for consistent styling.
  </action>
  <verify>MainWindow renders with tabs, navigation works</verify>
  <done>Main window complete with tabbed navigation</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete main window dashboard with hardware monitoring and process management</what-built>
  <how-to-verify>
    1. Run: Build and run OptaNative
    2. Click: Menu bar icon → "Open Dashboard"
    3. Verify: Main window opens with Dashboard tab
    4. Check: CPU/GPU/Memory cards show live data
    5. Check: Glass effects on all cards
    6. Navigate: Click "Processes" tab
    7. Check: Process list loads with running apps
    8. Test: Search filters processes correctly
    9. Test: Filter buttons (All/User/Bloatware) work
    10. Test: Terminate a non-essential process (e.g., Calculator)
    11. Verify: Process disappears from list
    12. Navigate: Settings tab exists (can be placeholder)
  </how-to-verify>
  <resume-signal>Type "approved" if dashboard and process management work, or describe issues</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `xcodebuild -scheme OptaNative build` succeeds
- [ ] Dashboard shows live telemetry
- [ ] Glass styling consistent across all cards
- [ ] Process list loads and filters correctly
- [ ] Process termination works (via helper)
- [ ] Tab navigation works smoothly
</verification>

<success_criteria>
- All tasks completed
- Full dashboard matching Tauri version functionality
- Process management operational
- Glass aesthetic maintained throughout
- Native macOS feel achieved
</success_criteria>

<output>
After completion, create `.planning/phases/19-native-macos/19-07-SUMMARY.md`
</output>
