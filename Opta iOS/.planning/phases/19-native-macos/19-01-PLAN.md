---
phase: 19-native-macos
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [OptaNative/, OptaNative.xcodeproj, Package.swift]
autonomous: true
---

<objective>
Create Xcode project foundation for native macOS Opta app using Swift and SwiftUI.

Purpose: Establish the base project structure that all other plans build upon. This is a completely new native macOS app, separate from the Tauri version.
Output: Working Xcode project with proper structure, dependencies, and entitlements for IOKit access.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/19-native-macos/19-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Xcode project with SwiftUI template</name>
  <files>OptaNative/, OptaNative.xcodeproj</files>
  <action>
Create new Xcode project in project root named "OptaNative" using:
- Swift language
- SwiftUI lifecycle
- macOS 14.0+ deployment target
- Hardened Runtime enabled
- Code signing for Developer ID (not App Store - IOKit won't work in sandbox)

Project structure following Stats pattern:
```
OptaNative/
├── OptaNative/
│   ├── App.swift           # @main entry point
│   ├── Views/
│   │   ├── MainWindow/
│   │   ├── MenuBar/
│   │   └── Components/
│   ├── ViewModels/
│   ├── Services/
│   └── Utilities/
├── Modules/                # Feature modules (added later)
├── SMC/                    # SMC bridge (added later)
├── Helper/                 # Privileged helper (added later)
└── Shared/                 # Shared types
```

CRITICAL: Do NOT enable App Sandbox - IOKit requires distribution outside App Store.
Use `xcodebuild` commands from terminal to create and verify project.
  </action>
  <verify>xcodebuild -project OptaNative.xcodeproj -scheme OptaNative -configuration Debug build</verify>
  <done>Xcode project builds successfully with proper structure</done>
</task>

<task type="auto">
  <name>Task 2: Add Swift Package dependencies</name>
  <files>OptaNative.xcodeproj, Package.swift</files>
  <action>
Add Swift Package Manager dependencies for:

1. Blessed (helper installation): https://github.com/trilemma-dev/Blessed from: "0.5.0"
2. SecureXPC (helper communication): https://github.com/trilemma-dev/SecureXPC from: "1.0.0"
3. VisualEffects (glass effects): https://github.com/twostraws/VisualEffects from: "1.0.0"

Add via Xcode's Package Dependencies or create Package.swift for SPM resolution.

These are the "don't hand-roll" libraries from research - use them instead of custom implementations.
  </action>
  <verify>xcodebuild -project OptaNative.xcodeproj -scheme OptaNative -resolvePackageDependencies</verify>
  <done>All three packages resolve and import successfully</done>
</task>

<task type="auto">
  <name>Task 3: Create basic App.swift with MenuBarExtra</name>
  <files>OptaNative/App.swift</files>
  <action>
Create minimal App.swift with:
- @main struct OptaNativeApp: App
- WindowGroup for main window (hidden title bar, default size 400x600)
- MenuBarExtra for menu bar presence (systemImage: "bolt.fill", style: .window)
- Placeholder ContentView showing "Opta Native" text

Use @Observable pattern (macOS 14+) for state, not ObservableObject.
Import SwiftUI and set up scene structure per research examples.
  </action>
  <verify>Build succeeds, app launches with menu bar icon and window</verify>
  <done>App launches, shows in menu bar, main window opens</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `xcodebuild -scheme OptaNative build` succeeds
- [ ] App launches from Xcode
- [ ] Menu bar icon appears (bolt.fill)
- [ ] Main window opens with placeholder content
- [ ] Project structure matches specification
- [ ] All three SPM dependencies resolve
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Project builds and runs on macOS 14+
- Foundation ready for SMC, UI, and Helper plans to build upon
</success_criteria>

<output>
After completion, create `.planning/phases/19-native-macos/19-01-SUMMARY.md`
</output>
