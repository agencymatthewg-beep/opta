---
phase: 19-native-macos
plan: 06
type: execute
wave: 4
depends_on: ["19-03", "19-05"]
files_modified: [OptaNative/Views/MenuBar/, OptaNative/App.swift]
autonomous: false
---

<objective>
Create menu bar integration with quick stats popup using native SwiftUI MenuBarExtra.

Purpose: Provide always-available system monitoring and quick access to Opta features from the menu bar - a key native macOS UX pattern.
Output: Menu bar icon with dropdown showing live telemetry.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
@~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/19-native-macos/19-RESEARCH.md
@.planning/phases/19-native-macos/19-03-SUMMARY.md
@.planning/phases/19-native-macos/19-05-SUMMARY.md
@DESIGN_SYSTEM.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create MenuBarView with live stats</name>
  <files>OptaNative/Views/MenuBar/MenuBarView.swift, OptaNative/Views/MenuBar/QuickStatRow.swift</files>
  <action>
Create MenuBarView showing live telemetry in glass-styled popup:

```swift
import SwiftUI

struct MenuBarView: View {
    @Environment(TelemetryViewModel.self) var telemetry

    var body: some View {
        ZStack {
            GlassBackground(material: .hudWindow)

            VStack(spacing: 12) {
                // Header
                HStack {
                    Text("Opta")
                        .font(.headline)
                        .foregroundStyle(Color.optaPrimary)
                    Spacer()
                    Text(telemetry.chipName)
                        .font(.caption)
                        .foregroundStyle(.secondary)
                }

                Divider()

                // Quick stats
                QuickStatRow(label: "CPU", value: "\(Int(telemetry.cpuTemperature))°C", usage: telemetry.cpuUsage)
                QuickStatRow(label: "GPU", value: "\(Int(telemetry.gpuTemperature))°C", usage: nil)
                QuickStatRow(label: "RAM", value: String(format: "%.1fGB", telemetry.memoryUsedGB), usage: telemetry.memoryPercent)

                Divider()

                // Actions
                Button("Open Dashboard") {
                    NSApp.activate(ignoringOtherApps: true)
                }
                .buttonStyle(.plain)

                Button("Quit Opta") {
                    NSApp.terminate(nil)
                }
                .buttonStyle(.plain)
            }
            .padding()
        }
        .frame(width: 280)
    }
}
```

Create QuickStatRow component with label, value, and optional progress bar.
Use glass styling from 19-03, colors from design system.
  </action>
  <verify>Build succeeds, MenuBarView renders in preview</verify>
  <done>MenuBarView shows live stats with glass styling</done>
</task>

<task type="auto">
  <name>Task 2: Configure MenuBarExtra in App.swift</name>
  <files>OptaNative/App.swift</files>
  <action>
Update App.swift to use MenuBarExtra with .window style:

```swift
@main
struct OptaNativeApp: App {
    @State private var telemetry = TelemetryViewModel()

    var body: some Scene {
        WindowGroup {
            MainWindow()
                .environment(telemetry)
        }
        .windowStyle(.hiddenTitleBar)
        .defaultSize(width: 400, height: 600)

        MenuBarExtra {
            MenuBarView()
                .environment(telemetry)
        } label: {
            // Dynamic icon based on temp
            Image(systemName: menuBarIcon)
        }
        .menuBarExtraStyle(.window)
    }

    var menuBarIcon: String {
        if telemetry.cpuTemperature > 80 {
            return "flame.fill"  // Hot
        } else if telemetry.isMonitoring {
            return "bolt.fill"   // Normal
        } else {
            return "bolt"        // Not monitoring
        }
    }
}
```

Use .menuBarExtraStyle(.window) for popup behavior (not menu).
Start telemetry monitoring on app launch.
Icon changes based on temperature (bolt.fill normal, flame.fill when hot).
  </action>
  <verify>App shows menu bar icon, clicking opens popup with live stats</verify>
  <done>Menu bar integration works with dynamic icon</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Menu bar integration with glass popup showing live telemetry</what-built>
  <how-to-verify>
    1. Run: Build and run OptaNative
    2. Verify: Icon appears in menu bar (bolt.fill)
    3. Click: Menu bar icon
    4. Verify: Glass popup appears with CPU/GPU/RAM stats
    5. Check: Stats update in real-time (watch temperatures change)
    6. Check: Glass effect shows desktop blur behind
    7. Check: "Open Dashboard" and "Quit" buttons work
    8. Test: Close popup by clicking elsewhere
    9. Verify: Icon changes to flame when CPU hot (stress test if needed)
  </how-to-verify>
  <resume-signal>Type "approved" if menu bar works correctly, or describe issues</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `xcodebuild -scheme OptaNative build` succeeds
- [ ] Menu bar icon appears on launch
- [ ] Clicking icon opens glass popup
- [ ] Telemetry updates live in popup
- [ ] Open Dashboard activates main window
- [ ] Quit terminates app cleanly
</verification>

<success_criteria>
- All tasks completed
- Menu bar UX matches native macOS patterns
- Glass styling consistent with Opta design
- Live telemetry visible at a glance
- User verified visual quality
</success_criteria>

<output>
After completion, create `.planning/phases/19-native-macos/19-06-SUMMARY.md`
</output>
