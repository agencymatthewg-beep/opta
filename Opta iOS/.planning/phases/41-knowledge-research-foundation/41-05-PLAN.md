# Plan 41-05: Apple Silicon Storage Optimization Research

**Phase:** 41 - Knowledge Research Foundation
**Domain:** Storage & I/O Performance
**Focus:** Apple Silicon storage architecture mastery

---

## Metadata

```yaml
plan_id: 41-05
title: Apple Silicon Storage Optimization Research
estimated_effort: research
wave: 1
autonomous: true
dependencies: []
outputs:
  - .planning/research/prompts/41-05-storage-optimization.md
  - .planning/research/templates/storage-knowledge-template.md
```

---

## Objective

Create optimal Gemini Deep Research prompts that will produce comprehensive storage and I/O knowledge documents for Apple Silicon. Focus on how storage speed affects game loading, streaming, and when storage becomes a bottleneck.

---

## Tasks

### Task 1: Craft Storage Optimization Deep Research Prompt

**Goal:** Create a Gemini 2.5 Pro Deep Research prompt that explores Apple Silicon storage architecture with optimization focus.

**Prompt to Create:**

```markdown
# Gemini Deep Research Prompt: Apple Silicon Storage Optimization

## Research Mission

You are conducting deep research to build an optimization knowledge base for Apple Silicon storage performance. The goal is understanding exactly how storage speed affects gaming (loading times, streaming, stuttering), what the real-world bottlenecks are, and what can be optimized.

## Core Questions to Explore

### Architecture Fundamentals
1. **Apple Silicon SSD Architecture**
   - How is the SSD integrated into Apple Silicon?
   - NAND controller on the SoC
   - NVMe implementation specifics
   - Storage tiers by device (base vs upgraded capacity)

2. **Storage Speeds by Configuration**
   - Read/write speeds by device and capacity:
     - 256GB configurations (single NAND chip, reduced speed)
     - 512GB configurations
     - 1TB+ configurations
   - Sequential vs random read/write performance
   - Queue depth impact on performance

3. **APFS (Apple File System)**
   - How does APFS optimize for SSD?
   - Snapshot and cloning performance
   - Space sharing and compression
   - Encryption overhead (always-on T2/Secure Enclave)

### Performance Curves (CRITICAL)
4. **Game Loading Time Factors**
   - SSD speed vs game loading time relationship
   - Diminishing returns: When does faster storage stop helping?
   - Comparison: 256GB model vs 1TB+ model loading times
   - Loading time formula: [file size / read speed + decompression + init time]

5. **Asset Streaming Performance**
   - Open-world games: Texture streaming requirements
   - When does storage speed cause pop-in or stutter?
   - Minimum streaming speed for different game types
   - Comparison to console SSD requirements (PS5: 5.5 GB/s)

6. **Storage Capacity Impact**
   - 256GB performance penalty (measured)
   - TRIM and garbage collection impact when near full
   - Optimal free space % for performance
   - SSD wear and performance over time

### Optimization Levers
7. **Disk Space Management**
   - Free space impact on write performance
   - Recommended minimum free space for gaming
   - Large file handling (game installs 50-150GB)
   - Moving games between internal and external storage

8. **External Storage Options**
   - Thunderbolt 3/4 SSD performance (up to 2.8 GB/s)
   - USB-C SSD performance (up to 1 GB/s)
   - External SSD for game library: Pros and cons
   - Speed requirements for playable external gaming

9. **Caching and Prefetching**
   - macOS unified buffer cache behavior
   - Game asset preloading patterns
   - Memory as storage cache: How unified memory helps
   - Predictive loading in macOS

### Game-Specific Patterns
10. **Game Installation Patterns**
    - Typical game sizes: Indie (1-10GB), AA (20-50GB), AAA (50-150GB)
    - Installation I/O patterns
    - Decompression during install
    - Shader compilation and caching

11. **Runtime Storage Access**
    - Save game I/O patterns
    - Checkpoint and autosave performance
    - Config file access
    - Cloud save sync impact

12. **Translation Layer Storage**
    - Rosetta 2 cache requirements (~2GB per app)
    - CrossOver/Wine bottle sizes
    - Translation cache management
    - First-run vs cached run performance difference

### Cross-Domain Interactions
13. **Storage ↔ Memory**
    - Swap usage during gaming
    - SSD as virtual memory: Performance implications
    - Unified memory reducing storage pressure

14. **Storage ↔ CPU**
    - Decompression CPU usage (modern games use heavy compression)
    - Asset loading thread behavior
    - I/O wait impact on game performance

15. **Storage ↔ Thermal**
    - SSD thermal throttling on Apple Silicon?
    - Sustained write thermal behavior
    - Read-heavy vs write-heavy thermal patterns

## Output Format Requirements

Structure your findings as:

1. **Executive Summary** - Key storage optimization insights (1 page max)
2. **Speed Tables** - Storage speeds by device/capacity configuration
3. **Loading Time Formulas** - Predictive calculations
4. **Streaming Requirements** - Minimum speeds for different game types
5. **External Storage Guide** - When and how to use external drives
6. **Cross-Reference Matrix** - Storage interactions with Memory/CPU/Thermals

## Research Depth Guidance

- Focus on gaming-relevant I/O patterns, not general file operations
- Include real examples: "Game X loads in Y seconds on 256GB vs Z seconds on 1TB"
- Address the 256GB model specifically (common concern)
- Quantify external storage viability for gaming
- Flag uncertain data with confidence levels
- Consider both internal workflow and external game library scenarios
```

**Output:** `.planning/research/prompts/41-05-storage-optimization.md`

---

### Task 2: Create Storage Knowledge Document Template

**Goal:** Create a structured template for capturing storage research findings.

**Template Structure:**

```markdown
# Apple Silicon Storage Optimization Knowledge Base

## Document Metadata
- **Generated:** [Date]
- **Source:** Gemini 2.5 Pro Deep Research
- **Domain:** Storage & I/O Performance
- **Confidence:** [High/Medium/Low per section]

---

## 1. Hardware Specifications

### Internal SSD Speeds by Configuration

| Device | Capacity | Sequential Read | Sequential Write | Random Read | Random Write |
|--------|----------|-----------------|------------------|-------------|--------------|
| MacBook Air M1 | 256GB | X GB/s | X GB/s | X MB/s | X MB/s |
| MacBook Air M1 | 512GB | X GB/s | X GB/s | X MB/s | X MB/s |
| MacBook Air M2 | 256GB | X GB/s | X GB/s | X MB/s | X MB/s |
| MacBook Air M2 | 512GB+ | X GB/s | X GB/s | X MB/s | X MB/s |
| MacBook Pro M3 | 512GB | X GB/s | X GB/s | X MB/s | X MB/s |
| MacBook Pro M3 | 1TB+ | X GB/s | X GB/s | X MB/s | X MB/s |
| Mac Studio | 512GB | X GB/s | X GB/s | X MB/s | X MB/s |
| Mac Studio | 1TB+ | X GB/s | X GB/s | X MB/s | X MB/s |

### 256GB Configuration Penalty

| Device | 256GB Speed | 512GB+ Speed | Penalty |
|--------|-------------|--------------|---------|
| MacBook Air M1 | X GB/s | X GB/s | -X% |
| MacBook Air M2 | X GB/s | X GB/s | -X% |
| MacBook Pro M3 | N/A (512GB min) | X GB/s | N/A |

---

## 2. Game Loading Performance

### Loading Time Formula

```
Loading Time = (Compressed Size / Read Speed) + Decompression Time + Init Time

Where:
- Read Speed = Device-specific (see table above)
- Decompression Time ≈ Compressed Size * CPU Factor
- Init Time = Game-specific constant (typically 1-5 seconds)
```

### Loading Time Comparison

| Game Size | 256GB Model | 512GB Model | 1TB+ Model |
|-----------|-------------|-------------|------------|
| 10GB game | X seconds | X seconds | X seconds |
| 50GB game | X seconds | X seconds | X seconds |
| 100GB game | X seconds | X seconds | X seconds |

### Diminishing Returns Threshold

- Storage speed benefit ceiling: ~X GB/s (after this, decompression is bottleneck)
- Apple Silicon typically exceeds this threshold
- Primary loading bottleneck on Apple Silicon: [CPU decompression / game init / etc.]

---

## 3. Asset Streaming Requirements

### Minimum Speeds by Game Type

| Game Type | Min Streaming Speed | Comfortable Speed | Notes |
|-----------|---------------------|-------------------|-------|
| Linear FPS | X MB/s | X MB/s | Predictable loads |
| Open World | X MB/s | X MB/s | Constant streaming |
| Racing | X MB/s | X MB/s | High-speed traversal |
| MMO | X MB/s | X MB/s | Variable |

### Pop-In and Stutter Thresholds

| Symptom | Cause | Required Speed |
|---------|-------|----------------|
| Texture pop-in | Streaming too slow | X MB/s minimum |
| LOD pop | Distance streaming | X MB/s minimum |
| Loading stutter | Asset not ready | X MB/s or preload |

---

## 4. External Storage Performance

### Connection Speed Limits

| Connection | Theoretical Max | Practical Max | Gaming Viable? |
|------------|-----------------|---------------|----------------|
| Thunderbolt 4 | 40 Gbps (5 GB/s) | ~2.8 GB/s | Yes, excellent |
| Thunderbolt 3 | 40 Gbps (5 GB/s) | ~2.8 GB/s | Yes, excellent |
| USB 3.2 Gen 2x2 | 20 Gbps (2.5 GB/s) | ~1.5 GB/s | Yes, good |
| USB 3.2 Gen 2 | 10 Gbps (1.25 GB/s) | ~0.9 GB/s | Yes, acceptable |
| USB 3.2 Gen 1 | 5 Gbps (625 MB/s) | ~0.4 GB/s | Marginal |

### External Gaming Recommendations

| Use Case | Recommended | Notes |
|----------|-------------|-------|
| Primary game library | Thunderbolt SSD | Near-internal speeds |
| Overflow storage | USB 3.2 Gen 2 | Good for most games |
| Archive storage | USB HDD | For installed-but-inactive games |

---

## 5. Disk Space Management

### Free Space Performance Impact

| Free Space % | Write Performance | Gaming Impact |
|--------------|-------------------|---------------|
| >30% free | Optimal | None |
| 20-30% free | Near optimal | Minimal |
| 10-20% free | Degraded | May see longer saves |
| <10% free | Significantly degraded | Potential stuttering |

### Optimal Free Space Guidelines

| Total Capacity | Minimum Free | Recommended Free |
|----------------|--------------|------------------|
| 256GB | 50GB (20%) | 75GB (30%) |
| 512GB | 75GB (15%) | 150GB (30%) |
| 1TB | 100GB (10%) | 300GB (30%) |
| 2TB | 150GB (7.5%) | 500GB (25%) |

---

## 6. Translation Layer Storage

### Rosetta 2 Requirements

- Per-app cache size: ~X GB
- Total Rosetta cache typical: X-X GB
- First run vs cached run: X% loading improvement
- Cache location: [path]

### CrossOver/Wine Storage

| Component | Typical Size | Notes |
|-----------|--------------|-------|
| Bottle (per game) | X-X GB | Varies by game |
| Shared dependencies | X GB | One-time |
| Shader cache | X GB | Per game |

---

## 7. Cross-Domain Interactions

### Storage ↔ Memory

| Scenario | Impact |
|----------|--------|
| Low memory + SSD swap | Stutter, long loads |
| Adequate memory | SSD for loading only |
| Unified memory benefit | Less swap needed |

- Swap speed on Apple Silicon: X GB/s
- Swap impact on gaming: [quantified]

### Storage ↔ CPU

| Task | CPU Involvement |
|------|-----------------|
| Decompression | High (modern games use Oodle, Kraken, etc.) |
| Asset parsing | Medium |
| Shader compilation | High |

- Decompression bottleneck: When storage exceeds X GB/s, CPU becomes limiter

### Storage ↔ Thermal

- SSD thermal throttling on Apple Silicon: [observed behavior]
- Sustained write thermal patterns: [description]
- Gaming I/O typically: Read-heavy, low thermal impact

---

## 8. Optimization Recommendations

### General Guidelines

| Recommendation | Impact | Priority |
|----------------|--------|----------|
| Maintain 20%+ free space | Stable write performance | High |
| Upgrade from 256GB if gaming | Better speeds + capacity | Medium |
| Use Thunderbolt SSD for overflow | External gaming viable | Medium |
| Clear Rosetta cache periodically | Reclaim space | Low |

### By Storage Tier

#### 256GB Users
- Maximum 2-3 large games installed
- Use external for game library
- Monitor free space closely
- Consider 512GB for next device

#### 512GB-1TB Users
- Comfortable for most users
- 5-10 games typically
- External optional for archive

#### 2TB+ Users
- No practical limits
- Full library possible
- External rarely needed

---

## 9. Confidence Notes

| Section | Confidence | Notes |
|---------|------------|-------|
| SSD speeds | High | Benchmark verified |
| Loading times | Medium | Game-dependent |
| Streaming requirements | Medium | Estimated from requirements |
| External performance | High | Well documented |
| Free space impact | Medium | Varies by drive state |
```

**Output:** `.planning/research/templates/storage-knowledge-template.md`

---

## Success Criteria

- [ ] Deep Research prompt explores storage comprehensively
- [ ] 256GB configuration penalty is addressed specifically
- [ ] External storage viability is evaluated
- [ ] Loading time and streaming formulas are explored
- [ ] Template captures gaming-relevant storage data

---

## Notes

- User runs prompt with Gemini 2.5 Pro Deep Research offline
- Findings populate template and feed Phase 47 Configuration Calculator
- This is research phase — validation against real hardware comes later
