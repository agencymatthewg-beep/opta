# Phase 51: Quick Access System - Implementation Plan

**Phase:** 51-quick-access-system
**Plan:** 01 (Single comprehensive plan)
**Estimated Scope:** Medium (4-6 hours)
**Created:** 2026-01-18

---

<objective>
Build a glanceable, draggable chess widget that provides instant access to chess from anywhere in Opta. The widget shows game status at a glance, supports three-tab navigation (Play/Puzzles/Tutor), and is accessible via keyboard shortcut.
</objective>

<execution_context>
**Design System:** Follow `/DESIGN_SYSTEM.md` strictly
- Framer Motion for all animations (use `drag` prop for draggability)
- Lucide icons only
- Glass styling (`.glass` class)
- CSS variables for colors
- `cn()` helper for conditional classes
- `smoothOut: [0.22, 1, 0.36, 1]` easing

**Existing Patterns:**
- Chess components: `src/components/chess/` (ChessBoard, GameControls, MoveHistory)
- Hooks: `useChessGame`, `useStockfish`, `useGlobalShortcut`
- Keyboard shortcuts: `src/components/GlobalShortcuts.tsx`
- localStorage pattern: `opta_chess_settings`, `opta_chess_game_fen`

**New localStorage Keys:**
- `opta_chess_widget_position`: `{ x: number, y: number }`
- `opta_chess_widget_visible`: boolean
- `opta_chess_widget_expanded`: boolean
- `opta_chess_widget_expansion_mode`: 'inline' | 'modal'
</execution_context>

<context>
**From 51-CONTEXT.md Vision:**
- Always-accessible chess without being intrusive
- Glanceable widget showing: your move indicator, puzzle status, streak count
- Matches Opta glass aesthetic, draggable positioning
- Expands in place by default, configurable to modal overlay
- Keyboard shortcut (Cmd+Shift+C) for instant toggle
- Three-tab architecture everywhere: Play / Puzzles / Tutor

**Dependencies:**
- Existing chess implementation (Chess.tsx, chess hooks)
- Framer Motion (already installed)
- Tauri global shortcut plugin (already configured)
</context>

---

## Tasks

### Task 1: Create ChessWidget Component Structure
**File:** `src/components/chess/ChessWidget.tsx`

Create the main widget component with:
- Floating container with `fixed` positioning
- Framer Motion `drag` prop for draggability with `dragConstraints`
- Collapsed state: Shows glanceable status (your move, puzzle, streak)
- Expanded state: Shows three-tab interface
- Glass styling matching Opta aesthetic
- Close/minimize button
- Position persistence via localStorage

```tsx
// Key structure
interface ChessWidgetProps {
  isVisible: boolean;
  onClose: () => void;
}

// State
const [isExpanded, setIsExpanded] = useState(false);
const [position, setPosition] = useState({ x: 20, y: 20 });
const [activeTab, setActiveTab] = useState<'play' | 'puzzles' | 'tutor'>('play');
```

**Acceptance Criteria:**
- [ ] Widget renders in fixed position
- [ ] Draggable with Framer Motion (respects viewport bounds)
- [ ] Position persists across page refreshes
- [ ] Collapsed/expanded states work correctly
- [ ] Glass styling applied

---

### Task 2: Implement Glanceable Status Display
**File:** `src/components/chess/ChessWidgetStatus.tsx`

Create the collapsed widget view showing:
- Your turn indicator (pulsing dot when it's your move)
- Daily puzzle status (checkmark if completed, puzzle icon if pending)
- Streak count with flame icon

```tsx
interface ChessWidgetStatusProps {
  isYourTurn: boolean;
  hasPendingPuzzle: boolean;
  puzzleStreak: number;
}
```

**Note:** Puzzle system doesn't exist yet (Phase 52), so use placeholder data for now. Wire up real data when available.

**Acceptance Criteria:**
- [ ] Shows all three status indicators
- [ ] Pulse animation on "your turn" indicator
- [ ] Proper Lucide icons (Circle for turn, Puzzle for puzzles, Flame for streak)
- [ ] Clicking expands widget

---

### Task 3: Implement Three-Tab Navigation
**File:** `src/components/chess/ChessWidgetTabs.tsx`

Create tab navigation following existing Chess.tsx pattern:
- Play tab: Shows mini chess board + quick controls
- Puzzles tab: "Coming in Phase 52" placeholder
- Tutor tab: "Coming in Phase 55" placeholder

Use AnimatePresence with `mode="wait"` for smooth transitions.

```tsx
const tabs = [
  { id: 'play', label: 'Play', icon: Crown },
  { id: 'puzzles', label: 'Puzzles', icon: Puzzle },
  { id: 'tutor', label: 'Tutor', icon: Brain },
] as const;
```

**Acceptance Criteria:**
- [ ] Three tabs render with proper icons
- [ ] Active tab has underlay animation (layoutId pattern)
- [ ] Tab switching animates content smoothly
- [ ] Play tab functional, others show placeholder

---

### Task 4: Create Mini Chess Board for Widget
**File:** `src/components/chess/MiniChessBoard.tsx`

Create a compact version of the chess board for the widget:
- Smaller board (200-250px) that fits in widget
- Functional moves against Stockfish
- Minimal controls (new game, undo)
- Links to full Chess page for detailed play

Reuse existing `useChessGame` and `useStockfish` hooks.

**Acceptance Criteria:**
- [ ] Board renders at compact size
- [ ] Moves work correctly
- [ ] Stockfish responds to moves
- [ ] "Open full board" link to Chess page

---

### Task 5: Add Keyboard Shortcut Toggle
**Files:**
- `src/components/GlobalShortcuts.tsx`
- `src/hooks/useGlobalShortcut.ts` (if type update needed)

Add `CommandOrControl+Shift+C` shortcut to toggle chess widget:
- Register shortcut in GlobalShortcuts
- Toggle widget visibility on press
- Show toast notification when toggled

**Acceptance Criteria:**
- [ ] Cmd+Shift+C (macOS) / Ctrl+Shift+C (Windows/Linux) toggles widget
- [ ] Toast shows "Chess opened" / "Chess minimized"
- [ ] Shortcut works when app is focused

---

### Task 6: Integrate Widget into App Layout
**File:** `src/components/Layout.tsx`

Add ChessWidget to the app layout:
- Render widget at root level (available on all pages)
- Manage visibility state at layout level
- Connect to GlobalShortcuts handler

```tsx
const [chessWidgetVisible, setChessWidgetVisible] = useState(() => {
  // Load from localStorage
});
```

**Acceptance Criteria:**
- [ ] Widget available on all pages
- [ ] Visibility persists across navigation
- [ ] No duplicate widgets

---

### Task 7: Add Widget Expansion Mode Setting
**File:** `src/components/chess/ChessWidgetSettings.tsx` (or inline in widget)

Add configuration for expansion behavior:
- Default: Expand in place (grows the widget)
- Option: Modal overlay (opens centered modal instead)
- Store preference in localStorage

**Acceptance Criteria:**
- [ ] Setting accessible from widget header (gear icon)
- [ ] "Expand in place" vs "Open as modal" toggle
- [ ] Preference persists
- [ ] Both modes function correctly

---

### Task 8: Polish and Animation Refinement

Final polish pass:
- Smooth drag with momentum
- Snap to edges (optional, if feels good)
- Proper z-index layering (widget below modals)
- Loading states during Stockfish initialization
- Error boundaries

**Acceptance Criteria:**
- [ ] Animations feel smooth and polished
- [ ] No z-index conflicts with other UI
- [ ] Graceful error handling
- [ ] Build passes (`npm run build`)

---

## Verification

```bash
# Build check
npm run build

# Type check
npm run typecheck

# Manual testing checklist:
# 1. Widget appears on all pages
# 2. Cmd+Shift+C toggles widget
# 3. Widget is draggable, position persists
# 4. Three tabs work (Play functional, others placeholder)
# 5. Mini board plays chess correctly
# 6. Expansion mode setting works
# 7. Glass styling matches Opta aesthetic
```

---

## Success Criteria

- [ ] Glanceable chess widget accessible from anywhere in Opta
- [ ] Draggable with persistent positioning
- [ ] Three-tab navigation (Play/Puzzles/Tutor) architecture established
- [ ] Keyboard shortcut (Cmd+Shift+C) working
- [ ] Matches Opta glass aesthetic perfectly
- [ ] Build passes with no errors
- [ ] Design system compliance verified

---

## Output

**New Files:**
- `src/components/chess/ChessWidget.tsx` - Main widget component
- `src/components/chess/ChessWidgetStatus.tsx` - Glanceable status display
- `src/components/chess/ChessWidgetTabs.tsx` - Three-tab navigation
- `src/components/chess/MiniChessBoard.tsx` - Compact chess board

**Modified Files:**
- `src/components/Layout.tsx` - Widget integration
- `src/components/GlobalShortcuts.tsx` - Keyboard shortcut
- `src/types/chess.ts` - New types if needed

---

*Plan: 51-01-PLAN.md*
*Phase: 51-quick-access-system*
*Status: Ready for execution*
