---
phase: 21-advanced-visualizations
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [src/components/charts/RealtimeTelemetryChart.tsx, src/components/charts/index.ts, src/hooks/useTelemetryHistory.ts, package.json]
autonomous: true
---

<objective>
Implement real-time telemetry charts using Apache ECharts with Canvas rendering for high-performance streaming data visualization.

Purpose: Replace basic meter components with rich, interactive charts that can display 10K+ data points at 60fps, enabling users to see telemetry history and trends over time.
Output: RealtimeTelemetryChart component integrated into Dashboard with CPU, Memory, GPU, and Disk streaming visualization.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

**Research findings (from 20-RESEARCH.md):**
- ECharts (Canvas) handles 10K+ points at 60fps
- Use `echarts-for-react` wrapper for React integration
- Canvas mode (not SVG) for streaming performance
- Avoid >5000 SVG nodes (use Canvas instead)

**Existing telemetry data:**
@src/hooks/useTelemetry.ts
@src/components/TelemetryCard.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install ECharts dependencies</name>
  <files>package.json</files>
  <action>
Install Apache ECharts and React wrapper:
```bash
npm install echarts echarts-for-react
```

ECharts is ~140KB but provides Canvas-based high-performance rendering essential for real-time data streams.
  </action>
  <verify>npm ls echarts echarts-for-react shows both installed</verify>
  <done>ECharts dependencies installed in package.json</done>
</task>

<task type="auto">
  <name>Task 2: Create telemetry history hook</name>
  <files>src/hooks/useTelemetryHistory.ts</files>
  <action>
Create hook that maintains a sliding window of telemetry history:

```typescript
interface TelemetryDataPoint {
  timestamp: number;
  cpu: number;
  memory: number;
  gpu: number | null;
  disk: number;
}

interface UseTelemetryHistoryOptions {
  maxPoints?: number; // Default 300 (5 minutes at 1/sec)
  sampleInterval?: number; // Default 1000ms
}
```

Key requirements:
- Subscribe to existing telemetry updates from useTelemetry hook
- Sample at configurable interval (default 1 second)
- Maintain circular buffer of maxPoints entries
- Expose `history: TelemetryDataPoint[]` and `clearHistory: () => void`
- Use useRef for buffer to avoid re-renders on every sample
- Only trigger re-render when component requests data via callback

Performance: Buffer operations must be O(1) - use array with pointer, not shift().
  </action>
  <verify>Import hook in a test component and verify history array populates over 10 seconds</verify>
  <done>useTelemetryHistory hook exports history array and clearHistory function, maintains 300-point sliding window</done>
</task>

<task type="auto">
  <name>Task 3: Create RealtimeTelemetryChart component</name>
  <files>src/components/charts/RealtimeTelemetryChart.tsx, src/components/charts/index.ts</files>
  <action>
Create a real-time streaming chart component using ECharts:

```typescript
interface RealtimeTelemetryChartProps {
  metric: 'cpu' | 'memory' | 'gpu' | 'disk' | 'all';
  height?: number; // Default 200
  showLegend?: boolean;
  className?: string;
}
```

ECharts configuration requirements:
- Use `renderer: 'canvas'` for performance (NOT svg)
- Enable `animation: false` for real-time updates (prevents lag)
- Use `appendData` API for efficient streaming updates
- Configure xAxis as time axis with auto-scaling
- Configure yAxis 0-100% with gridlines at 60/85 (warning/danger thresholds)
- Use semantic colors from design system:
  - CPU: primary (purple)
  - Memory: chart-2 (blue)
  - GPU: chart-3 (green)
  - Disk: chart-4 (orange)
- Apply glass styling to chart container
- Handle resize with ResizeObserver
- Dispose chart instance on unmount to prevent memory leaks

Add tooltip showing exact values on hover.
Create index.ts barrel export.
  </action>
  <verify>npm run build succeeds, chart renders in browser with streaming data</verify>
  <done>RealtimeTelemetryChart component renders 4 metrics with real-time updates, glass styling, and proper cleanup</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] ECharts chart renders in browser
- [ ] Data streams in real-time (updates every second)
- [ ] Chart handles 300+ data points without performance degradation
- [ ] Warning (60%) and danger (85%) threshold lines visible
- [ ] Chart container has glass styling
- [ ] No memory leaks (chart disposed on unmount)
</verification>

<success_criteria>
- All tasks completed
- RealtimeTelemetryChart component functional
- Real-time streaming visualization works at 60fps
- Design system colors applied
- Glass styling matches Phase 20 patterns
</success_criteria>

<output>
After completion, create `.planning/phases/21-advanced-visualizations/21-01-SUMMARY.md`
</output>
