---
phase: 01-foundation
plan: 03
type: execute
wave: 2
depends_on: ["01-01"]
files_modified: [src-tauri/tauri.conf.json, .github/workflows/build.yml, src-tauri/Cargo.toml]
autonomous: true
---

<objective>
Configure cross-platform build settings and set up GitHub Actions CI for automated builds.

Purpose: Ensure Opta can be built for Windows, macOS, and Linux from the start, catching platform-specific issues early.
Output: GitHub Actions workflow that builds for all platforms, verified local build for current platform.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Configure Tauri build settings for all platforms</name>
  <files>src-tauri/tauri.conf.json, src-tauri/Cargo.toml</files>
  <action>
    1. Update src-tauri/tauri.conf.json bundle section:
       ```json
       "bundle": {
         "active": true,
         "targets": "all",
         "identifier": "com.opta.app",
         "icon": [
           "icons/32x32.png",
           "icons/128x128.png",
           "icons/128x128@2x.png",
           "icons/icon.icns",
           "icons/icon.ico"
         ],
         "windows": {
           "certificateThumbprint": null,
           "digestAlgorithm": "sha256",
           "timestampUrl": ""
         },
         "macOS": {
           "entitlements": null,
           "exceptionDomain": "",
           "frameworks": [],
           "minimumSystemVersion": "10.13"
         },
         "linux": {
           "appimage": {
             "bundleMediaFramework": false
           },
           "deb": {
             "depends": []
           }
         }
       }
       ```

    2. Create placeholder icons in src-tauri/icons/:
       - Use Tauri's default icons for now
       - Note: Custom Opta icons will be designed later
       - Ensure icon.ico (Windows), icon.icns (macOS), and PNGs exist

    3. Update Cargo.toml with release profile:
       ```toml
       [profile.release]
       lto = true
       opt-level = "s"
       codegen-units = 1
       strip = true
       ```
       This produces smaller, faster binaries.
  </action>
  <verify>
    - tauri.conf.json has bundle config for Windows, macOS, Linux
    - Icons directory exists with required formats
    - Cargo.toml has release profile configured
  </verify>
  <done>Build configuration set up for all three platforms</done>
</task>

<task type="auto">
  <name>Task 2: Create GitHub Actions workflow for CI builds</name>
  <files>.github/workflows/build.yml</files>
  <action>
    1. Create .github/workflows/ directory

    2. Create build.yml with matrix build for all platforms:
       ```yaml
       name: Build

       on:
         push:
           branches: [main]
         pull_request:
           branches: [main]

       jobs:
         build:
           strategy:
             fail-fast: false
             matrix:
               platform: [macos-latest, ubuntu-22.04, windows-latest]

           runs-on: ${{ matrix.platform }}

           steps:
             - uses: actions/checkout@v4

             - name: Setup Node.js
               uses: actions/setup-node@v4
               with:
                 node-version: 20

             - name: Install Rust stable
               uses: dtolnay/rust-action@stable

             - name: Install dependencies (Ubuntu)
               if: matrix.platform == 'ubuntu-22.04'
               run: |
                 sudo apt-get update
                 sudo apt-get install -y libwebkit2gtk-4.1-dev build-essential curl wget file libxdo-dev libssl-dev libayatana-appindicator3-dev librsvg2-dev

             - name: Install frontend dependencies
               run: npm install

             - name: Build Tauri app
               uses: tauri-apps/tauri-action@v0
               env:
                 GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
       ```

    3. This workflow:
       - Triggers on push/PR to main
       - Builds on macOS, Ubuntu, and Windows
       - Installs platform-specific dependencies
       - Uses official Tauri action for builds

    Note: We're not creating releases yet - just CI verification builds.
  </action>
  <verify>
    - .github/workflows/build.yml exists
    - YAML syntax is valid (no parse errors)
    - All three platforms configured in matrix
  </verify>
  <done>GitHub Actions CI workflow created for cross-platform builds</done>
</task>

<task type="auto">
  <name>Task 3: Verify production build on current platform</name>
  <files>None (verification only)</files>
  <action>
    1. Run `npm run tauri build` to create production build
    2. Wait for build to complete (may take several minutes)
    3. Check build output location:
       - macOS: src-tauri/target/release/bundle/macos/
       - Windows: src-tauri/target/release/bundle/msi/ or /nsis/
       - Linux: src-tauri/target/release/bundle/appimage/ or /deb/

    4. Verify:
       - Build completes without errors
       - Bundle file is created
       - Bundle size is reasonable (should be <50MB for minimal app)

    5. Optionally run the built app to verify it works outside dev mode

    If build fails:
    - Check for missing platform dependencies
    - Review Tauri build documentation for platform-specific requirements
    - Note any issues for future debugging
  </action>
  <verify>
    - `npm run tauri build` completes successfully
    - Bundle files created in target/release/bundle/
    - Built app runs when executed directly
  </verify>
  <done>Production build verified on current platform, ready for CI</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] tauri.conf.json has cross-platform bundle config
- [ ] .github/workflows/build.yml exists with matrix build
- [ ] `npm run tauri build` succeeds on current platform
- [ ] Bundle output exists and is reasonable size
</verification>

<success_criteria>
- All tasks completed
- Cross-platform build configuration in place
- GitHub Actions workflow ready for CI
- Local production build verified
- Foundation phase complete, ready for Phase 2
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-03-SUMMARY.md`
</output>
