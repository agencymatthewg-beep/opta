---
phase: 10-polish-launch
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [package.json, src-tauri/tauri.conf.json, src-tauri/Cargo.toml, .github/workflows/build.yml, scripts/test-platforms.sh]
autonomous: true
---

<objective>
Cross-platform testing and compatibility verification for Windows, macOS, and Linux.

Purpose: Ensure Opta runs flawlessly across all supported platforms before launch. This includes testing hardware telemetry, process management, game detection, and all core features on each OS.

Output: Platform-specific build configs, automated test scripts, and verified cross-platform compatibility.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/10-polish-launch/10-CONTEXT.md
@src-tauri/tauri.conf.json
@.github/workflows/build.yml
@mcp-server/src/opta_mcp/server.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create platform testing matrix</name>
  <files>scripts/test-platforms.sh, scripts/test-platforms.ps1</files>
  <action>
Create test scripts that verify all core functionality per platform:

```bash
#!/bin/bash
# scripts/test-platforms.sh

# Platform detection
OS=$(uname -s)
echo "Testing on: $OS"

# Test matrix
tests=(
  "Hardware telemetry: CPU, GPU, RAM detection"
  "Process listing and categorization"
  "Process termination (Stealth Mode)"
  "Conflict detection (competing optimizers)"
  "Game detection across launchers"
  "LLM connectivity (local Ollama)"
  "Optimization engine apply/rollback"
  "Score calculation and display"
)

# Run MCP server tests
echo "=== MCP Server Tests ==="
cd mcp-server
uv run python -c "from opta_mcp.server import get_system_telemetry; print(get_system_telemetry())"
uv run python -c "from opta_mcp.server import get_processes; print(len(get_processes()['processes']))"
uv run python -c "from opta_mcp.conflicts import detect_conflicts; print(detect_conflicts())"
uv run python -c "from opta_mcp.games import detect_installed_games; print(detect_installed_games())"

# Run frontend build test
echo "=== Frontend Build Test ==="
cd ..
npm run build

# Run Tauri build test
echo "=== Tauri Build Test ==="
npm run tauri build -- --debug
```

Create Windows PowerShell equivalent for Windows testing.
  </action>
  <verify>bash scripts/test-platforms.sh runs without errors on current platform</verify>
  <done>Platform testing scripts created for macOS/Linux and Windows</done>
</task>

<task type="auto">
  <name>Task 2: Platform-specific MCP fixes</name>
  <files>mcp-server/src/opta_mcp/server.py, mcp-server/src/opta_mcp/games.py</files>
  <action>
Audit and fix platform-specific code paths:

1. **Hardware telemetry** (server.py):
   - Verify GPUtil fallback chain works on all platforms
   - Test pynvml on Windows with NVIDIA drivers
   - Test macOS system_profiler GPU detection
   - Ensure Linux AMD GPU detection works (if applicable)

2. **Process detection** (server.py):
   - Verify psutil process iteration on Windows (access denied handling)
   - Test process categorization patterns for each OS
   - Ensure safe process lists are accurate per platform

3. **Game detection** (games.py):
   - Verify Steam paths: Windows (Program Files), macOS (~/Library), Linux (~/.steam)
   - Test Epic Games detection on each platform
   - Test GOG Galaxy paths

4. **Conflict detection** (conflicts.py):
   - Windows-only: GeForce Experience, Razer Cortex, MSI Afterburner registry checks
   - macOS: Check for CleanMyMac, Mac optimization tools
   - Linux: Check for GameMode, MangoHud

Add platform guards where needed:
```python
import platform

def get_platform_specific_paths():
    system = platform.system()
    if system == "Windows":
        return {...}
    elif system == "Darwin":
        return {...}
    else:  # Linux
        return {...}
```
  </action>
  <verify>Run test-platforms.sh on current platform, verify all MCP calls succeed</verify>
  <done>Platform-specific MCP code audited and fixed</done>
</task>

<task type="auto">
  <name>Task 3: Update CI/CD for all platforms</name>
  <files>.github/workflows/build.yml</files>
  <action>
Update GitHub Actions workflow to build and test on all platforms:

```yaml
name: Build and Test

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  build:
    strategy:
      fail-fast: false
      matrix:
        platform:
          - os: ubuntu-latest
            target: x86_64-unknown-linux-gnu
          - os: macos-latest
            target: x86_64-apple-darwin
          - os: macos-latest
            target: aarch64-apple-darwin
          - os: windows-latest
            target: x86_64-pc-windows-msvc

    runs-on: ${{ matrix.platform.os }}

    steps:
      - uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: Setup Rust
        uses: dtolnay/rust-action@stable
        with:
          targets: ${{ matrix.platform.target }}

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.12'

      - name: Install uv
        run: pip install uv

      - name: Install dependencies
        run: npm ci

      - name: Install MCP dependencies
        run: |
          cd mcp-server
          uv sync

      - name: Build frontend
        run: npm run build

      - name: Build Tauri
        uses: tauri-apps/tauri-action@v0
        with:
          args: --target ${{ matrix.platform.target }}

      - name: Run platform tests
        run: |
          cd mcp-server
          uv run python -c "from opta_mcp.server import get_system_telemetry; print('Telemetry OK')"
```

Ensure all three platforms (Windows, macOS, Linux) pass CI.
  </action>
  <verify>CI workflow syntax valid, push to test branch to verify builds</verify>
  <done>CI/CD updated for cross-platform builds</done>
</task>

<task type="auto">
  <name>Task 4: Document platform requirements</name>
  <files>docs/PLATFORM_REQUIREMENTS.md</files>
  <action>
Create platform requirements documentation:

```markdown
# Platform Requirements

## Windows
- Windows 10 (1903+) or Windows 11
- Microsoft Visual C++ Redistributable 2019+
- WebView2 Runtime (usually pre-installed on Windows 10+)
- Optional: NVIDIA drivers for GPU telemetry

## macOS
- macOS 10.13 (High Sierra) or later
- macOS 11+ recommended for full feature set
- Apple Silicon (M1/M2/M3) or Intel supported

## Linux
- Ubuntu 20.04+ / Debian 11+ / Fedora 35+
- GTK 3 libraries
- WebKitGTK 4.1+
- Optional: NVIDIA drivers + nvidia-smi for GPU telemetry

## Common Requirements
- 8GB RAM minimum (for local LLM)
- 500MB disk space
- Internet connection (for cloud features)
```
  </action>
  <verify>File created with accurate requirements</verify>
  <done>Platform requirements documented</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Platform test scripts work on current OS
- [ ] MCP server handles platform differences gracefully
- [ ] CI/CD builds all three platforms
- [ ] Platform requirements documented
- [ ] No hardcoded paths or platform-specific assumptions
</verification>

<success_criteria>
- All tasks completed
- Test scripts runnable on Windows, macOS, and Linux
- MCP server works on all platforms (with graceful fallbacks)
- CI/CD matrix covers all platforms
- Documentation explains requirements per platform
</success_criteria>

<output>
After completion, create `.planning/phases/10-polish-launch/10-01-SUMMARY.md`
</output>
