# Phase 98-01: Advanced Optimization (Network & Power Profiles)

**Version**: 12.0
**Status**: In Progress
**Created**: 2026-01-26

---

## Overview

Enhance the optimization system with advanced network diagnostics (DNS, QoS, buffer tuning), per-game network profiles, battery impact estimation, and automatic profile switching based on learned patterns.

---

## Current State Analysis

### NetworkLatencyService
- Pings 5 global endpoints (Cloudflare, Google, AWS regions)
- Returns basic latency in milliseconds
- No DNS resolution timing
- No QoS or buffer recommendations

### PowerService
- Uses IOKit sleep assertions for power profiles
- 4 profiles: balanced, gaming, highPerformance, batterySaver
- No battery impact estimation
- No automatic switching

### OptimizationView
- Basic power profile picker (4 options)
- Latency cards with status indicators
- No Obsidian design system
- No per-game profiles UI

---

## Deliverables

### 1. Network Enhancements
- [ ] Add DNS resolution timing to NetworkLatencyService
- [ ] Add QoS detection (traffic priority hints)
- [ ] Add network buffer size recommendations
- [ ] Create NetworkProfile model for per-game settings

### 2. Power Enhancements
- [ ] Add battery impact estimation (watts/hour)
- [ ] Integrate with PatternLearningService for auto-switching
- [ ] Add profile recommendation engine

### 3. Per-Game Profiles
- [ ] Create GameNetworkProfile model
- [ ] Add profile persistence via UserDefaults
- [ ] Link profiles to game sessions

### 4. UI Updates
- [ ] Redesign OptimizationView with Obsidian system
- [ ] Add DNS/QoS display cards
- [ ] Add battery impact indicator
- [ ] Add per-game profile selector

---

## Implementation Plan

### Task 1: Enhanced NetworkLatencyService

```swift
// New capabilities:
- dnsResolutionTime: TimeInterval  // DNS lookup timing
- jitter: Double                    // Latency variance
- packetLoss: Double               // Estimated packet loss %
- qosClass: QoSClass               // Detected traffic class
- recommendedBufferSize: Int       // Optimal buffer in KB
```

### Task 2: Battery Impact Estimation

```swift
// PowerProfile extensions:
- estimatedWatts: Double           // Power draw estimate
- batteryImpact: BatteryImpact     // .minimal, .moderate, .significant
- thermalImpact: ThermalImpact     // .cool, .warm, .hot
```

### Task 3: Automatic Profile Switching

```swift
// Integration points:
- PatternLearningService.shouldAutoSwitch(for: context)
- PowerService.setAutomaticProfile(enabled: Bool)
- OptimizationViewModel.checkAutoSwitch()
```

### Task 4: Obsidian UI Redesign

- Void background (Color.optaVoid)
- Surface cards (Color.optaSurface)
- Neon accents for active states
- Opta typography throughout

---

## Technical Notes

- All network operations must be async/await
- Battery estimation uses historical IOKit data + heuristics
- Auto-switch requires minimum 3 sessions of pattern data
- Profile changes trigger haptic feedback

---

## Files to Modify

1. `Services/NetworkLatencyService.swift` - DNS, QoS, buffers
2. `Services/PowerService.swift` - Battery estimation
3. `ViewModels/OptimizationViewModel.swift` - Auto-switch logic
4. `Views/Optimization/OptimizationView.swift` - Obsidian redesign
5. `Models/NetworkProfile.swift` - New file for profiles

---

## Success Criteria

- [ ] DNS resolution shown in latency results
- [ ] Battery impact visible for each power profile
- [ ] Auto-switch toggleable and functional
- [ ] UI follows Obsidian design system
- [ ] Per-game profiles persist across sessions
