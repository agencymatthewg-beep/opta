---
phase: 88-organic-motion-system
plan: 01
title: Organic Motion Foundation
subsystem: animation
wave: 1
depends_on: []
files_modified: [opta-native/OptaApp/OptaApp/Animation/OrganicMotion.swift, opta-native/OptaApp/OptaApp/Animation/OrganicMotionModifiers.swift]
autonomous: true
scope: small
tags: [swift, swiftui, animation, organic-motion, spring-physics, accessibility]
---

# Plan 88-01: Organic Motion Foundation

## Objective

Create the OrganicMotion system — a utility providing per-element phase offsets, varied duration ranges, organic spring physics, and system-state-responsive timing. This foundation is consumed by all subsequent animation integration plans.

## Execution Context

### Patterns from Prior Phases
- Reduce-motion: `@Environment(\.accessibilityReduceMotion)` — always check before animating
- Existing spring params: `.spring(response: 0.3-0.5, dampingFraction: 0.6-0.8)` — organic variants of these
- ThermalStateManager exists at `Services/ThermalStateManager.swift` — provides system thermal state
- CharacterAnimator exists at `Animation/CharacterAnimator.swift` — stagger pattern reference

### Key References
- `opta-native/OptaApp/OptaApp/Animation/CharacterAnimator.swift` — existing stagger pattern
- `opta-native/OptaApp/OptaApp/Services/ThermalStateManager.swift` — system state for responsive timing

## Context

### Current State
- All animations use uniform timing (`.easeInOut(duration: 0.2)` or `.spring(response: 0.3, dampingFraction: 0.7)`)
- No per-element phase variation — all cards pulse in sync
- No system-state-responsive animation speed
- Reduce-motion already respected in several components

### Design Goals
- **No two elements should pulse in sync** — hash-based phase offset from element identity
- **Varied durations** — ambient: 3-7s, interaction: 0.5-1.5s
- **Organic springs** — varied damping (0.5-0.85) and response (0.2-0.6) per element
- **System-responsive** — faster/calmer animations based on thermal state
- **Reduce-motion** — static positions, no pulsing, instant transitions

## Tasks

### Task 1: OrganicMotion Utility

**Files:** `opta-native/OptaApp/OptaApp/Animation/OrganicMotion.swift`

**Changes:**
Create a new file with:

1. `OrganicMotion` enum (namespace) with:
   - `static func phaseOffset(for id: String) -> Double` — hash-based offset in range 0...1 (use `id.hashValue` modulo to produce deterministic fractional offset)
   - `static func ambientDuration(for id: String) -> Double` — returns 3-7s based on hash, no two alike
   - `static func interactionDuration(for id: String) -> Double` — returns 0.5-1.5s based on hash
   - `static func organicSpring(for id: String, intensity: OrganicIntensity = .medium) -> Animation` — varied spring with response/damping derived from id hash
   - `static func staggerDelay(index: Int, total: Int, spread: Double = 0.6) -> Double` — non-uniform stagger (not linear; uses sine curve for organic feel)

2. `OrganicIntensity` enum:
   - `.subtle` — gentle ambient movement (long duration, high damping)
   - `.medium` — standard UI interactions
   - `.energetic` — responsive feedback (short duration, lower damping)

3. `SystemResponsiveModifier` — reads ThermalStateManager.shared:
   - `.nominal` → normal timing (1.0x multiplier)
   - `.fair` → slightly faster (0.85x multiplier)
   - `.serious` → minimal animation (0.5x multiplier, reduced amplitude)
   - `.critical` → no animation (static, preserve resources)

4. `OrganicMotion.animation(for id: String, intensity: OrganicIntensity, thermalState: ProcessInfo.ThermalState) -> Animation?`
   - Combines spring + system state
   - Returns `.none` (nil) for critical thermal or reduce-motion

**Verification:** File compiles as part of Xcode project

### Task 2: OrganicMotion View Modifiers

**Files:** `opta-native/OptaApp/OptaApp/Animation/OrganicMotionModifiers.swift`

**Changes:**
Create a new file with SwiftUI view modifiers:

1. `.organicPulse(id: String, intensity: OrganicIntensity = .subtle)` modifier:
   - Applies subtle scale oscillation (0.98-1.02 range for subtle, wider for energetic)
   - Phase offset from `OrganicMotion.phaseOffset(for: id)`
   - Duration from `OrganicMotion.ambientDuration(for: id)`
   - Uses `TimelineView(.periodic(every: 0.016))` for smooth animation
   - Reduce-motion: no-op (returns content unchanged)
   - Critical thermal: no-op

2. `.organicAppear(index: Int, total: Int, spread: Double = 0.6)` modifier:
   - Staggered entrance: opacity 0→1, translateY 8→0
   - Delay from `OrganicMotion.staggerDelay(index:total:spread:)`
   - Spring animation with organic damping per element
   - Reduce-motion: instant appear (no animation, full opacity)

3. `.organicHover(isHovered: Bool, id: String = UUID().uuidString)` modifier:
   - Scale: 1.0 → 1.02 on hover with organic spring
   - Subtle brightness shift: 0 → 0.03
   - Spring params from `OrganicMotion.organicSpring(for: id, intensity: .medium)`
   - Reduce-motion: no scale, only subtle brightness change

4. Private `OrganicPulseModifier`, `OrganicAppearModifier`, `OrganicHoverModifier` structs implementing `ViewModifier`

**Verification:** File compiles, modifiers are accessible from other views

## Verification

After all tasks:
```bash
cd opta-native && xcodebuild build -project OptaApp/OptaApp.xcodeproj -scheme OptaApp -destination 'platform=macOS' 2>&1 | tail -5
```

Expected: **BUILD SUCCEEDED**

## Success Criteria

- [ ] `OrganicMotion.swift` provides hash-based phase offsets and varied timing
- [ ] Spring physics vary per element (no two identical)
- [ ] System-state-responsive timing adjusts for thermal pressure
- [ ] Reduce-motion returns static/nil animation in all cases
- [ ] View modifiers (organicPulse, organicAppear, organicHover) are importable
- [ ] Build succeeds with no new errors

## Output

- SUMMARY.md with files created, patterns established
- Per-task atomic commits
