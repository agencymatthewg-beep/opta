---
phase: 17-chess-integration
plan: 03
type: execute
wave: 3
depends_on: ["17-02"]
files_modified: [src/components/chess/ChessBoard.tsx, src/components/chess/GameControls.tsx, src/components/chess/MoveHistory.tsx]
autonomous: true
---

<objective>
Create chess UI components with Opta glass styling.

Purpose: Build reusable chess UI components that integrate with Opta's design system and the hooks from 17-02.
Output: ChessBoard, GameControls, and MoveHistory components with glass effects and Framer Motion animations.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/17-chess-integration/17-RESEARCH.md
@.planning/phases/17-chess-integration/17-02-SUMMARY.md
@DESIGN_SYSTEM.md

@src/hooks/useChessGame.ts
@src/hooks/useStockfish.ts
@src/types/chess.ts
@src/components/ui/button.tsx
@src/components/TelemetryCard.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ChessBoard component</name>
  <files>src/components/chess/ChessBoard.tsx</files>
  <action>
Create ChessBoard wrapper around react-chessboard with Opta styling. Follow DESIGN_SYSTEM.md requirements.

**CRITICAL Design System Compliance:**
- Use Framer Motion for animations (NOT CSS transitions)
- Use Lucide icons (NOT inline SVGs)
- Use glass effects (.glass, .glass-subtle)
- Use CSS variables for colors (NOT hex/rgb)
- Use cn() helper for conditional classes

Interface:
```typescript
interface ChessBoardProps {
  fen: string;
  onMove: (move: { from: string; to: string }) => boolean;
  orientation?: 'white' | 'black';
  showLegalMoves?: boolean;
  getLegalMoves?: (square: string) => string[];
  disabled?: boolean;
  lastMove?: { from: string; to: string };
}
```

Implementation:
1. Wrap react-chessboard's Chessboard component
2. Custom styling to match Opta's glass aesthetic:
   - Dark board with glass container
   - Neon green (#00ff88 / --primary) for legal move hints
   - Subtle glow on pieces when selected
3. Show legal move indicators as dots on target squares
4. Highlight last move squares
5. Framer Motion for piece drop feedback (scale bounce)
6. Handle promotion dialog (show 4 piece options)

Board theme integration:
```typescript
customBoardStyle={{
  borderRadius: '12px',
  boxShadow: '0 8px 32px rgba(0, 0, 0, 0.4)',
}}
customDarkSquareStyle={{ backgroundColor: 'hsl(var(--muted))' }}
customLightSquareStyle={{ backgroundColor: 'hsl(var(--card))' }}
```

Respect DESIGN_SYSTEM.md - no arbitrary colors, use glass effects.
  </action>
  <verify>Component renders without errors; tsc --noEmit passes</verify>
  <done>ChessBoard component renders board with Opta glass styling and legal move hints</done>
</task>

<task type="auto">
  <name>Task 2: Create GameControls component</name>
  <files>src/components/chess/GameControls.tsx</files>
  <action>
Create GameControls for difficulty selection, new game, undo, and resign. Follow existing component patterns and DESIGN_SYSTEM.md.

Interface:
```typescript
interface GameControlsProps {
  difficulty: AIDifficulty;
  onDifficultyChange: (difficulty: AIDifficulty) => void;
  onNewGame: () => void;
  onUndo: () => void;
  onResign: () => void;
  canUndo: boolean;
  isGameOver: boolean;
  isThinking: boolean; // AI is thinking
}
```

Implementation:
1. Difficulty selector (dropdown or button group):
   - Beginner, Casual, Intermediate, Advanced, Maximum
   - Use existing Select/DropdownMenu patterns if available, else styled buttons
2. Action buttons with Lucide icons:
   - New Game (RefreshCw icon)
   - Undo (Undo2 icon) - disabled when canUndo=false
   - Resign (Flag icon) - disabled when isGameOver=true
3. Visual "AI thinking" indicator when isThinking=true (subtle pulse animation)
4. Glass container styling
5. Framer Motion hover/tap feedback on buttons

Ambient UX from research:
- No aggressive styling on buttons
- Soft transitions
- "AI is thinking..." text with ellipsis animation
  </action>
  <verify>Component renders without errors; tsc --noEmit passes</verify>
  <done>GameControls component with difficulty selector and game actions</done>
</task>

<task type="auto">
  <name>Task 3: Create MoveHistory component</name>
  <files>src/components/chess/MoveHistory.tsx</files>
  <action>
Create MoveHistory to display game moves in standard chess notation. Follow DESIGN_SYSTEM.md.

Interface:
```typescript
interface MoveHistoryProps {
  history: ChessMove[];
  onMoveClick?: (moveIndex: number) => void; // Future: click to navigate
  maxHeight?: string; // Default '200px'
}
```

Implementation:
1. Display moves in pairs (white move, black move per row):
   ```
   1. e4    e5
   2. Nf3   Nc6
   3. Bb5   ...
   ```
2. Use SAN notation from move.san
3. ScrollArea for long games (from @radix-ui/react-scroll-area)
4. Glass container with subtle border
5. Highlight last move
6. Monospace font for alignment (optional: use existing font or add)
7. Empty state: "Game not started" or "No moves yet"
8. Framer Motion for new move appearance (fade in)

Styling:
- Glass background
- Subtle grid lines between move pairs
- Current move highlighted with primary color
  </action>
  <verify>Component renders without errors; tsc --noEmit passes</verify>
  <done>MoveHistory component displays game moves with scroll and highlighting</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] All components follow DESIGN_SYSTEM.md (glass, motion, Lucide icons)
- [ ] ChessBoard integrates with react-chessboard
- [ ] GameControls has all required buttons and difficulty selector
- [ ] MoveHistory displays moves in standard notation
- [ ] No arbitrary colors or inline SVGs
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Components ready for ChessPage integration
- Design system compliance verified
</success_criteria>

<output>
After completion, create `.planning/phases/17-chess-integration/17-03-SUMMARY.md`
</output>
