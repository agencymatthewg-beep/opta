# Plan 11-01: Critical Bug Fixes

## Overview

Fix critical bugs discovered during v1.0 review: memory leak, missing error boundaries, and modal error handling.

## Tasks

### 1. Fix GameSessionTracker Memory Leak
**File**: `src/components/GameSessionTracker.tsx` (line 92)

**Problem**: Using `useState` instead of `useEffect` for timer interval, causing memory leak.

**Fix**:
```tsx
// BEFORE (broken)
useState(() => {
  const interval = setInterval(() => {
    setElapsed(Date.now() - session.startedAt);
  }, 1000);
  return () => clearInterval(interval);
});

// AFTER (correct)
useEffect(() => {
  const interval = setInterval(() => {
    setElapsed(Date.now() - session.startedAt);
  }, 1000);
  return () => clearInterval(interval);
}, [session.startedAt]);
```

### 2. Add React Error Boundary to App.tsx
**File**: `src/App.tsx`

Create error boundary component to catch React errors during rendering:

```tsx
// src/components/ErrorBoundary.tsx
class ErrorBoundary extends React.Component {
  state = { hasError: false, error: null };

  static getDerivedStateFromError(error) {
    return { hasError: true, error };
  }

  componentDidCatch(error, info) {
    console.error('Error boundary caught:', error, info);
  }

  render() {
    if (this.state.hasError) {
      return <ErrorFallback error={this.state.error} onReset={() => this.setState({ hasError: false })} />;
    }
    return this.props.children;
  }
}
```

Wrap page rendering in App.tsx with error boundary.

### 3. Add Error Prop to LaunchConfirmationModal
**File**: `src/components/LaunchConfirmationModal.tsx`

**Current**: No error display when `launchGame()` fails.

**Fix**:
- Add `error?: string` prop
- Display error message in modal footer with retry option
- Clear error when modal closes

```tsx
interface LaunchConfirmationModalProps {
  // ... existing props
  error?: string;
  onRetry?: () => void;
}
```

### 4. Fix Games Detail Panel Close Animation
**File**: `src/pages/Games.tsx` (lines 388-393)

**Problem**: When selected game is removed from list, panel closes abruptly.

**Fix**: Add AnimatePresence with exit animation before clearing selectedGame.

### 5. Allow Cancel During Loading in LaunchConfirmationModal
**File**: `src/components/LaunchConfirmationModal.tsx` (lines 264-274)

**Problem**: Cancel button is disabled when `loading` is true, trapping user.

**Fix**: Keep cancel enabled but show confirmation "Are you sure? This will stop the launch."

## Verification

1. Open DevTools → Performance → Record → Trigger game session → Stop → Check for memory growth
2. Throw error in a component → Verify error boundary catches it
3. Trigger launch failure → Verify error message displays in modal
4. Select game → Games list refreshes → Verify smooth animation
5. Start game launch → Click cancel → Verify cancellation works

## Files Modified

- `src/components/GameSessionTracker.tsx`
- `src/App.tsx`
- `src/components/ErrorBoundary.tsx` (new)
- `src/components/ErrorFallback.tsx` (new)
- `src/components/LaunchConfirmationModal.tsx`
- `src/pages/Games.tsx`

## Estimated Duration

15-20 minutes
