---
phase: 08.1-adaptive-intelligence
plan: 04
type: execute
wave: 2
depends_on: ["08.1-01"]
files_modified: [src/components/ProfileViewer.tsx, src/components/DataDeletionModal.tsx, src/pages/Settings.tsx]
autonomous: true
---

<objective>
Create transparency panel allowing users to view, edit, and delete all data Opta has learned about them.

Purpose: Build trust through transparency - users can see exactly what Opta knows, edit their preferences, and delete all data with one click. This addresses the privacy-first requirement from MUST_HAVE.md.

Output: ProfileViewer component, DataDeletionModal component, and Settings page integration.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/MUST_HAVE.md
@.planning/phases/08.1-adaptive-intelligence/08.1-01-SUMMARY.md

# UI patterns to follow:
@src/pages/Settings.tsx
@src/components/ConflictCard.tsx
@DESIGN_SYSTEM.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ProfileViewer component</name>
  <files>src/components/ProfileViewer.tsx</files>
  <action>
Create a component that displays all stored profile data with edit capability:

```typescript
import { useState } from 'react';
import { motion } from 'framer-motion';
import { User, Settings, Brain, Trash2, Edit2, Save, X } from 'lucide-react';
import { cn } from '@/lib/utils';
import { Button } from '@/components/ui/button';
import { Badge } from '@/components/ui/badge';
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from '@/components/ui/select';
import { UserProfile, UserMode, OptimizationDepth, CommunicationStyle } from '@/types/profile';

interface ProfileViewerProps {
  profile: UserProfile | null;
  onUpdate: (updates: Partial<UserProfile>) => Promise<void>;
  onDelete: () => void;
  loading?: boolean;
}

export function ProfileViewer({
  profile,
  onUpdate,
  onDelete,
  loading
}: ProfileViewerProps) {
  const [editing, setEditing] = useState(false);
  const [pendingChanges, setPendingChanges] = useState<Partial<UserProfile>>({});

  if (!profile) {
    return <EmptyProfileState />;
  }

  return (
    <motion.div
      initial={{ opacity: 0, y: 12 }}
      animate={{ opacity: 1, y: 0 }}
      className="space-y-4"
    >
      {/* Preferences Section */}
      <div className="glass rounded-xl p-4 border border-border/30">
        <div className="flex items-center justify-between mb-4">
          <div className="flex items-center gap-2">
            <Settings className="w-5 h-5 text-primary" />
            <h3 className="text-sm font-medium">Your Preferences</h3>
          </div>
          <Button
            variant="ghost"
            size="sm"
            onClick={() => setEditing(!editing)}
          >
            {editing ? <X className="w-4 h-4" /> : <Edit2 className="w-4 h-4" />}
          </Button>
        </div>

        <div className="space-y-3">
          <PreferenceRow
            label="User Mode"
            value={profile.userMode}
            editing={editing}
            options={['simple', 'standard', 'power']}
            descriptions={{
              simple: 'Safer optimizations, plain language',
              standard: 'Balanced approach (recommended)',
              power: 'Full control, all options unlocked'
            }}
            onChange={(v) => setPendingChanges(prev => ({ ...prev, userMode: v as UserMode }))}
          />
          <PreferenceRow
            label="Optimization Depth"
            value={profile.optimizationDepth}
            editing={editing}
            options={['efficient', 'thorough', 'optimised']}
            descriptions={{
              efficient: 'Quick, minimal questions',
              thorough: 'Balanced analysis',
              optimised: 'Maximum detail, best results'
            }}
            onChange={(v) => setPendingChanges(prev => ({ ...prev, optimizationDepth: v as OptimizationDepth }))}
          />
          <PreferenceRow
            label="Communication Style"
            value={profile.communicationStyle}
            editing={editing}
            options={['informative', 'concise']}
            descriptions={{
              informative: 'Explains the why behind changes',
              concise: 'Just the facts, faster interactions'
            }}
            onChange={(v) => setPendingChanges(prev => ({ ...prev, communicationStyle: v as CommunicationStyle }))}
          />
        </div>

        {editing && Object.keys(pendingChanges).length > 0 && (
          <div className="flex justify-end gap-2 mt-4 pt-4 border-t border-border/30">
            <Button variant="outline" size="sm" onClick={() => {
              setPendingChanges({});
              setEditing(false);
            }}>
              Cancel
            </Button>
            <Button size="sm" onClick={async () => {
              await onUpdate(pendingChanges);
              setPendingChanges({});
              setEditing(false);
            }}>
              <Save className="w-4 h-4 mr-1" />
              Save Changes
            </Button>
          </div>
        )}
      </div>

      {/* Learned Patterns Section */}
      <div className="glass rounded-xl p-4 border border-border/30">
        <div className="flex items-center gap-2 mb-4">
          <Brain className="w-5 h-5 text-primary" />
          <h3 className="text-sm font-medium">What Opta Has Learned</h3>
        </div>

        {profile.patterns.length === 0 ? (
          <p className="text-sm text-muted-foreground">
            No patterns detected yet. Use Opta more to see personalized insights.
          </p>
        ) : (
          <div className="space-y-2">
            {profile.patterns.map((pattern, i) => (
              <PatternCard key={i} pattern={pattern} />
            ))}
          </div>
        )}
      </div>

      {/* Statistics Section */}
      <div className="glass rounded-xl p-4 border border-border/30">
        <div className="flex items-center gap-2 mb-4">
          <User className="w-5 h-5 text-primary" />
          <h3 className="text-sm font-medium">Your Stats</h3>
        </div>

        <div className="grid grid-cols-2 gap-4 text-sm">
          <StatItem label="Total Optimizations" value={profile.totalOptimizations} />
          <StatItem label="Games Optimized" value={profile.totalGamesOptimized} />
          <StatItem label="Accepted" value={profile.optimizationsAccepted} />
          <StatItem label="Reverted" value={profile.optimizationsReverted} />
          <StatItem label="Member Since" value={formatDate(profile.createdAt)} />
        </div>
      </div>

      {/* Delete Data Section */}
      <div className="glass rounded-xl p-4 border border-danger/30 bg-danger/5">
        <div className="flex items-center justify-between">
          <div>
            <h3 className="text-sm font-medium text-danger">Delete All Data</h3>
            <p className="text-xs text-muted-foreground mt-1">
              Remove all stored preferences, patterns, and history
            </p>
          </div>
          <Button variant="destructive" size="sm" onClick={onDelete}>
            <Trash2 className="w-4 h-4 mr-1" />
            Delete
          </Button>
        </div>
      </div>
    </motion.div>
  );
}
```

Follow DESIGN_SYSTEM.md strictly:
- Glass effects for all containers
- Framer Motion animations
- Lucide icons only
- Proper color semantics (danger for delete)
  </action>
  <verify>npm run build passes, component renders all profile sections</verify>
  <done>ProfileViewer component displays preferences, patterns, stats, and delete option</done>
</task>

<task type="auto">
  <name>Task 2: Create DataDeletionModal component</name>
  <files>src/components/DataDeletionModal.tsx</files>
  <action>
Create a confirmation modal for data deletion:

```typescript
import { motion, AnimatePresence } from 'framer-motion';
import { AlertTriangle, Trash2 } from 'lucide-react';
import { Button } from '@/components/ui/button';
import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogFooter,
  DialogHeader,
  DialogTitle,
} from '@/components/ui/dialog';

interface DataDeletionModalProps {
  open: boolean;
  onOpenChange: (open: boolean) => void;
  onConfirm: () => Promise<void>;
  loading?: boolean;
}

export function DataDeletionModal({
  open,
  onOpenChange,
  onConfirm,
  loading
}: DataDeletionModalProps) {
  return (
    <Dialog open={open} onOpenChange={onOpenChange}>
      <DialogContent className="glass">
        <DialogHeader>
          <div className="flex items-center gap-2 text-danger">
            <AlertTriangle className="w-5 h-5" />
            <DialogTitle>Delete All Data?</DialogTitle>
          </div>
          <DialogDescription className="text-left">
            This will permanently delete:
            <ul className="list-disc list-inside mt-2 space-y-1 text-sm">
              <li>Your preferences (mode, depth, style)</li>
              <li>All learned patterns and insights</li>
              <li>Optimization history and choices</li>
              <li>Statistics and member data</li>
            </ul>
            <p className="mt-3 font-medium">
              This action cannot be undone.
            </p>
          </DialogDescription>
        </DialogHeader>
        <DialogFooter className="gap-2">
          <Button
            variant="outline"
            onClick={() => onOpenChange(false)}
            disabled={loading}
          >
            Cancel
          </Button>
          <Button
            variant="destructive"
            onClick={async () => {
              await onConfirm();
              onOpenChange(false);
            }}
            disabled={loading}
          >
            {loading ? (
              'Deleting...'
            ) : (
              <>
                <Trash2 className="w-4 h-4 mr-1" />
                Delete Everything
              </>
            )}
          </Button>
        </DialogFooter>
      </DialogContent>
    </Dialog>
  );
}
```

Modal should:
- Clearly list what will be deleted
- Require explicit confirmation
- Show loading state during deletion
- Close automatically after successful deletion
  </action>
  <verify>npm run build passes, modal opens and closes correctly</verify>
  <done>DataDeletionModal provides clear confirmation flow with loading states</done>
</task>

<task type="auto">
  <name>Task 3: Integrate into Settings page</name>
  <files>src/pages/Settings.tsx</files>
  <action>
Add the transparency panel to Settings page:

1. Import components and hook:
```typescript
import { ProfileViewer } from '@/components/ProfileViewer';
import { DataDeletionModal } from '@/components/DataDeletionModal';
import { useUserProfile } from '@/hooks/useUserProfile';
```

2. Add state and handlers:
```typescript
const { profile, loading: profileLoading, updateProfile, deleteProfile } = useUserProfile();
const [showDeleteModal, setShowDeleteModal] = useState(false);
const [deleteLoading, setDeleteLoading] = useState(false);

const handleDelete = async () => {
  setDeleteLoading(true);
  try {
    await deleteProfile();
  } finally {
    setDeleteLoading(false);
  }
};
```

3. Add new section to Settings page layout (after existing sections):
```tsx
{/* Your Profile Section */}
<section className="space-y-4">
  <div className="flex items-center gap-2">
    <User className="w-5 h-5 text-primary" />
    <h2 className="text-lg font-semibold">Your Profile</h2>
  </div>
  <p className="text-sm text-muted-foreground">
    View and manage all data Opta has stored about you
  </p>

  <ProfileViewer
    profile={profile}
    onUpdate={updateProfile}
    onDelete={() => setShowDeleteModal(true)}
    loading={profileLoading}
  />
</section>

<DataDeletionModal
  open={showDeleteModal}
  onOpenChange={setShowDeleteModal}
  onConfirm={handleDelete}
  loading={deleteLoading}
/>
```

4. Ensure the section follows existing Settings page styling patterns.

Location in Settings page: After "Privacy" section, before any existing footer content.
  </action>
  <verify>npm run build passes, Settings page shows profile section with all functionality</verify>
  <done>Transparency panel fully integrated into Settings page</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] `cargo build` succeeds without errors
- [ ] ProfileViewer shows all profile data
- [ ] Preferences can be edited and saved
- [ ] Learned patterns are displayed with descriptions
- [ ] Statistics show accurate counts
- [ ] Delete button opens confirmation modal
- [ ] Deletion removes all data from ~/.opta/profiles/
</verification>

<success_criteria>
- All tasks completed
- Users can view all stored data
- Users can edit preferences (mode, depth, style)
- Users can delete all data with confirmation
- UI follows design system (glass, animations, icons)
- Empty states handled gracefully
- Trust-building: everything is visible and controllable
</success_criteria>

<output>
After completion, create `.planning/phases/08.1-adaptive-intelligence/08.1-04-SUMMARY.md`
</output>
