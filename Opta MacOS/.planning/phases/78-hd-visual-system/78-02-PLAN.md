# Plan 78-02: Theme, Presets & Accessibility

## Metadata

```yaml
phase: 78
plan: 02
name: Theme, Presets & Accessibility
status: ready
wave: 1
autonomous: true
estimated_effort: medium
```

## Objective

Establish a consistent color temperature system, create performance-optimized effect presets, implement accessibility modes, and document the motion design language for the HD visual system.

## Execution Context

Reference files:
- `opta-native/opta-render/src/adaptive.rs` - Adaptive quality system from Phase 77
- `opta-native/opta-render/src/components/ring.rs` - RingQualityLevel, spring physics
- `opta-native/opta-render/shaders/includes/color.wgsl` - Existing color utilities
- `opta-native/OptaApp/OptaApp/Views/Settings/ThemeCustomizationView.swift` - Theme settings

## Context

Phase 77 established the adaptive quality system with frame budget tracking. Phase 78-01 adds HD glass panels and glow effects. This plan creates the theming infrastructure to ensure visual consistency across all components, provides presets for different performance tiers, and adds accessibility support.

## Tasks

### Task 1: Color Temperature System
**Goal**: Create color_temperature.rs for consistent theming across app states

**Implementation**:
1. Create `opta-native/opta-render/src/theme/mod.rs` module
2. Create `opta-native/opta-render/src/theme/color_temperature.rs`
3. Define `ColorTemperature` enum:
   - `Dormant` - Deep obsidian blacks, colorless
   - `Idle` - Cool grays, subtle hints
   - `Active` - Vibrant Opta purple (#8B5CF6)
   - `Processing` - Energized purple-blue
   - `Alert` - Warning amber/red states
4. Define `TemperatureColors` struct with:
   - `primary: [f32; 3]` - Main accent color
   - `glow: [f32; 3]` - Glow/emission color
   - `background: [f32; 3]` - Background tint
   - `text: [f32; 3]` - Text/UI color
5. Implement `get_colors(temperature: ColorTemperature) -> TemperatureColors`
6. Add color interpolation for smooth temperature transitions
7. Add `temperature_from_energy(energy: f32) -> ColorTemperature`

**Files**:
- Create: `opta-native/opta-render/src/theme/mod.rs`
- Create: `opta-native/opta-render/src/theme/color_temperature.rs`
- Modify: `opta-native/opta-render/src/lib.rs` (add module)

**Verification**: `cargo build -p opta-render` succeeds

---

### Task 2: Effect Presets System
**Goal**: Create preset configurations optimizing for different performance tiers

**Implementation**:
1. Create `opta-native/opta-render/src/theme/presets.rs`
2. Define `EffectPreset` enum:
   - `Performance` - Minimal effects, 60fps guaranteed
   - `Balanced` - Good effects, 60fps target
   - `Quality` - Full effects, 60fps preferred
   - `Ultra` - Maximum quality, 120Hz capable
3. Define `PresetConfig` struct with:
   - `ring_quality: RingQualityLevel`
   - `panel_quality: PanelQualityLevel`
   - `bloom_enabled: bool`
   - `bloom_quality: QualityLevel`
   - `glow_enabled: bool`
   - `particle_density: f32` (0.0-1.0)
   - `blur_samples_multiplier: f32`
4. Implement `get_preset(preset: EffectPreset) -> PresetConfig`
5. Add `preset_for_device()` - auto-detect based on GPU capabilities
6. Add `preset_from_adaptive(quality: QualityLevel) -> EffectPreset`

**Files**:
- Create: `opta-native/opta-render/src/theme/presets.rs`
- Modify: `opta-native/opta-render/src/theme/mod.rs` (exports)

**Verification**: All preset configurations compile and have reasonable defaults

---

### Task 3: Accessibility Mode - Reduced Motion
**Goal**: Implement reduced motion support for motion-sensitive users

**Implementation**:
1. Create `opta-native/opta-render/src/accessibility/mod.rs`
2. Create `opta-native/opta-render/src/accessibility/motion.rs`
3. Define `MotionPreference` enum:
   - `Full` - All animations enabled
   - `Reduced` - Minimize non-essential motion
   - `None` - Static, no animations
4. Create `ReducedMotionConfig` struct:
   - `disable_ring_spin: bool`
   - `disable_particle_motion: bool`
   - `disable_glow_pulse: bool`
   - `use_fade_transitions: bool` (instead of movement)
   - `animation_duration_multiplier: f32`
5. Add `respects_system_preference()` - hook for OS setting
6. Modify spring physics to support `instant_snap` mode
7. Add `apply_to_ring(config: &ReducedMotionConfig, ring: &mut OptaRing)`

**Files**:
- Create: `opta-native/opta-render/src/accessibility/mod.rs`
- Create: `opta-native/opta-render/src/accessibility/motion.rs`
- Modify: `opta-native/opta-render/src/lib.rs` (add module)

**Verification**: Reduced motion config disables appropriate animations

---

### Task 4: Accessibility Mode - High Contrast
**Goal**: Implement high contrast mode for visibility

**Implementation**:
1. Create `opta-native/opta-render/src/accessibility/contrast.rs`
2. Define `ContrastPreference` enum:
   - `Normal` - Standard visual appearance
   - `High` - Increased contrast, solid colors
   - `Inverted` - Dark on light (rare, for specific needs)
3. Create `HighContrastConfig` struct:
   - `use_solid_backgrounds: bool` (disable glass blur)
   - `increase_border_width: f32`
   - `increase_text_contrast: bool`
   - `simplify_glow_effects: bool`
   - `color_override: Option<TemperatureColors>`
4. Add `apply_to_panel(config: &HighContrastConfig, panel: &mut GlassPanel)`
5. Add contrast ratio calculation utilities
6. Ensure minimum 4.5:1 contrast for text elements

**Files**:
- Create: `opta-native/opta-render/src/accessibility/contrast.rs`
- Modify: `opta-native/opta-render/src/accessibility/mod.rs` (exports)

**Verification**: High contrast mode produces visible solid backgrounds

---

### Task 5: WGSL Color Utilities Enhancement
**Goal**: Enhance color.wgsl with temperature and accessibility utilities

**Implementation**:
1. Update `opta-native/opta-render/shaders/includes/color.wgsl`
2. Add `ColorTemperature` uniforms binding option
3. Add `temperature_blend()` - interpolate between temperature colors
4. Add `apply_contrast_boost()` - increase contrast for accessibility
5. Add `desaturate()` - for reduced color mode
6. Add `luminance_adjust()` - brightness compensation
7. Add `high_contrast_edge()` - solid edge detection fallback

**Files**:
- Modify: `opta-native/opta-render/shaders/includes/color.wgsl`

**Verification**: WGSL compiles without errors

---

### Task 6: Visual System Tests
**Goal**: Comprehensive tests for theme and accessibility systems

**Implementation**:
1. Add theme module tests:
   - `test_color_temperature_colors` - each temperature has distinct colors
   - `test_temperature_interpolation` - smooth transitions
   - `test_temperature_from_energy` - energy maps correctly
2. Add preset tests:
   - `test_preset_quality_levels` - presets have valid quality
   - `test_performance_preset_minimal` - performance has minimal effects
   - `test_ultra_preset_full` - ultra has all effects enabled
3. Add accessibility tests:
   - `test_reduced_motion_disables_spin` - spin disabled when reduced
   - `test_high_contrast_solid_bg` - glass becomes solid
   - `test_contrast_ratio_minimum` - meets WCAG AA

**Files**:
- Create: `opta-native/opta-render/tests/theme_test.rs`
- Create: `opta-native/opta-render/tests/accessibility_test.rs`

**Verification**: `cargo test -p opta-render` passes all new tests

---

## Verification

```bash
# Build the library
cargo build --release -p opta-render

# Run all tests
cargo test -p opta-render

# Verify new modules exported
cargo doc -p opta-render --open
```

## Success Criteria

- [ ] Color temperature system with 5 states implemented
- [ ] Effect presets for 4 performance tiers defined
- [ ] Reduced motion accessibility mode working
- [ ] High contrast accessibility mode working
- [ ] Enhanced color.wgsl utilities added
- [ ] All tests pass (~15 new tests)
- [ ] `cargo build --release -p opta-render` succeeds

## Output

On completion:
1. Create `78-02-SUMMARY.md` with commits and verification results
2. Theme system ready for SwiftUI integration
3. Accessibility modes available for system preference hooks
4. Complete visual system foundation for Phase 79+
