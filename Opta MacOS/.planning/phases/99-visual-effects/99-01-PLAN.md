# Phase 99-01: Visual Effects (Particles & Celebrations)

**Version**: 12.0
**Status**: In Progress
**Created**: 2026-01-26

---

## Overview

Enhance the visual effects system with proper macOS-native particle effects, achievement celebration animations, atmospheric ambience, and energy field effects for the Opta Ring.

---

## Current State Analysis

### ParticleEffectView
- Basic particle system exists using SwiftUI Canvas/TimelineView
- Has UIScreen stub (iOS compatibility issue)
- Limited effect types (confetti, fireworks, snow, energyField)
- No external trigger mechanism for celebrations
- Energy field doesn't track actual ring position

### GamificationDashboard
- Placeholder only ("Coming Soon")
- No badge/achievement unlocking system
- No celebration triggers

---

## Deliverables

### 1. Enhanced Particle System
- [ ] Fix macOS compatibility (remove UIScreen stub)
- [ ] Add proper GeometryReader integration
- [ ] Add performance-adaptive particle count
- [ ] Add reduced motion accessibility support

### 2. CelebrationService
- [ ] Singleton service for triggering effects
- [ ] Support confetti, fireworks, sparkles effects
- [ ] Duration and intensity controls
- [ ] Integration with app events

### 3. Achievement Celebration Effects
- [ ] Badge unlock animation
- [ ] Score milestone celebration
- [ ] Streak achievement effect
- [ ] Trophy animation for major unlocks

### 4. Atmospheric Particles
- [ ] Subtle floating particles for dashboard
- [ ] Energy-responsive intensity
- [ ] Color temperature integration
- [ ] Obsidian-themed particle colors

### 5. Ring Energy Field
- [ ] Orbiting particles around ring center
- [ ] Activity-based particle count
- [ ] Pulsing glow effect
- [ ] Integration with optimization state

---

## Implementation Plan

### Task 1: CelebrationService

```swift
// CelebrationService.swift
@Observable @MainActor
class CelebrationService {
    static let shared = CelebrationService()

    var activeEffect: CelebrationEffect?
    var effectPosition: CGPoint = .zero

    func celebrate(_ type: CelebrationType, at position: CGPoint?)
    func dismiss()
}

enum CelebrationType {
    case badgeUnlock(String)
    case scoreMilestone(Int)
    case achievement
    case optimization
}
```

### Task 2: Enhanced ParticleEffectView

```swift
// Improvements:
- GeometryReader for proper sizing
- NSScreen instead of UIScreen stub
- @Environment(\.accessibilityReduceMotion)
- Configurable maxParticles for performance
```

### Task 3: CelebrationOverlay

```swift
// Global overlay view for celebrations
struct CelebrationOverlay: View {
    @State var celebrationService = CelebrationService.shared

    // Positioned at window level
    // Triggers particles on service events
}
```

### Task 4: Obsidian Particle Colors

```swift
// Particle color palettes matching design system
static let obsidianPalette: [Color] = [
    Color.optaNeonPurple,
    Color.optaElectricBlue,
    Color(hex: 0xA855F7), // Light violet
    Color(hex: 0x7C3AED), // Medium violet
    Color.white.opacity(0.8)
]
```

---

## Technical Notes

- Canvas+TimelineView approach is performant (no wgpu needed for 2D)
- Keep particle count under 200 for smooth 60fps
- Use reduced motion to disable or simplify effects
- Celebrations should auto-dismiss after 2-3 seconds

---

## Files to Create/Modify

1. `Services/CelebrationService.swift` - New celebration trigger service
2. `Views/Effects/ParticleEffectView.swift` - Enhance existing
3. `Views/Effects/CelebrationOverlay.swift` - New global overlay
4. `Views/Effects/RingEnergyField.swift` - New ring particles
5. `App.swift` - Add CelebrationOverlay to window

---

## Success Criteria

- [ ] Celebrations trigger on score milestones
- [ ] Particles respect reduced motion preference
- [ ] Energy field responds to optimization activity
- [ ] 60fps performance with 100+ particles
- [ ] Obsidian color palette throughout
