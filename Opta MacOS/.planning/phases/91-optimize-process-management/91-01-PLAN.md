# Plan: Optimize Page UI

---
phase: 91
plan: 01
title: Optimize Page UI
wave: 1
autonomous: true
---

## Objective

Build the **OptimizeView** — the core optimization page that displays system health, one-click Stealth Mode, before/after comparison, and resource breakdown. This is the primary value proposition of Opta.

## Execution Context

- **Project root**: `/Users/matthewbyrden/Documents/Opta/opta-native`
- **SwiftUI views**: `OptaApp/OptaApp/Views/`
- **View model**: `OptaApp/OptaApp/Models/OptaViewModel.swift`
- **Core manager**: `OptaApp/OptaApp/Managers/OptaCoreManager.swift`
- **App entry**: `OptaApp/OptaApp/OptaAppApp.swift`
- **Design**: Obsidian base (#0A0A0F) + Electric Violet (#8B5CF6) accent, color temperature environment

## Context

### What Exists

**Rust Core (ready)**:
- `ProcessState` with processes, selected_pids, stealth_mode_active, last_stealth_result
- `Event::ExecuteStealthMode` → triggers stealth, ring goes to Optimizing phase
- `Event::StealthModeCompleted` → updates result, ring celebrates, shows toast
- `Effect::stealth_mode()` and `Effect::collect_telemetry()` for data flow
- `ProcessFilter` with search, min_cpu, only_killable, sort_by, sort_ascending

**Swift ViewModel (ready)**:
- `viewModel.stealthModeActive: Bool`
- `viewModel.lastStealthResult: StealthResultViewModel?` (terminatedCount, memoryFreedMb)
- `viewModel.cpuUsage`, `memoryUsage`, `gpuUsage` — live telemetry
- `viewModel.processCount` — number of running processes
- `viewModel.optaScore` and `scoreGrade` — current scoring
- `viewModel.thermalState` and `memoryPressure` — system health

**SwiftUI Patterns (follow)**:
- `DashboardView` uses `@Bindable var coreManager: OptaCoreManager`
- `@Environment(\.colorTemperature)` for violet/obsidian theming
- `@Environment(\.accessibilityReduceMotion)` for motion safety
- `OrganicMotion` for spring animations
- `OptaTextZone` for contextual status messages
- `TelemetryCard` for metric display cards

**Navigation**:
- `PageViewModel.optimize` exists in enum
- `OptaAppApp.swift` line 173 currently shows placeholder
- `CircularMenuDestination.optimize` maps to `PageViewModel.optimize`

### What Needs Building

An `OptimizeView.swift` that replaces the placeholder and provides:
1. System health summary (CPU, Memory, GPU, Thermal)
2. One-click "Optimize Now" button triggering Stealth Mode
3. Before/after comparison when optimization completes
4. Resource breakdown showing what will be/was optimized
5. Score impact display

## Tasks

### Task 1: Create OptimizeView.swift

**File**: `OptaApp/OptaApp/Views/OptimizeView.swift`

Create the main optimize view with this layout:
- **Header**: "Optimize" title with back navigation
- **Hero Section**: Large "Optimize Now" button with ring energy glow
  - Shows ProgressView when `stealthModeActive`
  - Button dispatches `.executeStealthMode` event
  - Disabled state when already optimizing
- **System Health Cards**: 2x2 grid showing CPU, Memory, GPU, Thermal
  - Use existing `TelemetryCard` component or similar card style
  - Shows current values with color-coded status (green/yellow/red)
- **Before/After Section**: Appears when `lastStealthResult` is set
  - Shows terminated process count and memory freed
  - Memory freed in MB with trend arrow
  - Animated reveal using OrganicMotion
- **Score Impact**: Shows optaScore with grade badge
  - Indicates potential improvement after optimization
- **Process Summary**: Shows processCount with link to Processes view
  - "View All Processes" button navigates to `.processes` page

**Pattern to follow**: DashboardView's structure with sections, `@Bindable var coreManager`, color temperature environment, obsidian backgrounds.

**Key implementation details**:
```swift
struct OptimizeView: View {
    @Bindable var coreManager: OptaCoreManager
    @Environment(\.colorTemperature) private var colorTemp
    @Environment(\.accessibilityReduceMotion) private var reduceMotion

    // Obsidian constants matching DashboardView
    private let obsidianBase = Color(hex: "0A0A0F")
    private let horizontalPadding: CGFloat = 24
}
```

### Task 2: Build Optimize Button Component

**File**: Within `OptimizeView.swift` (private subview)

Create `optimizeButton` computed property:
- Large circular or rounded-rect button
- Background: obsidian with violet border glow (colorTemp.violetColor)
- Icon: "bolt.fill" with energy pulsing animation
- States:
  - **Idle**: "Optimize Now" with violet accent
  - **Optimizing**: Spinning ProgressView with "Optimizing..." text
  - **Complete**: Checkmark with "Optimized!" that auto-resets
- Animation: organicSpring for state transitions
- Haptic: Dispatch triggers haptic via Crux effects

### Task 3: Build Before/After Result View

**File**: Within `OptimizeView.swift` (private subview)

Create `resultSection` computed property:
- Only visible when `lastStealthResult != nil`
- Two-column layout:
  - Left: "Processes Terminated" with count
  - Right: "Memory Freed" with MB value
- Uses obsidian card with violet glow border
- Animated entrance using `.organicAppear()` or spring
- Trend indicators (up arrow for improvement)

### Task 4: Wire OptimizeView into App Navigation

**File**: `OptaApp/OptaApp/OptaAppApp.swift`

Replace the `.optimize` placeholder case (line ~173) with:
```swift
case .optimize:
    OptimizeView(coreManager: coreManager)
```

Remove the `placeholderView(title: "Optimize", ...)` call.

### Task 5: Add ViewModel Extensions for Optimize

**File**: `OptaApp/OptaApp/Models/OptaViewModel.swift`

Add computed properties to `OptaViewModel`:
```swift
/// Overall system health status for optimize view
var systemHealthStatus: String {
    if thermalState == .critical || memoryPressure == .critical {
        return "Needs Optimization"
    } else if thermalState == .serious || memoryPressure == .warning {
        return "Could Improve"
    } else {
        return "Running Well"
    }
}

/// Whether optimization is recommended
var optimizationRecommended: Bool {
    cpuUsage > 70 || memoryUsage > 80 || thermalState != .nominal
}
```

## Verification

1. Build succeeds: `xcodebuild build -project OptaApp.xcodeproj -scheme OptaApp`
2. OptimizeView displays when navigating to Optimize via circular menu
3. "Optimize Now" button dispatches `.executeStealthMode` event
4. Loading state shows during optimization
5. Before/after section appears after optimization completes
6. Back navigation returns to dashboard
7. Color temperature environment drives violet accents
8. Accessibility: reduced motion disables animations, VoiceOver labels present

## Success Criteria

- [ ] OptimizeView.swift created with full layout
- [ ] Placeholder in OptaAppApp.swift replaced
- [ ] Optimize button triggers Stealth Mode via Crux
- [ ] Before/after result displays after completion
- [ ] System health cards show live telemetry
- [ ] Obsidian + violet aesthetic with color temperature
- [ ] Reduced motion support
- [ ] Build compiles without errors

## Output

- `OptaApp/OptaApp/Views/OptimizeView.swift` — New optimize page view
- `OptaApp/OptaApp/OptaAppApp.swift` — Updated navigation switch
- `OptaApp/OptaApp/Models/OptaViewModel.swift` — Health status computed properties
