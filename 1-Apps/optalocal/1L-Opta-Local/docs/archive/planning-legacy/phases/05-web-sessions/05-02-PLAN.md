---
phase: 05-web-sessions
plan: 02
type: execute
wave: 2
depends_on: ["05-01"]
files_modified:
  - 1-Apps/1L-Opta-Local/web/package.json
  - 1-Apps/1L-Opta-Local/web/src/hooks/useSessions.ts
  - 1-Apps/1L-Opta-Local/web/src/components/sessions/SessionList.tsx
  - 1-Apps/1L-Opta-Local/web/src/components/sessions/SessionCard.tsx
  - 1-Apps/1L-Opta-Local/web/src/components/sessions/SessionSearch.tsx
  - 1-Apps/1L-Opta-Local/web/src/app/sessions/page.tsx
autonomous: true
status: review
---

<objective>
Build the session list page with search, filtering, and virtual scrolling.

Purpose: Create a browsable, searchable list of CLI sessions that users can view and select for resuming in the browser.
Output: /sessions page with virtual-scrolled session list, fuzzy search via Fuse.js, and filtering by model/tags/date.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-web-sessions/05-RESEARCH.md
@.planning/phases/05-web-sessions/05-01-SUMMARY.md

# LMX session types (from 05-01):
# GET /admin/sessions returns SessionListResponse { sessions: SessionSummary[], total: number }

# Existing types and client:
@1-Apps/1L-Opta-Local/web/src/types/lmx.ts
@1-Apps/1L-Opta-Local/web/src/lib/lmx-client.ts

# Design rules:
@1-Apps/1L-Opta-Local/web/CLAUDE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install dependencies and create sessions data hook</name>
  <files>
    1-Apps/1L-Opta-Local/web/package.json,
    1-Apps/1L-Opta-Local/web/src/hooks/useSessions.ts,
    1-Apps/1L-Opta-Local/web/src/types/lmx.ts
  </files>
  <action>
    1. Install session dependencies:
       ```bash
       cd 1-Apps/1L-Opta-Local/web && pnpm add fuse.js @tanstack/react-virtual date-fns
       ```

    2. Add session types to `src/types/lmx.ts`:
       - SessionSummary: { id, title, model, tags: string[], created: string, updated: string, message_count: number }
       - SessionMessage: { role, content: string | ContentPart[] | null, tool_calls?: ToolCall[], tool_call_id?: string }
       - SessionFull: { id, title, model, tags, created, updated, cwd, messages: SessionMessage[], tool_call_count, compacted }
       - ContentPart: { type: 'text', text: string } | { type: 'image_url', image_url: { url: string } }
       - ToolCall: { id: string, type: 'function', function: { name: string, arguments: string } }
       - Add getSessions() and getSession(id) methods to LMXClient class

    3. Create `src/hooks/useSessions.ts` ('use client'):
       - Uses SWR to fetch session list from LMXClient.getSessions()
       - Refresh interval: 30 seconds (new sessions may appear from CLI usage)
       - Revalidate on focus: true
       - Integrates Fuse.js for client-side search:
         - Keys: title (weight 0.4), model (0.2), tags (0.3), id (0.1)
         - Threshold: 0.4
       - Filter functions: byModel(model), byTag(tag), bySince(date)
       - Returns { sessions, filteredSessions, isLoading, error, search, setModelFilter, setTagFilter, refresh }
       - See 05-RESEARCH.md Pattern 3 and Pattern 4 for implementation details
  </action>
  <verify>pnpm run build passes; fuse.js, @tanstack/react-virtual, date-fns resolve; useSessions hook compiles</verify>
  <done>Session types added; useSessions hook fetches from LMX with SWR caching and Fuse.js search</done>
</task>

<task type="auto">
  <name>Task 2: Create session list components and /sessions page</name>
  <files>
    1-Apps/1L-Opta-Local/web/src/components/sessions/SessionCard.tsx,
    1-Apps/1L-Opta-Local/web/src/components/sessions/SessionSearch.tsx,
    1-Apps/1L-Opta-Local/web/src/components/sessions/SessionList.tsx,
    1-Apps/1L-Opta-Local/web/src/app/sessions/page.tsx
  </files>
  <action>
    1. Create `src/components/sessions/SessionCard.tsx` ('use client'):
       - Props: { session: SessionSummary, onResume: (id: string) => void, onDelete?: (id: string) => void }
       - Glass card showing: title, model name (Badge), relative date (date-fns formatDistanceToNow), message count, tags
       - Truncate title to 60 chars, model to 30 chars
       - Relative date: "2 hours ago", "Yesterday", "3 days ago"
       - Tags as small Badge components
       - Click to resume (navigates to /chat/[id])
       - Delete button (Lucide Trash2, ghost variant, confirm before delete)
       - AnimatePresence for smooth list transitions on delete
       - Lucide icons: MessageSquare (message count), Clock (date), Tag (tags)

    2. Create `src/components/sessions/SessionSearch.tsx` ('use client'):
       - Search input with glass-subtle background and Lucide Search icon
       - Debounced input (300ms) that calls the search function from useSessions
       - Filter chips below search: model filter dropdown, tag filter, date range (since)
       - Clear all filters button
       - Show result count: "12 sessions" or "3 results for 'pytorch'"

    3. Create `src/components/sessions/SessionList.tsx` ('use client'):
       - Uses @tanstack/react-virtual useVirtualizer for virtual scrolling
       - Renders SessionCard for each visible session
       - Estimated row height: 100px (adjustable)
       - Overscan: 5 items
       - Empty state: "No sessions found" with different messages for no sessions vs no search results
       - Loading state: skeleton cards

    4. Create `src/app/sessions/page.tsx`:
       - Integrates useSessions, SessionSearch, SessionList
       - Page title: "Sessions — Opta Local"
       - Full-height layout: search at top, virtual list fills remaining space
       - Navigation via router.push to /chat/[id] on resume
  </action>
  <verify>pnpm run build passes; /sessions page renders with search bar and session list (will show empty state if no CLI sessions exist on Mac Studio)</verify>
  <done>Sessions page shows virtual-scrolled list with fuzzy search, model/tag filtering, relative dates, and delete functionality</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `cd 1-Apps/1L-Opta-Local/web && pnpm run build` succeeds without errors
- [ ] /sessions page renders with search bar and list
- [ ] Fuse.js search filters sessions in real-time
- [ ] Virtual scrolling works (test with browser DevTools → Performance)
- [ ] Session cards show relative dates, model badges, and tags
- [ ] Delete button removes session (calls LMX API)
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Session list loads from LMX API
- Search and filtering work client-side via Fuse.js
- Virtual scrolling handles large session lists efficiently
- Sessions page follows Opta glass design system
</success_criteria>

<output>
After completion, create `.planning/phases/05-web-sessions/05-02-SUMMARY.md`
</output>
