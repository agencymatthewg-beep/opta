---
phase: 03-web-dashboard
plan: 03
type: execute
wave: 3
depends_on: ["03-02"]
files_modified:
  - 1-Apps/1L-Opta-Local/web/src/components/dashboard/ThroughputChart.tsx
  - 1-Apps/1L-Opta-Local/web/src/components/dashboard/ModelLoadDialog.tsx
  - 1-Apps/1L-Opta-Local/web/src/app/page.tsx
autonomous: true
status: review
---

<objective>
Add throughput time-series chart and model load/unload management to the dashboard.

Purpose: Complete the monitoring dashboard with a live throughput chart (tokens/second over time) and the ability to load/unload models directly from the UI.
Output: Dashboard with throughput chart (Recharts LineChart) using CircularBuffer data, and a model load dialog with VRAM estimation.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-web-dashboard/03-RESEARCH.md
@.planning/phases/03-web-dashboard/03-02-SUMMARY.md

# Dashboard source files from Plan 03-02:
@1-Apps/1L-Opta-Local/web/src/app/page.tsx
@1-Apps/1L-Opta-Local/web/src/components/dashboard/VRAMGauge.tsx
@1-Apps/1L-Opta-Local/web/src/components/dashboard/ModelList.tsx

# Utilities from Plan 03-01:
@1-Apps/1L-Opta-Local/web/src/lib/circular-buffer.ts
@1-Apps/1L-Opta-Local/web/src/hooks/useBufferedState.ts

# Types and client:
@1-Apps/1L-Opta-Local/web/src/types/lmx.ts
@1-Apps/1L-Opta-Local/web/src/lib/lmx-client.ts

# Design rules:
@1-Apps/1L-Opta-Local/web/CLAUDE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create throughput time-series chart</name>
  <files>
    1-Apps/1L-Opta-Local/web/src/components/dashboard/ThroughputChart.tsx
  </files>
  <action>
    Create `src/components/dashboard/ThroughputChart.tsx` ('use client'):
    - Props: { data: ThroughputPoint[], averageTps?: number }
    - Uses Recharts: LineChart, Line, XAxis, YAxis, Tooltip, ResponsiveContainer, ReferenceLine
    - ResponsiveContainer width="100%" height={240}
    - X-axis: timestamp formatted as MM:SS (toLocaleTimeString with minute/second)
    - Y-axis: "t/s" suffix
    - Line: monotone interpolation, violet-400 stroke, no dots, strokeWidth 2
    - CRITICAL: Set isAnimationActive={false} AND animationDuration={0} on the Line component — without BOTH, Recharts re-animates from scratch on every data update causing stuttering (see 03-RESEARCH.md Pitfall 3)
    - Optional ReferenceLine for average TPS (dashed, violet-600)
    - Tooltip: glass-style dark background (rgba(9,9,11,0.9)), white/10 border, white text
    - Wrap in @opta/ui Card glass variant with "Throughput" title
    - Empty state: "Waiting for data..." centered text when data is empty
    - See 03-RESEARCH.md "Throughput Time-Series Chart" code example
  </action>
  <verify>pnpm run build passes; ThroughputChart renders without errors with empty data array</verify>
  <done>ThroughputChart renders Recharts LineChart with glass styling, no animation stutter, responsive sizing</done>
</task>

<task type="auto">
  <name>Task 2: Create model load dialog and integrate chart into dashboard</name>
  <files>
    1-Apps/1L-Opta-Local/web/src/components/dashboard/ModelLoadDialog.tsx,
    1-Apps/1L-Opta-Local/web/src/app/page.tsx
  </files>
  <action>
    1. Create `src/components/dashboard/ModelLoadDialog.tsx` ('use client'):
       - A simple glass-styled panel (not a modal dialog) for loading a new model
       - Text input for model path (e.g., "mlx-community/Qwen2.5-Coder-32B-Instruct-4bit")
       - Optional quantization select (4bit, 8bit, or default)
       - Load button that calls LMXClient.loadModel()
       - Loading state: show spinner (Lucide Loader2 with animate-spin)
       - Error state: show error message in red
       - Success: dismiss and let SSE event update the model list automatically
       - Props: { onLoad: (modelPath: string, quantization?: string) => Promise<void>, isLoading: boolean }

    2. Update dashboard page (src/app/page.tsx) to integrate:
       - Add CircularBuffer ref for throughput data (capacity 300 = 5 min at 1/sec)
       - Parse 'throughput' SSE events into the circular buffer
       - Flush chart data to state on 1-second interval (separate from VRAM 500ms flush)
       - Add ThroughputChart to the grid layout (spans full width below other components)
       - Add ModelLoadDialog (toggle visibility with a "Load Model" button in dashboard header)
       - Wire ModelList onUnload to LMXClient.unloadModel()
       - Track unloading model ID for disabled state
       - Complete grid template areas:
         Desktop: "vram models status" / "chart chart chart" / "actions actions actions"
         Tablet: "vram status" / "models models" / "chart chart" / "actions actions"
         Mobile: single column stack
       - Add uptime display and active requests count from ServerStatus
  </action>
  <verify>pnpm run build passes; dashboard shows throughput chart spanning full width; model load button opens the load panel; unload button on models calls LMX API</verify>
  <done>Dashboard complete: VRAM gauge, model list, connection indicator, throughput chart, model load/unload actions — all real-time via SSE</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `cd 1-Apps/1L-Opta-Local/web && pnpm run build` succeeds without errors
- [ ] Throughput chart renders with responsive width
- [ ] Chart updates smoothly without animation stutter
- [ ] Model load dialog accepts model path and triggers load
- [ ] Model unload button calls API and shows loading state
- [ ] Full dashboard layout works across breakpoints
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Dashboard is feature-complete: VRAM gauge, model list, throughput chart, model management, connection status
- No animation stutter on chart updates
- Responsive layout works on desktop, tablet, and mobile
</success_criteria>

<output>
After completion, create `.planning/phases/03-web-dashboard/03-03-SUMMARY.md`
</output>
