---
phase: 03-web-dashboard
plan: 02
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - 1-Apps/1L-Opta-Local/web/src/components/dashboard/VRAMGauge.tsx
  - 1-Apps/1L-Opta-Local/web/src/components/dashboard/ModelList.tsx
  - 1-Apps/1L-Opta-Local/web/src/components/dashboard/ConnectionIndicator.tsx
  - 1-Apps/1L-Opta-Local/web/src/app/page.tsx
autonomous: true
status: review
---

<objective>
Build the VRAM gauge, loaded models list, and connection indicator for the monitoring dashboard.

Purpose: Create the primary dashboard visual components — the animated VRAM circular gauge, the live model list with VRAM usage, and the SSE connection state indicator. Wire them to real-time SSE data.
Output: Dashboard page (root /) showing live VRAM usage gauge, loaded models list, and connection status — all updating in real-time via SSE.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-web-dashboard/03-RESEARCH.md
@.planning/phases/03-web-dashboard/03-01-SUMMARY.md

# Hooks and utilities from Plan 03-01:
@1-Apps/1L-Opta-Local/web/src/hooks/useSSE.ts
@1-Apps/1L-Opta-Local/web/src/hooks/useBufferedState.ts

# Phase 1 types and connection:
@1-Apps/1L-Opta-Local/web/src/types/lmx.ts
@1-Apps/1L-Opta-Local/web/src/lib/connection.ts
@1-Apps/1L-Opta-Local/web/src/app/globals.css

# Design rules:
@1-Apps/1L-Opta-Local/web/CLAUDE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create VRAMGauge and ConnectionIndicator components</name>
  <files>
    1-Apps/1L-Opta-Local/web/src/components/dashboard/VRAMGauge.tsx,
    1-Apps/1L-Opta-Local/web/src/components/dashboard/ConnectionIndicator.tsx
  </files>
  <action>
    1. Create `src/components/dashboard/VRAMGauge.tsx` ('use client'):
       - Props: { usedGB: number, totalGB: number, size?: number }
       - Circular SVG gauge using stroke-dasharray/stroke-dashoffset technique
       - SVG rotated -90deg so fill starts from 12 o'clock position
       - Animated fill via Framer Motion `motion.circle` with spring physics (stiffness: 60, damping: 15)
       - Color transitions: emerald-400 (0-60%), amber-400 (60-80%), red-400 (80-100%) — use CSS variables
       - Background track: rgba(255,255,255,0.08) stroke
       - Center text: used GB (large, bold, Sora) / total GB (small, muted)
       - Wrap in @opta/ui Card glass variant
       - See 03-RESEARCH.md "VRAM Circular Gauge with Framer Motion" code example
       - Do NOT use react-circular-progressbar — custom SVG is ~30 lines with Framer Motion we already ship

    2. Create `src/components/dashboard/ConnectionIndicator.tsx` ('use client'):
       - Props: { state: 'connecting' | 'open' | 'closed' | 'error' }
       - Small pill/badge showing connection state
       - Colors: connecting (amber pulse animation), open (emerald), closed (white/40), error (red)
       - Pulse animation via Framer Motion for connecting state
       - Lucide icons: Wifi (open), WifiOff (closed/error), Loader2 (connecting with spin)
       - Compact design — sits in dashboard header or top-right
  </action>
  <verify>pnpm run build passes; VRAMGauge and ConnectionIndicator render without errors</verify>
  <done>VRAMGauge animates with spring physics and color transitions; ConnectionIndicator shows all 4 states with appropriate icons and colors</done>
</task>

<task type="auto">
  <name>Task 2: Create ModelList and assemble dashboard page</name>
  <files>
    1-Apps/1L-Opta-Local/web/src/components/dashboard/ModelList.tsx,
    1-Apps/1L-Opta-Local/web/src/app/page.tsx
  </files>
  <action>
    1. Create `src/components/dashboard/ModelList.tsx` ('use client'):
       - Props: { models: LoadedModel[], onUnload?: (modelId: string) => void, isUnloading?: string | null }
       - Renders in @opta/ui Card glass variant
       - AnimatePresence with mode="popLayout" for smooth list transitions when models load/unload
       - Each model row: Badge (status), model name, VRAM usage, quantization info
       - Unload button (Button ghost variant, small) — disabled while unloading
       - Empty state: "No models loaded" centered text
       - See 03-RESEARCH.md "Model Load/Unload Card" code example for layout reference

    2. Replace the smoke-test `src/app/page.tsx` with the real dashboard:
       - 'use client' page — the dashboard is the root route (/)
       - Use useSSE hook to connect to LMX /admin/events endpoint with X-Admin-Key header
       - Use useBufferedState for server status (500ms flush interval)
       - Parse SSE events by type: 'status' -> update status, 'model_change' -> refresh models
       - CSS Grid layout: responsive 3-column (desktop) → 2-column (tablet) → 1-column (mobile)
       - Grid areas: VRAM gauge, model list, connection indicator
       - Use Tailwind grid utilities: grid-cols-3 lg:grid-cols-2 sm:grid-cols-1
       - Header with "Opta Local" title, ConnectionIndicator, and nav link to /chat
       - Admin key from connection settings (getConnectionSettings().adminKey)
       - Handle missing admin key: show setup prompt linking to settings
       - See 03-RESEARCH.md "SSE Hook Usage in Dashboard Page" for integration pattern
  </action>
  <verify>pnpm run build passes; dashboard page renders with grid layout; SSE connection attempts to connect (will show 'connecting' or 'error' state if LMX is not running)</verify>
  <done>Dashboard shows live VRAM gauge, model list, and connection status; responsive grid layout works across breakpoints; SSE auto-reconnects on disconnect</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `cd 1-Apps/1L-Opta-Local/web && pnpm run build` succeeds without errors
- [ ] Root page (/) shows dashboard layout, not smoke-test
- [ ] VRAMGauge renders with animated circle
- [ ] ModelList renders with AnimatePresence transitions
- [ ] ConnectionIndicator shows appropriate state
- [ ] Dashboard connects to SSE endpoint (even if LMX is offline, should show error state gracefully)
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Dashboard layout is responsive (3→2→1 columns)
- Real-time SSE data flows to dashboard components
- Graceful handling of offline LMX (no crashes, shows error state)
</success_criteria>

<output>
After completion, create `.planning/phases/03-web-dashboard/03-02-SUMMARY.md`
</output>
