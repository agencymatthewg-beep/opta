# optalocal.com — Design Iteration Workflow

> How to make high-quality changes to the landing page using Gemini + Claude Code (frontend-design plugin).

---

## The Loop

```
Matthew describes change
        ↓
  Opta512 → Gemini 3.1 Pro
  (design direction, copy, spec)
        ↓
  Claude Code + frontend-design plugin
  (implements the component)
        ↓
  npm run build (verify 0 errors)
        ↓
  vercel deploy --prod
        ↓
  Verify live at optalocal.com
        ↓
  Repeat
```

---


## Step 0 — Opta Max ⇄ Opta512 Collaboration Contract (new)

Use this when Matthew wants one conversation with Opta Max but execution on Opta512.

1. **Matthew briefs Opta Max** with UX/UI/aesthetic ask.
2. **Opta Max converts brief** into a structured design prompt (using `OPTA-AESTHETIC-CONTEXT.md`).
3. **Opta Max sends execution packet to Opta512** (Gemini 3.1 design/spec generation + implementation/deploy loop).
4. **Opta512 returns artifacts**: design spec, changed files, build output, deploy URL.
5. **Opta Max reports back** to Matthew with critique + next iteration options.

### Image modifications/generation lane
- Use Gemini-generated **visual direction + prompt packs** first (style-locked to Opta aesthetic).
- Execute image generation/editing in the image-capable lane (Gemini image surface / Nano Banana flow), then commit assets under canonical Opta paths.
- Never ship image assets without: (a) aesthetic compliance check, (b) dark-mode contrast check, (c) size/compression check.

## Step 1 — Describe the Change

Matthew tells Opta512 what to change. Be specific about:
- **What section** (Hero, BenchmarkStrip, Ecosystem, etc.)
- **What to change** (copy, layout, visual, animation, new section)
- **Direction** (e.g. "make it more technical", "add a testimonial", "hero feels too dark")

---

## Step 2 — Gemini Design Brief

Opta512 calls Gemini 3.1 Pro to generate a design spec.

**Model:** `gemini-3.1-pro-preview`
**API Key:** use `GEMINI_API_KEY` environment variable (never hardcode in docs/scripts)

**Prompt template:**

```
You are a senior product designer specialising in developer-tool landing pages.

Context:
- Site: optalocal.com — brand homepage for a local AI infrastructure stack
- Stack: Mac Studio M3 Ultra 512GB, MLX inference, 836GB models, 22.2 tok/s
- Brand: precision engineering, not generic AI SaaS. Dark void aesthetic, Electric Violet (#a855f7), grid textures, JetBrains Mono for stats.
- Current sections: Nav, Hero (technical diagram), Benchmark Strip, Ecosystem (4 apps), Arch Diagram, Model Grid, CLI Preview, Feature Trio, CTA, Footer
- Design rules: no blobs, no gradients-on-white, real data as texture, violet used sparingly

Change requested: [DESCRIBE THE CHANGE]

Provide:
1. Design direction (2-3 sentences on the visual approach)
2. Copy/text (exact strings if applicable)
3. Layout/component spec (structure, what elements, arrangement)
4. Motion/animation notes (if any)
5. Anything to watch out for (anti-patterns to avoid)
```

---

## Step 3 — Codex Implementation

With the Gemini spec in hand, run Codex with `--full-auto` in the project directory.

**Model:** `gpt-5.3-codex` (set in `~/.codex/config.toml`)
**API Key:** `/Users/opta/.config/openai/api_key` (`sk-proj-...`)
**Version:** codex-cli 0.104.0

**Invocation (background, auto-approves all changes):**
```bash
OPENAI_API_KEY=$(cat /Users/opta/.config/openai/api_key) \
codex exec --full-auto \
  "PROMPT_HERE

When completely finished, run:
openclaw system event --text 'Done: optalocal.com update complete' --mode now"
```

**Prompt template for Codex:**
```
You are implementing a design change to optalocal.com — a Next.js 16 static marketing site.

Read CLAUDE.md first for project context, design rules, and component structure.

Design spec (generated by Gemini 3.1 Pro):
[PASTE GEMINI OUTPUT HERE]

Implementation rules:
- Match existing design system (globals.css CSS vars — do not change them)
- "use client" on all components (Framer Motion required)
- No new npm packages unless strictly necessary
- TypeScript strict — 0 errors required
- Framer Motion easing: { duration: 0.6, ease: [0.16, 1, 0.3, 1] }
- Scroll animations: useInView(ref, { once: true, margin: "-100px" })
- After all changes: run `npm run build` and confirm it exits 0

Files likely to modify: [LIST SPECIFIC FILES]
```

**Monitoring:**
```bash
# Check progress
process action:log sessionId:XXX

# Check if done
process action:poll sessionId:XXX
```

---

## Step 4 — Build Verify

```bash
cd /Users/Shared/312/Opta/1-Apps/optalocal/1T-Opta-Home
npm run build
```

Must exit 0 with:
- `✓ Compiled successfully`
- `✓ Generating static pages`
- No TypeScript errors

---

## Step 5 — Deploy

```bash
cd /Users/Shared/312/Opta/1-Apps/optalocal/1T-Opta-Home
vercel deploy --prod --token "$VERCEL_TOKEN"
```

Wait for `Aliased: https://optalocal.com`. Verify with:
```bash
curl -s https://optalocal.com | grep -o "<title>[^<]*</title>"
```

---

## Step 6 — Verify

Quick content check:
```bash
python3 -c "
import subprocess, re
html = subprocess.run(['curl','-s','https://optalocal.com'], capture_output=True, text=True).stdout
# Check for changed content
print(html[:500])
"
```

---

## Reference: Current Sections + Files

| Section | File | Key content |
|---------|------|-------------|
| Nav | `components/Nav.tsx` | Logo, ecosystem links, Sign In, Get Started |
| Hero | `components/Hero.tsx` | Headline, tok/s counter, flow diagram |
| Benchmark Strip | `components/BenchmarkStrip.tsx` | 512GB · 22.2 tok/s · 836GB · 0 cloud · <200ms |
| Ecosystem | `components/Ecosystem.tsx` | Init · LMX · CLI · Accounts cards |
| Arch Diagram | `components/ArchDiagram.tsx` | Local (active) vs Cloud (blocked) |
| Model Grid | `components/ModelGrid.tsx` | Kimi K2.5, MiniMax, Qwen, Llama, DeepSeek |
| CLI Preview | `components/CliPreview.tsx` | Terminal typewriter animation |
| Feature Trio | `components/FeatureTrio.tsx` | Performance · Privacy · Control |
| CTA Block | `components/CtaBlock.tsx` | → init.optalocal.com |
| Footer | `components/Footer.tsx` | Site links, copyright |

---

## Reference: Gemini API

**⚠️ CRITICAL: Gemini 3.1 has ~60s cold-start response time. Always set `--max-time 120`.**

```bash
curl -s --max-time 120 -X POST \
  "https://generativelanguage.googleapis.com/v1beta/models/gemini-3.1-pro-preview:generateContent?key=${GEMINI_API_KEY}" \
  -H "Content-Type: application/json" \
  -d '{"contents": [{"parts": [{"text": "YOUR_PROMPT"}]}]}'
```

**Model confirmed working:** `gemini-3.1-pro-preview` (1M token context, thinking model)  
**Do NOT use:** `gemini-2.0-flash`, `gemini-2.5-pro-preview-05-06` (wrong/unavailable models)  
**List models:** `curl -s "https://generativelanguage.googleapis.com/v1beta/models?key=KEY" | python3 -c "import json,sys; [print(m["name"],"|",m.get("displayName")) for m in json.load(sys.stdin)["models"]]"`

---

## Workflow Notes

- **Gemini first, code second** — never write code before the design direction is clear
- **One section at a time** — smaller changes = easier to verify and rollback
- **Build before deploy** — Codex runs `npm run build` as part of its task; verify exit 0
- **Opta512 orchestrates** — calls Gemini → runs Codex (background) → deploys
- **Matthew reviews** — after deploy, checks live site, describes next change
- **Codex is --full-auto** — no approval prompts, it will write and modify files directly
- **Background spawn** — for large changes, Codex runs as background session; Opta512 monitors and notifies on completion
