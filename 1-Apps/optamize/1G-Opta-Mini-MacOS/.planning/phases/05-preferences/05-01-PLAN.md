---
phase: 05-preferences
plan: 01
subsystem: settings
requires: [app-controls, menu-ui]
provides: [preferences-window, launch-at-login, about-section]
affects: [06-polish]
tags: [settings-scene, launchservices, smloginitem, about]
---

# Plan 05-01: Preferences & About

## Goal

Add a Preferences window with launch-at-login toggle and About section with version info and ecosystem links.

## Tasks

### Task 1: Add Settings scene with General tab

**Files:** `OptaMini/OptaMiniApp.swift` (modify), `OptaMini/Views/SettingsView.swift` (create)

Create a SwiftUI Settings scene that opens via Cmd+, or menu.

```swift
// OptaMiniApp.swift - Add Settings scene
import SwiftUI

@main
struct OptaMiniApp: App {
    @NSApplicationDelegateAdaptor(AppDelegate.self) var appDelegate

    var body: some Scene {
        Settings {
            SettingsView()
        }
    }
}
```

```swift
// SettingsView.swift
import SwiftUI

struct SettingsView: View {
    var body: some View {
        TabView {
            GeneralSettingsView()
                .tabItem {
                    Label("General", systemImage: "gear")
                }

            AboutView()
                .tabItem {
                    Label("About", systemImage: "info.circle")
                }
        }
        .frame(width: 400, height: 250)
    }
}
```

**Verify:** Build succeeds, Cmd+, opens Preferences window

### Task 2: Implement Launch at Login toggle

**Files:** `OptaMini/Views/GeneralSettingsView.swift` (create), `OptaMini/Services/LoginItemManager.swift` (create)

Use SMAppService (macOS 13+) for modern login item management.

```swift
// LoginItemManager.swift
import Foundation
import ServiceManagement

@MainActor
final class LoginItemManager: ObservableObject {
    @Published var isEnabled: Bool = false

    init() {
        refreshStatus()
    }

    func refreshStatus() {
        isEnabled = SMAppService.mainApp.status == .enabled
    }

    func setEnabled(_ enabled: Bool) {
        do {
            if enabled {
                try SMAppService.mainApp.register()
            } else {
                try SMAppService.mainApp.unregister()
            }
            refreshStatus()
        } catch {
            print("Login item error: \(error)")
        }
    }
}
```

```swift
// GeneralSettingsView.swift
import SwiftUI

struct GeneralSettingsView: View {
    @StateObject private var loginItemManager = LoginItemManager()

    var body: some View {
        Form {
            Toggle("Launch at Login", isOn: Binding(
                get: { loginItemManager.isEnabled },
                set: { loginItemManager.setEnabled($0) }
            ))
            .help("Start Opta Mini automatically when you log in")
        }
        .padding()
    }
}
```

**Verify:** Toggle persists across app restarts, app appears in Login Items

### Task 3: Create About view with version info

**Files:** `OptaMini/Views/AboutView.swift` (create)

Display app icon, name, version, and copyright.

```swift
// AboutView.swift
import SwiftUI

struct AboutView: View {
    private var version: String {
        Bundle.main.infoDictionary?["CFBundleShortVersionString"] as? String ?? "1.0"
    }

    private var build: String {
        Bundle.main.infoDictionary?["CFBundleVersion"] as? String ?? "1"
    }

    var body: some View {
        VStack(spacing: 16) {
            Image(systemName: "circle.grid.2x2.fill")
                .font(.system(size: 48))
                .foregroundColor(.accentColor)

            Text("Opta Mini")
                .font(.title2.bold())

            Text("Version \(version) (\(build))")
                .font(.caption)
                .foregroundColor(.secondary)

            Divider()
                .padding(.horizontal, 40)

            Text("Ecosystem hub for Opta apps")
                .font(.caption)
                .foregroundColor(.secondary)

            Text("© 2026 Opta")
                .font(.caption2)
                .foregroundColor(.secondary)
        }
        .padding()
        .frame(maxWidth: .infinity, maxHeight: .infinity)
    }
}
```

**Verify:** Version and build number display correctly

### Task 4: Add Preferences menu item to popover footer

**Files:** `OptaMini/ContentView.swift` (modify)

Add a gear icon button to open Preferences from the popover.

```swift
// In FooterView, add Preferences button
Button {
    NSApp.sendAction(Selector(("showSettingsWindow:")), to: nil, from: nil)
} label: {
    Image(systemName: "gear")
        .font(.system(size: 12))
}
.buttonStyle(.plain)
.foregroundColor(.secondary)
.help("Preferences")
```

**Verify:** Gear button opens Preferences window

## Acceptance Criteria

- [ ] Cmd+, opens Preferences window
- [ ] General tab with Launch at Login toggle
- [ ] Toggle state persists and works correctly
- [ ] About tab shows version, build, copyright
- [ ] Gear button in footer opens Preferences

## Estimated Complexity

Low — Standard SwiftUI Settings patterns, SMAppService is straightforward.
