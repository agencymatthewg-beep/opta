---
phase: 03-menu-ui
plan: 01
subsystem: ui
requires: [app-registry, process-monitor, app-status]
provides: [dynamic-menu-icon, polished-ui, footer-actions]
affects: [04-app-controls, 05-preferences]
tags: [swiftui, menu-bar, ui-polish]
discovery-level: 0
discovery-reason: Standard SwiftUI patterns, building on existing infrastructure
---

# Phase 03-01 Plan: Menu UI

## Overview

Polish the menu bar UI with a dynamic status icon that reflects ecosystem health, improve the app list appearance, and add footer actions (Quit). This creates a complete, usable menu bar experience.

## Tasks

### Task 1: Add dynamic menu bar icon based on ecosystem status

**Files to modify:**
- `OptaMini/AppDelegate.swift`
- `OptaMini/Services/ProcessMonitor.swift`

**Implementation:**

Add ecosystem status enum to ProcessMonitor:
```swift
/// Overall ecosystem health status
enum EcosystemStatus {
    case allRunning    // All apps running - green
    case someRunning   // Some apps running - green
    case noneRunning   // No apps running - gray

    var iconName: String {
        switch self {
        case .allRunning, .someRunning:
            return "circle.grid.2x2.fill"
        case .noneRunning:
            return "circle.grid.2x2"
        }
    }

    var iconColor: NSColor {
        switch self {
        case .allRunning:
            return .systemGreen
        case .someRunning:
            return .systemGreen
        case .noneRunning:
            return .secondaryLabelColor
        }
    }
}

// Add to ProcessMonitor:
var ecosystemStatus: EcosystemStatus {
    let running = runningCount
    let total = OptaApp.allApps.count
    if running == total { return .allRunning }
    if running > 0 { return .someRunning }
    return .noneRunning
}
```

Update AppDelegate to observe status changes and update icon:
```swift
private var statusObserver: AnyCancellable?

// In applicationDidFinishLaunching, after creating processMonitor:
statusObserver = processMonitor?.$appStatus
    .receive(on: DispatchQueue.main)
    .sink { [weak self] _ in
        self?.updateMenuBarIcon()
    }

private func updateMenuBarIcon() {
    guard let button = statusItem?.button, let monitor = processMonitor else { return }
    let status = monitor.ecosystemStatus

    var config = NSImage.SymbolConfiguration(pointSize: 16, weight: .regular)
    if let color = status.iconColor.cgColor {
        config = config.applying(.init(paletteColors: [NSColor(cgColor: color)!]))
    }

    button.image = NSImage(systemSymbolName: status.iconName, accessibilityDescription: "Opta Mini")?
        .withSymbolConfiguration(config)
}
```

**Verification:**
- [ ] Icon is filled (circle.grid.2x2.fill) when any app is running
- [ ] Icon is outline (circle.grid.2x2) when no apps are running
- [ ] Icon updates in real-time when apps launch/terminate

---

### Task 2: Add hover effect and improve app row styling

**Files to modify:**
- `OptaMini/ContentView.swift`

**Implementation:**

Update AppRowView with hover effect and improved styling:
```swift
struct AppRowView: View {
    let app: OptaApp
    let isRunning: Bool
    @State private var isHovered = false

    var body: some View {
        HStack(spacing: 12) {
            // Status indicator
            Circle()
                .fill(isRunning ? Color.green : Color.gray.opacity(0.3))
                .frame(width: 8, height: 8)

            // App icon
            Image(systemName: app.icon)
                .font(.system(size: 18))
                .foregroundColor(isRunning ? .primary : .secondary)
                .frame(width: 24)

            // App name
            Text(app.name)
                .font(.system(size: 13))
                .foregroundColor(isRunning ? .primary : .secondary)

            Spacer()

            // Status text
            Text(isRunning ? "Running" : "Stopped")
                .font(.system(size: 11))
                .foregroundColor(.secondary)
        }
        .padding(.horizontal, 8)
        .padding(.vertical, 6)
        .background(
            RoundedRectangle(cornerRadius: 6)
                .fill(isHovered ? Color.primary.opacity(0.1) : Color.clear)
        )
        .onHover { hovering in
            isHovered = hovering
        }
    }
}
```

**Verification:**
- [ ] App rows highlight on hover
- [ ] Styling is consistent with native macOS menus
- [ ] Font sizes feel appropriate for menu bar app

---

### Task 3: Add footer with Quit button

**Files to modify:**
- `OptaMini/ContentView.swift`

**Implementation:**

Add footer section to ContentView:
```swift
struct ContentView: View {
    @ObservedObject var processMonitor: ProcessMonitor

    var body: some View {
        VStack(alignment: .leading, spacing: 0) {
            // Header
            VStack(alignment: .leading, spacing: 4) {
                Text("Opta Mini")
                    .font(.system(size: 14, weight: .semibold))

                Text("\(processMonitor.runningCount) of \(OptaApp.allApps.count) apps running")
                    .font(.system(size: 11))
                    .foregroundColor(.secondary)
            }
            .padding(.horizontal, 12)
            .padding(.top, 12)
            .padding(.bottom, 8)

            Divider()
                .padding(.horizontal, 8)

            // App list
            VStack(spacing: 2) {
                ForEach(OptaApp.allApps) { app in
                    AppRowView(app: app, isRunning: processMonitor.isRunning(app))
                }
            }
            .padding(.vertical, 8)

            Spacer()

            // Footer
            Divider()
                .padding(.horizontal, 8)

            FooterView()
                .padding(.horizontal, 12)
                .padding(.vertical, 8)
        }
        .frame(width: 280, height: 300)
    }
}

struct FooterView: View {
    var body: some View {
        HStack {
            Spacer()

            Button("Quit") {
                NSApplication.shared.terminate(nil)
            }
            .buttonStyle(.plain)
            .font(.system(size: 12))
            .foregroundColor(.secondary)
        }
    }
}
```

**Verification:**
- [ ] Footer displays Quit button
- [ ] Quit button terminates the app
- [ ] Layout is balanced and visually appealing

---

### Task 4: Adjust popover size and add visual polish

**Files to modify:**
- `OptaMini/AppDelegate.swift`
- `OptaMini/ContentView.swift`

**Implementation:**

Update popover size in AppDelegate:
```swift
popover?.contentSize = NSSize(width: 280, height: 300)
```

Add subtle visual enhancements to ContentView:
```swift
// Wrap content in background for subtle depth
.background(Color(NSColor.windowBackgroundColor))
```

**Verification:**
- [ ] Popover size matches content
- [ ] No unused whitespace
- [ ] Visually consistent with native macOS apps

---

## Commit Strategy

1. `feat(03-01): add dynamic menu bar icon based on ecosystem status`
2. `feat(03-01): add hover effect to app rows`
3. `feat(03-01): add footer with Quit button`
4. `feat(03-01): adjust popover size and visual polish`

## Success Criteria

- [ ] Menu bar icon changes based on running apps
- [ ] App rows have hover highlighting
- [ ] Quit button works correctly
- [ ] UI feels native to macOS
- [ ] No visual glitches or layout issues
- [ ] Build succeeds with no warnings
