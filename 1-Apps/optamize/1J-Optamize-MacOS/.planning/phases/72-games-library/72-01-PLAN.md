---
phase: 72-games-library
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - opta-native/OptaApp/OptaApp/Models/Game.swift
  - opta-native/OptaApp/OptaApp/Services/GameDetectionService.swift
  - opta-native/OptaApp/OptaApp/Views/Games/GamesLibraryView.swift
  - opta-native/OptaApp/OptaApp/Views/Games/GameDetailView.swift
  - opta-native/OptaApp/OptaApp/Views/Games/GameCardView.swift
autonomous: true
---

<objective>
Build games library with automatic detection, per-game profiles, and optimization recommendations.

Purpose: Allow users to detect installed games, view game-specific optimization profiles, track performance history, and one-click optimize for each game.
Output: Complete games library UI with detection service, game cards, detail view, and profile management.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

**Phase 71 profile system:**
@.planning/phases/71-settings-preferences/71-01-SUMMARY.md

**Profile model (reusable pattern):**
@opta-native/OptaApp/OptaApp/Models/OptimizationProfile.swift

**Existing page navigation:**
@opta-native/OptaApp/OptaApp/OptaAppApp.swift

**Design reference:**
- OLED background (#09090B)
- Glass cards with .ultraThinMaterial
- Purple accent (#8B5CF6)
- Spring animations
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Game model and GameDetectionService</name>
  <files>
opta-native/OptaApp/OptaApp/Models/Game.swift
opta-native/OptaApp/OptaApp/Services/GameDetectionService.swift
  </files>
  <action>
**Game.swift:**
1. Create Game model:
   ```swift
   struct Game: Identifiable, Codable {
       let id: UUID
       var name: String
       var bundleIdentifier: String?
       var executablePath: String
       var iconData: Data?  // App icon
       var platform: GamePlatform  // steam, epic, gog, native, other
       var lastPlayed: Date?
       var totalPlaytime: TimeInterval  // seconds
       var optimizationProfile: GameOptimizationProfile?
       var performanceHistory: [PerformanceSnapshot]
   }

   enum GamePlatform: String, Codable {
       case steam, epic, gog, native, other
   }

   struct GameOptimizationProfile: Codable {
       var qualityLevel: Int
       var processesToKill: [String]
       var recommendedSettings: [String: String]
       var lastOptimizedAt: Date?
   }

   struct PerformanceSnapshot: Codable {
       let timestamp: Date
       let avgFps: Float
       let avgCpuUsage: Float
       let avgGpuUsage: Float
       let sessionDuration: TimeInterval
   }
   ```

**GameDetectionService.swift:**
1. Create actor for thread-safe game detection:
   ```swift
   actor GameDetectionService {
       static let shared = GameDetectionService()

       func scanForGames() async -> [Game]
       func detectSteamGames() async -> [Game]
       func detectEpicGames() async -> [Game]
       func detectNativeGames() async -> [Game]
   }
   ```
2. Scan locations:
   - Steam: ~/Library/Application Support/Steam/steamapps/common/
   - Epic: ~/Library/Application Support/Epic/
   - Native: /Applications/ (filter for .app with game-like bundle IDs)
3. Game detection heuristics:
   - Has bundle identifier containing "game", "unity", "unreal"
   - Is in known game directory
   - Has LSApplicationCategoryType = "public.app-category.games"
4. Extract app icon using NSWorkspace.shared.icon(forFile:)
5. Create Services/ directory if not exists

Key: Use FileManager for directory scanning. Filter out non-game apps using Info.plist category.
  </action>
  <verify>
```bash
ls -la /Users/matthewbyrden/Documents/Opta/opta-native/OptaApp/OptaApp/Models/Game.swift
ls -la /Users/matthewbyrden/Documents/Opta/opta-native/OptaApp/OptaApp/Services/GameDetectionService.swift
```
Expected: Both files exist
  </verify>
  <done>Game model and detection service exist with Steam/Epic/native scanning</done>
</task>

<task type="auto">
  <name>Task 2: Create GameCardView and GamesLibraryView</name>
  <files>
opta-native/OptaApp/OptaApp/Views/Games/GameCardView.swift
opta-native/OptaApp/OptaApp/Views/Games/GamesLibraryView.swift
  </files>
  <action>
**GameCardView.swift:**
1. Game card component showing:
   - App icon (48x48)
   - Game name
   - Platform badge (Steam/Epic/GOG/Native)
   - Last played relative time
   - Quick optimize button (bolt.fill)
2. Glass card styling with hover state
3. Tap to select game (navigates to detail)
4. Quick optimize button dispatches event without navigation
5. Optimized state indicator (checkmark badge)

**GamesLibraryView.swift:**
1. Main games library view:
   - Header with "Games Library" title and scan button
   - Search bar for filtering games
   - Grid layout (LazyVGrid, 3 columns on wide screens)
   - Platform filter pills (All, Steam, Epic, Native)
   - Sort options (Name, Last Played, Playtime)
2. State management:
   - @State games: [Game] = []
   - @State isScanning: Bool = false
   - @State searchText: String = ""
   - @State selectedPlatform: GamePlatform? = nil
3. Scan button triggers GameDetectionService.shared.scanForGames()
4. Empty state when no games found
5. Loading state during scan with progress indicator
6. Create Games/ directory if not exists

Key: Use .task modifier to scan on appear. Cache results to avoid repeated scans.
  </action>
  <verify>
```bash
ls -la /Users/matthewbyrden/Documents/Opta/opta-native/OptaApp/OptaApp/Views/Games/GameCardView.swift
ls -la /Users/matthewbyrden/Documents/Opta/opta-native/OptaApp/OptaApp/Views/Games/GamesLibraryView.swift
```
Expected: Both files exist
  </verify>
  <done>GameCardView and GamesLibraryView exist with grid layout and filtering</done>
</task>

<task type="auto">
  <name>Task 3: Create GameDetailView with optimization and history</name>
  <files>
opta-native/OptaApp/OptaApp/Views/Games/GameDetailView.swift
opta-native/OptaApp/OptaApp/OptaAppApp.swift
  </files>
  <action>
**GameDetailView.swift:**
1. Detail view sections:
   - Hero section: Large icon, name, platform, playtime stats
   - Optimization section:
     - Current profile settings (quality level, processes to kill)
     - "Optimize Now" button (launches game with optimization)
     - "Edit Profile" button (sheet with profile editor)
     - Recommended settings list with apply button
   - Performance History section:
     - Chart showing FPS over time (last 10 sessions)
     - Average CPU/GPU usage stats
     - Best/worst session indicators
   - Quick Actions:
     - Launch Game (NSWorkspace.shared.open)
     - Reset Profile
     - View in Finder
2. Navigation back button to library
3. Accept Game binding for updates
4. Optimization recommendations based on hardware:
   - If GPU usage > 90%: suggest lower quality
   - If CPU usage > 80%: suggest closing background apps
   - If thermal throttling detected: suggest reduced settings

**OptaAppApp.swift update:**
1. Add .games case to page navigation switch:
   ```swift
   case .games:
       GamesLibraryView(coreManager: coreManager)
   ```
2. Add game detail navigation (use NavigationStack path or selectedGameId)
3. Wire up navigation from DashboardView quick actions

Key: GameDetailView should work standalone or within navigation. Use @Binding for game to allow updates.
  </action>
  <verify>
```bash
ls -la /Users/matthewbyrden/Documents/Opta/opta-native/OptaApp/OptaApp/Views/Games/GameDetailView.swift
grep -l "GamesLibraryView" /Users/matthewbyrden/Documents/Opta/opta-native/OptaApp/OptaApp/OptaAppApp.swift
```
Expected: GameDetailView exists and OptaAppApp references GamesLibraryView
  </verify>
  <done>GameDetailView exists with optimization/history sections and app navigation wired</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Game.swift exists with Game, GamePlatform, GameOptimizationProfile, PerformanceSnapshot
- [ ] GameDetectionService.swift exists with Steam/Epic/native scanning
- [ ] GameCardView.swift exists with glass styling and quick optimize button
- [ ] GamesLibraryView.swift exists with grid, search, and platform filters
- [ ] GameDetailView.swift exists with optimization profile and performance history
- [ ] OptaAppApp.swift routes to GamesLibraryView for .games page
- [ ] Games/ subdirectory created
- [ ] Services/ subdirectory created
</verification>

<success_criteria>
- Games are detected from Steam, Epic, and /Applications
- Game cards display with icons, names, and platform badges
- Library supports search and platform filtering
- Game detail shows optimization profile with edit capability
- Performance history chart displays session data
- One-click optimize button triggers optimization flow
- Navigation to games from dashboard works
</success_criteria>

<output>
After completion, create `.planning/phases/72-games-library/72-01-SUMMARY.md`
</output>
