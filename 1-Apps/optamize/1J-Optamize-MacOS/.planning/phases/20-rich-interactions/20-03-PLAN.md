# Plan 20-03: Command Palette

**Phase:** 20 - Rich Interactions
**Feature:** Command Palette (Cmd+K)
**Scope:** Small-Medium (1-2 days)
**Dependencies:** None

---

## Summary

Add a command palette using cmdk that enables keyboard-first navigation and action execution. Users can press Cmd+K to instantly search and execute actions like navigation, optimization, and settings changes.

---

## Why This Matters

- **Power users expect it** - Linear, VS Code, Notion, Raycast all have Cmd+K
- **Accessibility** - Full keyboard navigation without mouse
- **Discoverability** - Users discover features through search
- **Speed** - Faster than navigating menus

---

## Implementation Tasks

### Task 1: Install cmdk and create base component
**File:** `package.json`, `src/components/CommandPalette/CommandPalette.tsx`

**Actions:**
1. Install cmdk: `npm install cmdk`
2. Create `src/components/CommandPalette/` directory
3. Create base CommandPalette component with cmdk Dialog

**Code pattern:**
```tsx
// src/components/CommandPalette/CommandPalette.tsx
import { Command } from 'cmdk';
import { useState, useEffect } from 'react';
import { motion, AnimatePresence } from 'framer-motion';

export function CommandPalette() {
  const [open, setOpen] = useState(false);

  useEffect(() => {
    const down = (e: KeyboardEvent) => {
      if (e.key === 'k' && (e.metaKey || e.ctrlKey)) {
        e.preventDefault();
        setOpen((open) => !open);
      }
    };
    document.addEventListener('keydown', down);
    return () => document.removeEventListener('keydown', down);
  }, []);

  return (
    <Command.Dialog open={open} onOpenChange={setOpen}>
      <Command.Input placeholder="Type a command or search..." />
      <Command.List>
        <Command.Empty>No results found.</Command.Empty>
        {/* Commands populated from commands.ts */}
      </Command.List>
    </Command.Dialog>
  );
}
```

**Verification:** Component renders, Cmd+K opens dialog

---

### Task 2: Define command registry
**File:** `src/components/CommandPalette/commands.ts`

**Actions:**
1. Create typed command interface
2. Define navigation commands (Dashboard, Score, Games, Optimize, Settings)
3. Define action commands (Run Optimization, Stealth Mode Toggle)
4. Define utility commands (Toggle Dark Mode, Check for Updates)

**Code pattern:**
```typescript
// src/components/CommandPalette/commands.ts
import { LucideIcon, Home, Gauge, Gamepad2, Zap, Settings, Play, EyeOff } from 'lucide-react';

export interface Command {
  id: string;
  label: string;
  icon: LucideIcon;
  shortcut?: string;
  group: 'navigation' | 'actions' | 'utilities';
  action: () => void | Promise<void>;
  keywords?: string[]; // For better fuzzy search
}

export const createCommands = (navigate: (path: string) => void, actions: CommandActions): Command[] => [
  // Navigation
  { id: 'nav-dashboard', label: 'Go to Dashboard', icon: Home, group: 'navigation', action: () => navigate('/'), keywords: ['home'] },
  { id: 'nav-score', label: 'Go to Score', icon: Gauge, group: 'navigation', action: () => navigate('/score') },
  { id: 'nav-games', label: 'Go to Games', icon: Gamepad2, group: 'navigation', action: () => navigate('/games') },
  { id: 'nav-optimize', label: 'Go to Optimize', icon: Zap, group: 'navigation', action: () => navigate('/optimize') },
  { id: 'nav-settings', label: 'Go to Settings', icon: Settings, group: 'navigation', action: () => navigate('/settings'), shortcut: '⌘,' },

  // Actions
  { id: 'action-optimize', label: 'Run Quick Optimization', icon: Play, group: 'actions', action: actions.runOptimization, shortcut: '⌘⇧O' },
  { id: 'action-stealth', label: 'Toggle Stealth Mode', icon: EyeOff, group: 'actions', action: actions.toggleStealth },
];
```

**Verification:** Commands array exports correctly, types compile

---

### Task 3: Style dialog with glass design system
**File:** `src/components/CommandPalette/CommandPalette.tsx`, `src/index.css`

**Actions:**
1. Add cmdk CSS variables for dark glass theme
2. Style dialog with glass backdrop blur
3. Style input with glass-subtle background
4. Style items with hover states matching design system
5. Add Framer Motion entrance/exit animations

**CSS variables to add:**
```css
/* Command palette - obsidian glass theme */
[cmdk-dialog] {
  @apply fixed inset-0 z-50;
}

[cmdk-overlay] {
  @apply fixed inset-0 bg-black/60 backdrop-blur-sm;
}

[cmdk-root] {
  @apply glass-strong max-w-lg w-full mx-auto mt-[20vh] rounded-xl border border-white/10 shadow-2xl overflow-hidden;
}

[cmdk-input] {
  @apply w-full bg-transparent px-4 py-3 text-foreground placeholder:text-muted-foreground outline-none border-b border-white/5;
}

[cmdk-list] {
  @apply max-h-[300px] overflow-y-auto p-2;
}

[cmdk-item] {
  @apply flex items-center gap-3 px-3 py-2.5 rounded-lg cursor-pointer text-muted-foreground;
  @apply data-[selected=true]:bg-primary/10 data-[selected=true]:text-foreground;
}

[cmdk-group-heading] {
  @apply px-3 py-2 text-xs font-medium text-muted-foreground/60 uppercase tracking-wider;
}

[cmdk-empty] {
  @apply py-6 text-center text-muted-foreground;
}
```

**Verification:** Dialog matches design system, glass effects visible, animations smooth

---

### Task 4: Integrate with App.tsx and router
**File:** `src/App.tsx`

**Actions:**
1. Import CommandPalette component
2. Add to App layout (renders globally)
3. Pass navigate function from router
4. Connect to existing action handlers (optimization, stealth mode)

**Verification:** Cmd+K works from any page, navigation commands work

---

### Task 5: Add command shortcut hints
**File:** `src/components/CommandPalette/CommandPalette.tsx`

**Actions:**
1. Display keyboard shortcuts next to commands
2. Style shortcut badges with muted appearance
3. Group commands by category (Navigation, Actions, Utilities)

**Code pattern:**
```tsx
<Command.Item value={cmd.id} onSelect={cmd.action}>
  <cmd.icon className="w-4 h-4 text-muted-foreground" strokeWidth={1.75} />
  <span className="flex-1">{cmd.label}</span>
  {cmd.shortcut && (
    <kbd className="px-1.5 py-0.5 text-[10px] rounded bg-white/5 text-muted-foreground">
      {cmd.shortcut}
    </kbd>
  )}
</Command.Item>
```

**Verification:** Shortcuts display correctly, readable at small size

---

### Task 6: Export and add keyboard shortcut reference
**File:** `src/components/CommandPalette/index.ts`

**Actions:**
1. Create barrel export
2. Document available commands in component JSDoc
3. Add hint in UI showing Cmd+K availability (optional footer badge)

**Verification:** Clean imports work, documentation accurate

---

## Verification Checklist

- [ ] `npm install cmdk` completes successfully
- [ ] Cmd+K opens command palette from any page
- [ ] Cmd+K closes command palette when open
- [ ] Escape key closes command palette
- [ ] Clicking overlay closes command palette
- [ ] Search filters commands correctly
- [ ] Navigation commands navigate to correct pages
- [ ] "Run Quick Optimization" triggers optimization flow
- [ ] "Toggle Stealth Mode" toggles stealth state
- [ ] Dialog styled with glass effect matching design system
- [ ] Animations are smooth and respect reduced motion
- [ ] Focus returns to previous element when closed
- [ ] `npm run build` passes with no errors

---

## Files Created/Modified

| File | Action |
|------|--------|
| `package.json` | Add cmdk dependency |
| `src/components/CommandPalette/CommandPalette.tsx` | Create |
| `src/components/CommandPalette/commands.ts` | Create |
| `src/components/CommandPalette/index.ts` | Create |
| `src/index.css` | Add cmdk styles |
| `src/App.tsx` | Integrate CommandPalette |

---

## Research Reference

From 20-RESEARCH.md:
- Use cmdk (not kbar) - lightweight, Vercel/Linear use it
- Focus management is built-in (no manual trap needed)
- Fuzzy search included
- ARIA patterns handled automatically

---

*Plan created: 2026-01-17*
*Ready for execution: yes*
