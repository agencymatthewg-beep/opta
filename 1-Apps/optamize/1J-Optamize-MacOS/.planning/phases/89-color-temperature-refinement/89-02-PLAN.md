---
phase: 89-color-temperature-refinement
plan: 02
title: Dashboard Temperature Integration
subsystem: ui
wave: 2
depends_on: ["89-01"]
files_modified: [opta-native/OptaApp/OptaApp/Views/DashboardView.swift, opta-native/OptaApp/OptaApp/Views/Components/TelemetryCard.swift, opta-native/OptaApp/OptaApp/Views/Components/QuickActions.swift, opta-native/OptaApp/OptaApp/Views/Components/ScoreDisplay.swift]
autonomous: true
scope: small
tags: [swift, swiftui, color-temperature, dashboard, telemetry]
---

# Plan 89-02: Dashboard Temperature Integration

## Objective

Replace hardcoded `branchViolet` color references in dashboard components with temperature-aware colors from the ColorTemperature environment. Each component reads `@Environment(\.colorTemperature)` and uses state-appropriate colors, making the entire dashboard visually respond to app activity level.

## Execution Context

### Patterns from 89-01
- `@Environment(\.colorTemperature) private var colorTemp` — read current state
- `colorTemp.violetColor` — state-appropriate violet (dim in dormant, bright in processing)
- `colorTemp.glowOpacity` — glow intensity for current state
- `colorTemp.ambientBrightness` — ambient light level
- `colorTemp.branchIntensity` — branch energy multiplier
- `colorTemp.tintColor` — primary tint (violet normally, amber in alert)

### Key References
- `opta-native/OptaApp/OptaApp/Design/ColorTemperature.swift` — state model (from 89-01)
- `opta-native/OptaApp/OptaApp/Design/ColorTemperatureEnvironment.swift` — environment key (from 89-01)

## Context

### Current State
- **DashboardView.swift**: Has `private let branchViolet = Color(hex: "8B5CF6")` — static, never changes with app state
- **TelemetryCard.swift**: Has `private static let branchViolet = Color(hex: "8B5CF6")` and uses `energyLevel` for opacity but not for color selection
- **QuickActions.swift**: Has `private let branchViolet = Color(hex: "8B5CF6")` — buttons always same violet
- **ScoreDisplay.swift**: Uses score-based color independently — less affected but should respect temperature for glow

### Design Rules
- Replace `branchViolet` constants with `colorTemp.violetColor`
- Replace hardcoded opacity multipliers with `colorTemp.glowOpacity` or `colorTemp.branchIntensity`
- Keep functional/semantic colors (green=good, amber=warning, red=bad for telemetry values) — temperature only affects accent/glow/ambient
- Keep `energyLevel` as an intensity multiplier ON TOP of temperature color (energy modulates intensity, temperature sets base color)
- Reduce-motion: no transition animation, instant color changes

## Tasks

### Task 1: DashboardView Temperature Colors

**Files:** `opta-native/OptaApp/OptaApp/Views/DashboardView.swift`

**Changes:**
1. Add `@Environment(\.colorTemperature) private var colorTemp`
2. Remove `private let branchViolet = Color(hex: "8B5CF6")` — replace all usages with `colorTemp.violetColor`
3. Replace `branchViolet.opacity(0.2)` shadow references with `colorTemp.tintColor.opacity(colorTemp.glowOpacity * 0.3)`
4. Replace `branchViolet.opacity(0.1)` border strokes with `colorTemp.tintColor.opacity(colorTemp.glowOpacity * 0.15)`
5. The `obsidianBase` constant stays — it's the background, not affected by temperature
6. Keep all organic motion modifiers from Phase 88 unchanged

**Verification:** Build compiles, dashboard colors respond to temperature state

### Task 2: TelemetryCard Temperature Colors

**Files:** `opta-native/OptaApp/OptaApp/Views/Components/TelemetryCard.swift`

**Changes:**
1. Add `@Environment(\.colorTemperature) private var colorTemp`
2. Remove `private static let branchViolet = Color(hex: "8B5CF6")` — replace all `Self.branchViolet` usages with `colorTemp.violetColor`
3. Update shadow: `colorTemp.tintColor.opacity(Double(energyLevel) * colorTemp.glowOpacity * 0.25)` — energy still modulates, but base comes from temperature
4. Update icon foreground: `colorTemp.violetColor.opacity(Double(0.6 + energyLevel * 0.4))` — temperature sets the base violet
5. Update gradient overlays: replace `Self.branchViolet.opacity(Double(energyLevel) * 0.04)` with `colorTemp.tintColor.opacity(Double(energyLevel) * colorTemp.ambientBrightness)`
6. Keep the sparkline/value colors (functional — green/amber/red for metric levels)
7. Keep all organic motion modifiers from Phase 88 unchanged

**Verification:** Build compiles, telemetry cards dim in dormant, bright in processing

### Task 3: QuickActions & ScoreDisplay Temperature Colors

**Files:** `opta-native/OptaApp/OptaApp/Views/Components/QuickActions.swift`, `opta-native/OptaApp/OptaApp/Views/Components/ScoreDisplay.swift`

**Changes for QuickActions:**
1. Add `@Environment(\.colorTemperature) private var colorTemp`
2. Remove `private let branchViolet = Color(hex: "8B5CF6")` — replace all usages with `colorTemp.violetColor`
3. Button backgrounds: use `colorTemp.tintColor.opacity(colorTemp.glowOpacity * 0.1)` instead of fixed `branchViolet.opacity(0.1)`
4. Button borders/accents: use `colorTemp.tintColor.opacity(colorTemp.glowOpacity * 0.3)` instead of fixed violet opacity
5. Keep organic motion modifiers (organicAppear, organicHover) from Phase 88 unchanged

**Changes for ScoreDisplay:**
1. Add `@Environment(\.colorTemperature) private var colorTemp`
2. If any `Color(hex: "8B5CF6")` or violet references exist for glow/ring, replace with `colorTemp.violetColor`
3. The score value color (grade-based: S=gold, A=green, etc.) stays functional — temperature only affects ambient glow
4. Ring glow around the score: use `colorTemp.tintColor.opacity(colorTemp.glowOpacity)`
5. Keep organic motion modifiers (organicPulse) from Phase 88 unchanged

**Verification:** Build compiles, buttons and score glow respond to temperature

## Verification

After all tasks:
```bash
cd opta-native && xcodebuild build -project OptaApp/OptaApp.xcodeproj -scheme OptaApp -destination 'platform=macOS' 2>&1 | tail -5
```

Expected: **BUILD SUCCEEDED**

## Success Criteria

- [ ] No hardcoded `branchViolet` or `Color(hex: "8B5CF6")` remains in dashboard components
- [ ] All 4 files read `@Environment(\.colorTemperature)` for dynamic colors
- [ ] Dormant state: near-invisible violet, minimal glow — dashboard appears monochrome
- [ ] Active state: full Electric Violet with medium glow — standard appearance
- [ ] Processing state: brighter violet, maximum glow — dashboard feels energized
- [ ] Alert state: amber tint replaces violet — clear visual shift for warnings
- [ ] Functional colors (telemetry green/amber/red, score grades) unaffected by temperature
- [ ] Organic motion modifiers (Phase 88) preserved
- [ ] Build succeeds with no new errors

## Output

- SUMMARY.md with files modified, decisions made
- Per-task atomic commits
