---
phase: 90-visual-cohesion-launch
plan: 01
title: Complete Color Temperature Conversion
subsystem: ui
wave: 1
depends_on: ["89-01", "89-02", "89-03"]
files_modified: [opta-native/OptaApp/OptaApp/Views/Games/GameDetailView.swift, opta-native/OptaApp/OptaApp/Views/Games/GamesLibraryView.swift, opta-native/OptaApp/OptaApp/Views/Settings/ProfileManagerView.swift, opta-native/OptaApp/OptaApp/Views/Settings/KeyboardShortcutsView.swift, opta-native/OptaApp/OptaApp/Views/SettingsView.swift, opta-native/OptaApp/OptaApp/MenuBar/MenuBarView.swift, opta-native/OptaApp/OptaApp/MenuBar/MenuBarIcon.swift, opta-native/OptaApp/OptaApp/Views/Components/SparklineView.swift, opta-native/OptaApp/OptaApp/Navigation/CircularMenuNavigation.swift]
autonomous: true
scope: medium
tags: [swift, swiftui, color-temperature, audit, games, settings, menu-bar]
---

# Plan 90-01: Complete Color Temperature Conversion

## Objective

Convert ALL remaining hardcoded `Color(hex: "8B5CF6")` references to use `@Environment(\.colorTemperature)`. Phase 89 converted dashboard, telemetry, quick actions, score display, game cards, and menu bar buttons. This plan catches every remaining file — games library/detail, settings views, menu bar popover, sparkline, and navigation. After this plan, zero hardcoded accent violet remains in any view layer.

## Execution Context

### Patterns from 89-01/02/03
- `@Environment(\.colorTemperature) private var colorTemp` — read current state
- `colorTemp.violetColor` — state-appropriate violet (replaces `Color(hex: "8B5CF6")`)
- `colorTemp.tintColor` — primary tint (violet/amber)
- `colorTemp.glowOpacity` — glow intensity for opacity scaling
- `colorTemp.ambientBrightness` — ambient light level for subtle tints

### Key References
- `opta-native/OptaApp/OptaApp/Design/ColorTemperature.swift` — state model
- `opta-native/OptaApp/OptaApp/Design/ColorTemperatureEnvironment.swift` — environment key + provider

### Design Rules
- **Accent colors**: Replace all `Color(hex: "8B5CF6")` with `colorTemp.violetColor`
- **Opacity-scaled accents**: Replace `Color(hex: "8B5CF6").opacity(x)` with `colorTemp.violetColor.opacity(colorTemp.glowOpacity * x / originalMax)` — normalize so full-intensity matches active state
- **Tint usage**: `.tint(Color(hex: "8B5CF6"))` → `.tint(colorTemp.tintColor)`
- **Stroke/border accents**: Use `colorTemp.tintColor.opacity(colorTemp.glowOpacity * 0.2)`
- **Background obsidian**: Leave `Color(hex: "0A0A0F")` and `Color(hex: "09090B")` unchanged — these are structural, not accent
- **Functional colors**: Green (running/success), amber (warning), red (error/stopped) stay as-is
- **Model/service layer**: `Game.swift` model color and `AgentModeManager.swift` stay — these are data/logic, not view accent
- **ThemeCustomizationView**: Hex string constants for user-selectable themes stay — these are configuration data, not rendered accent
- **OptaRingView**: Ring phase colors stay — these are ring-specific state indicators managed by the ring itself
- **CircularMenuView defaultSectors**: Static color stays — accessibility fallback (noted in 89-03 as out of scope)
- **OptaTextStyle.glowPurple**: Leave — design system constant used internally by text effects

## Context

### Files to Convert

| File | Refs | Category |
|------|------|----------|
| GameDetailView.swift | 16 | Games |
| GamesLibraryView.swift | 8 | Games |
| ProfileManagerView.swift | 10 | Settings |
| KeyboardShortcutsView.swift | 6 | Settings |
| SettingsView.swift | 2 | Settings |
| MenuBarView.swift | 4 | Menu Bar |
| MenuBarIcon.swift | 1 | Menu Bar |
| SparklineView.swift | 3 | Components |
| CircularMenuNavigation.swift | 1 | Navigation |

### Exclusions (intentional — not accent colors)
- `Game.swift:51` — model data
- `AgentModeManager.swift:69` — service layer
- `ThemeCustomizationView.swift` — user-selectable theme config
- `OptaRingView.swift` — ring phase colors (separate visual system)
- `CircularMenuView.swift:25-28` — static defaultSectors (accessibility)
- `OptaTextStyle.swift:41` — design constant
- `ColorTemperature.swift:38,82` — the source of truth for violet
- `TelemetryCard.swift:48` — default param (environment used at call site)
- `DashboardView.swift:234` — helper function (environment used at view level)

## Tasks

### Task 1: Games Views Temperature Conversion

**Files:** `GameDetailView.swift`, `GamesLibraryView.swift`

**Changes for GameDetailView (16 refs):**
1. Add `@Environment(\.colorTemperature) private var colorTemp` to the main view struct
2. Replace all `Color(hex: "8B5CF6")` foreground references with `colorTemp.violetColor`
3. Replace all `Color(hex: "8B5CF6").opacity(x)` stroke/border with `colorTemp.tintColor.opacity(colorTemp.glowOpacity * x * 2.5)` (normalize: 0.08 → ~0.2 at full active)
4. Replace `.fill(Color(hex: "8B5CF6"))` icon fills with `colorTemp.violetColor`
5. Leave `Color(hex: "0A0A0F")` backgrounds unchanged (obsidian structural)

**Changes for GamesLibraryView (8 refs):**
1. Add `@Environment(\.colorTemperature) private var colorTemp` to the main view struct
2. Replace all `Color(hex: "8B5CF6")` fills/foregrounds with `colorTemp.violetColor`
3. Replace `.stroke(Color(hex: "8B5CF6").opacity(0.08))` with `colorTemp.tintColor.opacity(colorTemp.glowOpacity * 0.2)`
4. Replace color in ternary expressions: `isSelected ? Color(hex: "8B5CF6") : Color(hex: "0A0A0F")` → `isSelected ? colorTemp.violetColor : Color(hex: "0A0A0F")`
5. Leave `Color(hex: "0A0A0F")` backgrounds unchanged

**Verification:** Build compiles, games views respond to temperature state

### Task 2: Settings Views Temperature Conversion

**Files:** `ProfileManagerView.swift`, `KeyboardShortcutsView.swift`, `SettingsView.swift`

**Changes for ProfileManagerView (10 refs):**
1. Add `@Environment(\.colorTemperature) private var colorTemp`
2. Replace `.tint(Color(hex: "8B5CF6"))` (2 instances) with `.tint(colorTemp.tintColor)`
3. Replace `.foregroundColor(Color(hex: "8B5CF6"))` with `.foregroundColor(colorTemp.violetColor)`
4. Replace `.stroke(Color(hex: "8B5CF6").opacity(0.1))` with `colorTemp.tintColor.opacity(colorTemp.glowOpacity * 0.15)`
5. Quality level color scale (lines 344-349): Replace the 5-level opacity scale with temperature-aware:
   - `case 0: return colorTemp.violetColor.opacity(0.2 * colorTemp.glowOpacity)`
   - `case 1: return colorTemp.violetColor.opacity(0.3 * colorTemp.glowOpacity)`
   - `case 2: return colorTemp.violetColor.opacity(0.5 * colorTemp.glowOpacity)`
   - `case 3: return colorTemp.violetColor.opacity(0.7 * colorTemp.glowOpacity)`
   - `case 4: return colorTemp.violetColor`
   - `default: return colorTemp.violetColor.opacity(0.2 * colorTemp.glowOpacity)`
6. Line 365: Replace `Color(hex: "8B5CF6")` with `colorTemp.violetColor`

**Changes for KeyboardShortcutsView (6 refs):**
1. Add `@Environment(\.colorTemperature) private var colorTemp`
2. Replace `.foregroundColor(Color(hex: "8B5CF6"))` (3 instances) with `.foregroundColor(colorTemp.violetColor)`
3. Replace `.stroke(Color(hex: "8B5CF6").opacity(0.2))` with `colorTemp.tintColor.opacity(colorTemp.glowOpacity * 0.3)`
4. Replace `.stroke(isRecording ? Color(hex: "8B5CF6") : Color.clear)` with `colorTemp.violetColor`
5. Replace `.tint(Color(hex: "8B5CF6"))` with `.tint(colorTemp.tintColor)`

**Changes for SettingsView (2 refs):**
1. Add `@Environment(\.colorTemperature) private var colorTemp`
2. Replace `.stroke(Color(hex: "8B5CF6").opacity(0.15))` with `colorTemp.tintColor.opacity(colorTemp.glowOpacity * 0.2)`
3. Replace `.foregroundColor(Color(hex: "8B5CF6"))` with `.foregroundColor(colorTemp.violetColor)`

**Verification:** Build compiles, settings views respond to temperature

### Task 3: Menu Bar & Utility Components Temperature Conversion

**Files:** `MenuBarView.swift`, `MenuBarIcon.swift`, `SparklineView.swift`, `CircularMenuNavigation.swift`

**Changes for MenuBarView (4 refs):**
1. Add `@Environment(\.colorTemperature) private var colorTemp`
2. Replace `.foregroundColor(Color(hex: "8B5CF6") ?? .purple)` (3 instances) with `.foregroundColor(colorTemp.violetColor)`
3. Replace `.fill((Color(hex: "8B5CF6") ?? .purple).opacity(0.2))` with `colorTemp.violetColor.opacity(colorTemp.glowOpacity * 0.3)`
4. Agent mode indicator: keep conditional logic but use temperature color: `agentModeManager.isAgentMode ? colorTemp.violetColor : .white.opacity(0.6)`
5. Menu bar minimum visibility: like MenuBarCircularMenuButton, ensure `max(colorTemp.glowOpacity, 0.4)` for usability in dormant state

**Changes for MenuBarIcon (1 ref):**
1. Add `@Environment(\.colorTemperature) private var colorTemp`
2. Replace `Color(hex: "8B5CF6") ?? .purple` in the gradient array with `colorTemp.violetColor`
3. Keep gradient structure — just swap color source

**Changes for SparklineView (3 refs):**
1. Add `@Environment(\.colorTemperature) private var colorTemp`
2. Remove `private static let defaultViolet = Color(hex: "8B5CF6")`
3. Replace the default color parameter: `init(data: [Float], color: Color? = nil)` — use `color ?? colorTemp.violetColor` internally
4. Keep the `Color(hex: "0A0A0F")` background unchanged

**Changes for CircularMenuNavigation (1 ref):**
1. Add `@Environment(\.colorTemperature) private var colorTemp`
2. Replace `Color(hex: "8B5CF6")` with `colorTemp.violetColor`

**Verification:** Build compiles, menu bar + sparklines + navigation respond to temperature

## Verification

After all tasks:
```bash
cd opta-native && xcodebuild build -project OptaApp/OptaApp.xcodeproj -scheme OptaApp -destination 'platform=macOS' 2>&1 | tail -5
```

Expected: **BUILD SUCCEEDED**

Post-build audit:
```bash
grep -r "8B5CF6\|8b5cf6" opta-native/OptaApp/OptaApp/Views/ opta-native/OptaApp/OptaApp/MenuBar/ opta-native/OptaApp/OptaApp/Navigation/ --include="*.swift" | grep -v "0A0A0F\|09090B\|README\|ColorTemperature\|// "
```

Expected: Zero view-layer accent references remain (only excluded files: model, service, theme config, ring, design constants)

## Success Criteria

- [ ] Zero hardcoded `Color(hex: "8B5CF6")` in any View layer file (excluding documented exclusions)
- [ ] 9 files converted with `@Environment(\.colorTemperature)`
- [ ] GameDetailView (16 refs) fully temperature-aware
- [ ] GamesLibraryView (8 refs) fully temperature-aware
- [ ] ProfileManagerView (10 refs) fully temperature-aware
- [ ] KeyboardShortcutsView (6 refs) fully temperature-aware
- [ ] SettingsView (2 refs) fully temperature-aware
- [ ] MenuBarView (4 refs) fully temperature-aware with min visibility
- [ ] MenuBarIcon (1 ref) gradient uses temperature color
- [ ] SparklineView (3 refs) uses temperature as default color
- [ ] CircularMenuNavigation (1 ref) uses temperature color
- [ ] Obsidian backgrounds (0A0A0F, 09090B) preserved unchanged
- [ ] Functional colors (green/amber/red) preserved unchanged
- [ ] Build succeeds with no new errors

## Output

- SUMMARY.md with files modified, decisions made
- Per-task atomic commits
