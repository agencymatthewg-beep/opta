# Phase 2: TUI Multiline Input

## Objective

Replace the single-line `ink-text-input` in the TUI with a custom multiline input component that supports input history (up/down), cursor movement, paste detection, and basic @file reference completion. Reuses existing `InputEditor` and `InputHistory` classes from `src/ui/`.

## Research Summary

**No external research needed.** The REPL already implements:
- `InputEditor` (`src/ui/input.ts`) — buffer management, multiline, paste detection, shell mode, cursor tracking
- `InputHistory` (`src/ui/history.ts`) — dedup, navigation, max 100 entries

The TUI just needs to wire these into an Ink component with `useInput` for raw key handling instead of `ink-text-input`.

## Tasks

### Task 1: Custom MultilineInput Component

Replace `ink-text-input` dependency with a custom Ink component that handles raw keystrokes via `useInput`.

**Files:**
- Modify: `src/tui/InputBox.tsx` — Rewrite to use `useInput` from ink for raw key handling
- Modify: `tests/tui/InputBox.test.tsx` — Update tests

**Implementation:**

1. Remove `import TextInput from 'ink-text-input'`
2. Use `useInput` from `ink` to handle raw keystrokes
3. Integrate `InputEditor` for buffer/cursor management
4. Support:
   - Regular character input
   - Backspace/delete
   - Left/right cursor movement
   - Home/end
   - Meta+Return for newline insertion (multiline mode)
   - Escape to clear input
   - Return to submit
5. Display cursor position with inverse character styling
6. Show line count indicator when multiline

### Task 2: Input History Integration

Wire `InputHistory` into the input component for up/down arrow navigation.

**Files:**
- Modify: `src/tui/InputBox.tsx` — Add history navigation
- Modify: `tests/tui/InputBox.test.tsx` — Add history tests

**Implementation:**

1. Accept `history: InputHistory` prop (or instantiate internally)
2. Up arrow: navigate to previous entry
3. Down arrow: navigate to next entry
4. On submit: push entry to history
5. History navigation starts from current position

### Task 3: @file Autocomplete Hints

Show inline suggestions when user types `@` followed by text, using glob-based file matching.

**Files:**
- Modify: `src/tui/InputBox.tsx` — Add @file detection and hint display
- Modify: `tests/tui/InputBox.test.tsx` — Add @file tests

**Implementation:**

1. Detect `@` followed by partial path in input buffer
2. Use `fast-glob` (already a dependency) to find matching files
3. Display top 5 matches as dimmed text below input
4. Tab to accept first suggestion (replace @partial with @full-path)
5. Debounce glob calls (200ms)

## Verification

1. `npx vitest run tests/tui/` — all TUI tests pass
2. `npm run typecheck` — clean
3. Multiline: Meta+Return inserts newline, Enter submits
4. History: up/down navigates previous inputs
5. @file: typing `@src/` shows matching files
