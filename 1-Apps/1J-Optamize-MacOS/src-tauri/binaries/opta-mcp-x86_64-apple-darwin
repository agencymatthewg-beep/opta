#!/bin/bash
# Opta MCP Server sidecar script for macOS Intel
# This script spawns the Python MCP server

set -e

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECT_ROOT="$(cd "$SCRIPT_DIR/../.." && pwd)"
MCP_SERVER_DIR="$PROJECT_ROOT/mcp-server"

# Check if we're in development mode (mcp-server directory exists as sibling)
if [ -d "$MCP_SERVER_DIR" ]; then
    # Development mode: use local mcp-server
    cd "$MCP_SERVER_DIR"

    # Activate venv if it exists
    if [ -d "venv" ]; then
        source venv/bin/activate
    elif [ -d ".venv" ]; then
        source .venv/bin/activate
    fi

    # Run the MCP server
    exec python -m opta_mcp.server
else
    # Production mode: expect opta_mcp to be installed in system Python
    exec python -m opta_mcp.server
fi
