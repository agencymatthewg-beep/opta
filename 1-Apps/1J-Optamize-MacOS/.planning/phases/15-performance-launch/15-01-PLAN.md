# Plan 15-01: Performance Optimization

wave: 1
autonomous: true

## Overview

Profile and optimize React renders, reduce bundle size, improve startup performance.

## Tasks

### 1. Profile React Renders
**File**: Various components

Use React DevTools Profiler to identify slow renders:

```bash
# Run profiling build
npm run dev -- --profile
```

**Common issues to check:**
- Components re-rendering unnecessarily
- Missing memo() on list items
- Heavy computations in render path
- Expensive effects running too frequently

### 2. Memoize Heavy Components
**File**: Various

Add React.memo to components that render frequently:

```tsx
// src/components/ProcessList.tsx
export const ProcessItem = React.memo(function ProcessItem({ process }) {
  // ... component
});

// src/components/GameCard.tsx
export const GameCard = React.memo(function GameCard({ game, onClick }) {
  // ... component
});

// src/components/TelemetryCard.tsx
export const TelemetryCard = React.memo(function TelemetryCard({ ... }) {
  // ... component
});
```

### 3. Optimize useEffect Dependencies
**File**: Various hooks

Review hooks for unnecessary effect triggers:

```tsx
// BEFORE - runs on every render
useEffect(() => {
  fetchGames();
}, []);

// AFTER - only when needed
const fetchGamesCallback = useCallback(() => {
  fetchGames();
}, []);

useEffect(() => {
  fetchGamesCallback();
}, [fetchGamesCallback]);
```

### 4. Lazy Load Heavy Components
**File**: `src/App.tsx`

Ensure all pages use lazy loading:

```tsx
// Already implemented, verify:
const Dashboard = lazy(() => import('./pages/Dashboard'));
const Games = lazy(() => import('./pages/Games'));
const Optimize = lazy(() => import('./pages/Optimize'));
const Score = lazy(() => import('./pages/Score'));
const Settings = lazy(() => import('./pages/Settings'));
const PinpointOptimize = lazy(() => import('./pages/PinpointOptimize'));

// Add for new pages
```

### 5. Bundle Size Analysis
**File**: `vite.config.ts`

Run bundle analysis:

```bash
npm run build -- --analyze
```

**Optimization targets:**
- Remove unused dependencies
- Check for duplicate packages
- Verify tree-shaking effectiveness
- Consider dynamic imports for large libraries

### 6. Optimize Framer Motion Bundle
**File**: `src/lib/animations.ts`

Import only needed features:

```tsx
// BEFORE - imports everything
import { motion, AnimatePresence } from 'framer-motion';

// AFTER - tree-shakeable imports
import { m as motion, AnimatePresence, LazyMotion, domAnimation } from 'framer-motion';

// In App.tsx wrap with LazyMotion
<LazyMotion features={domAnimation}>
  {children}
</LazyMotion>
```

### 7. Add Performance Metrics Logging
**File**: `src/lib/performance.ts` (new)

```tsx
export function logPerformance(metric: string, value: number) {
  if (process.env.NODE_ENV === 'development') {
    console.log(`[Perf] ${metric}: ${value.toFixed(2)}ms`);
  }
}

export function measureRender(componentName: string) {
  const start = performance.now();
  return () => {
    const duration = performance.now() - start;
    if (duration > 16) {  // More than one frame
      console.warn(`[Perf] Slow render: ${componentName} took ${duration.toFixed(2)}ms`);
    }
  };
}
```

## Verification

1. Run profiling build → Identify slow components
2. Add memoization → Re-profile, see improvement
3. Run `npm run build -- --analyze` → Bundle under 500KB
4. Test app startup → Under 2 seconds to interactive
5. Navigate between pages → No jank, smooth transitions

## Files Modified

- `src/components/ProcessList.tsx`
- `src/components/GameCard.tsx`
- `src/components/TelemetryCard.tsx`
- `src/App.tsx`
- `src/lib/animations.ts`
- `src/lib/performance.ts` (new)
- `vite.config.ts` (if needed)

## Estimated Duration

20-25 minutes
