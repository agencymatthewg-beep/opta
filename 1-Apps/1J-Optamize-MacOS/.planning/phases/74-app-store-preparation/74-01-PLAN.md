---
phase: 74-app-store-preparation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - opta-native/OptaApp/OptaApp/Assets.xcassets/AppIcon.appiconset/Contents.json
  - opta-native/OptaApp/OptaApp/Assets.xcassets/AccentColor.colorset/Contents.json
  - opta-native/OptaApp/OptaApp/Info.plist
  - opta-native/OptaApp/OptaApp.xcodeproj/project.pbxproj
  - opta-native/APPSTORE_METADATA.md
  - opta-native/scripts/archive-and-upload.sh
autonomous: true
---

<objective>
Prepare Opta for Mac App Store submission with app icons, metadata, and archive configuration.

Purpose: Complete all non-visual requirements for App Store submission - asset catalog structure, metadata files, version updates, and build scripts. Icon images will be added separately as PNG files.
Output: App ready for archive and upload with properly configured assets, metadata, and submission scripts.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

**Phase 73 complete:**
@.planning/phases/73-menu-bar-agent/73-01-SUMMARY.md

**Existing release checklist:**
@opta-native/RELEASE_CHECKLIST.md

**Current app configuration:**
@opta-native/OptaApp/OptaApp/Info.plist
@opta-native/OptaApp/OptaApp/OptaApp.entitlements
@opta-native/OptaApp/OptaApp/PrivacyInfo.xcprivacy

**Design reference:**
- Purple accent (#8B5CF6)
- OLED background (#09090B)
- App name: Opta
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Assets.xcassets with AppIcon structure</name>
  <files>
opta-native/OptaApp/OptaApp/Assets.xcassets/Contents.json
opta-native/OptaApp/OptaApp/Assets.xcassets/AppIcon.appiconset/Contents.json
opta-native/OptaApp/OptaApp/Assets.xcassets/AccentColor.colorset/Contents.json
opta-native/OptaApp/OptaApp.xcodeproj/project.pbxproj
  </files>
  <action>
**Create Assets.xcassets structure:**

1. Create `Assets.xcassets/Contents.json`:
   ```json
   {
     "info" : {
       "author" : "xcode",
       "version" : 1
     }
   }
   ```

2. Create `Assets.xcassets/AppIcon.appiconset/Contents.json` with all macOS icon sizes:
   ```json
   {
     "images" : [
       { "filename" : "icon_16x16.png", "idiom" : "mac", "scale" : "1x", "size" : "16x16" },
       { "filename" : "icon_16x16@2x.png", "idiom" : "mac", "scale" : "2x", "size" : "16x16" },
       { "filename" : "icon_32x32.png", "idiom" : "mac", "scale" : "1x", "size" : "32x32" },
       { "filename" : "icon_32x32@2x.png", "idiom" : "mac", "scale" : "2x", "size" : "32x32" },
       { "filename" : "icon_128x128.png", "idiom" : "mac", "scale" : "1x", "size" : "128x128" },
       { "filename" : "icon_128x128@2x.png", "idiom" : "mac", "scale" : "2x", "size" : "128x128" },
       { "filename" : "icon_256x256.png", "idiom" : "mac", "scale" : "1x", "size" : "256x256" },
       { "filename" : "icon_256x256@2x.png", "idiom" : "mac", "scale" : "2x", "size" : "256x256" },
       { "filename" : "icon_512x512.png", "idiom" : "mac", "scale" : "1x", "size" : "512x512" },
       { "filename" : "icon_512x512@2x.png", "idiom" : "mac", "scale" : "2x", "size" : "512x512" }
     ],
     "info" : {
       "author" : "xcode",
       "version" : 1
     }
   }
   ```

3. Create `Assets.xcassets/AccentColor.colorset/Contents.json`:
   ```json
   {
     "colors" : [
       {
         "color" : {
           "color-space" : "srgb",
           "components" : {
             "alpha" : "1.000",
             "blue" : "0.965",
             "green" : "0.361",
             "red" : "0.545"
           }
         },
         "idiom" : "universal"
       }
     ],
     "info" : {
       "author" : "xcode",
       "version" : 1
     }
   }
   ```
   (This is #8B5CF6 in RGB decimal: 139/255=0.545, 92/255=0.361, 246/255=0.965)

4. Update project.pbxproj to include Assets.xcassets:
   - Add PBXFileReference for Assets.xcassets
   - Add to PBXGroup for OptaApp
   - Add PBXBuildFile to Resources build phase

5. Create placeholder README for icon files:
   ```
   opta-native/OptaApp/OptaApp/Assets.xcassets/AppIcon.appiconset/README.md
   ```
   Listing required PNG files and their sizes.

Key: Structure must be valid for Xcode. Icon PNGs will be added manually later.
  </action>
  <verify>
```bash
ls -la /Users/matthewbyrden/Documents/Opta/opta-native/OptaApp/OptaApp/Assets.xcassets/
ls -la /Users/matthewbyrden/Documents/Opta/opta-native/OptaApp/OptaApp/Assets.xcassets/AppIcon.appiconset/
```
Expected: Assets.xcassets structure exists with Contents.json files
  </verify>
  <done>Assets.xcassets exists with AppIcon and AccentColor structures</done>
</task>

<task type="auto">
  <name>Task 2: Update Info.plist and create App Store metadata</name>
  <files>
opta-native/OptaApp/OptaApp/Info.plist
opta-native/APPSTORE_METADATA.md
  </files>
  <action>
**Update Info.plist:**

1. Update version to 9.0.0:
   - CFBundleShortVersionString: 9.0.0
   - CFBundleVersion: 1 (build number, increment on each upload)

2. Update CFBundleIconFile to reference asset catalog:
   - Remove CFBundleIconFile (empty string)
   - Xcode uses Assets.xcassets automatically when present

3. Update LSApplicationCategoryType:
   - Change from `public.app-category.productivity` to `public.app-category.utilities`
   - Opta is a system utility/optimizer

4. Add NSHumanReadableCopyright:
   ```xml
   <key>NSHumanReadableCopyright</key>
   <string>Copyright © 2025-2026 Opta. All rights reserved.</string>
   ```

5. Add usage descriptions for any APIs that need them (if not present):
   - Check if NSUserNotificationsUsageDescription needed

**Create APPSTORE_METADATA.md:**

```markdown
# Opta - App Store Metadata

## App Information

**App Name:** Opta
**Subtitle:** System Optimizer & Performance Monitor (30 chars max)
**Bundle ID:** com.opta.optimizer
**Category:** Utilities
**Content Rating:** 4+ (No objectionable content)

## Description (4000 chars max)

Opta is the intelligent system optimizer for Mac. Monitor your hardware performance in real-time, detect resource-hungry processes, and optimize with one click.

**Key Features:**
• Real-time CPU, GPU, and Memory monitoring with beautiful visualizations
• Intelligent optimization that learns your preferences
• Game detection with automatic performance profiles
• Background agent mode for always-on monitoring
• Smart notifications for optimization opportunities
• Premium glass UI with smooth 120fps animations

**Why Opta?**
Unlike other system tools, Opta uses machine learning to understand your usage patterns and provide personalized recommendations. The stunning visual design makes monitoring your system a pleasure, not a chore.

**Built for Mac:**
Native SwiftUI and Metal rendering. No Electron, no web views. Pure performance.

## Keywords (100 chars max, comma-separated)

optimizer,performance,monitor,cpu,gpu,memory,gaming,system,utility,mac,native,m1,m2,m3,apple silicon

## What's New (v9.0.0)

- Complete native rewrite with SwiftUI and Metal
- Games Library with automatic detection
- Agent Mode for background monitoring
- Smart notifications for optimization opportunities
- Improved settings with custom profiles
- Enhanced keyboard shortcuts

## Support URL
https://opta.app/support

## Privacy Policy URL
https://opta.app/privacy

## Marketing URL
https://opta.app

## Screenshots Required

1. **Dashboard** (1280x800 or 2560x1600 @2x)
   - Main dashboard with telemetry cards and OptaRing

2. **Games Library** (1280x800)
   - Game detection with cards and platform badges

3. **Settings** (1280x800)
   - Profile management or theme customization

4. **Menu Bar** (detail shot)
   - Menu bar popover with quick actions

5. **Agent Mode** (optional)
   - Agent mode indicator and contextual actions

## App Icon Guidelines

Icon should convey:
- Performance/optimization (bolt, gauge, ring)
- Premium quality (glass effect, depth)
- Purple accent (#8B5CF6) on dark background

Sizes needed:
- 1024x1024 (App Store)
- 512x512, 256x256, 128x128, 64x64, 32x32, 16x16 (@1x and @2x)
```

Key: Metadata follows Apple's guidelines. URLs are placeholders until live.
  </action>
  <verify>
```bash
grep "9.0.0" /Users/matthewbyrden/Documents/Opta/opta-native/OptaApp/OptaApp/Info.plist
ls -la /Users/matthewbyrden/Documents/Opta/opta-native/APPSTORE_METADATA.md
```
Expected: Version updated and metadata file exists
  </verify>
  <done>Info.plist updated to v9.0.0 and APPSTORE_METADATA.md created</done>
</task>

<task type="auto">
  <name>Task 3: Create archive and upload script</name>
  <files>
opta-native/scripts/archive-and-upload.sh
opta-native/RELEASE_CHECKLIST.md
  </files>
  <action>
**Create scripts/archive-and-upload.sh:**

```bash
#!/bin/bash
set -e

# Opta Archive and Upload Script
# Usage: ./scripts/archive-and-upload.sh [--archive-only]

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECT_DIR="$(dirname "$SCRIPT_DIR")"
XCODE_PROJECT="$PROJECT_DIR/OptaApp/OptaApp.xcodeproj"
SCHEME="OptaApp"
ARCHIVE_PATH="$PROJECT_DIR/build/Opta.xcarchive"
EXPORT_PATH="$PROJECT_DIR/build/export"

echo "=== Opta Archive & Upload ==="
echo "Project: $XCODE_PROJECT"
echo ""

# Check for Xcode
if ! command -v xcodebuild &> /dev/null; then
    echo "ERROR: xcodebuild not found. Install Xcode Command Line Tools."
    exit 1
fi

# Clean build directory
echo "[1/5] Cleaning build directory..."
rm -rf "$PROJECT_DIR/build"
mkdir -p "$PROJECT_DIR/build"

# Build Rust libraries first (if needed)
if [ -f "$PROJECT_DIR/scripts/build-xcframework.sh" ]; then
    echo "[2/5] Building Rust libraries..."
    "$PROJECT_DIR/scripts/build-xcframework.sh"
else
    echo "[2/5] Skipping Rust build (manual libraries expected)"
fi

# Archive
echo "[3/5] Creating archive..."
xcodebuild archive \
    -project "$XCODE_PROJECT" \
    -scheme "$SCHEME" \
    -configuration Release \
    -archivePath "$ARCHIVE_PATH" \
    CODE_SIGN_STYLE=Automatic \
    -allowProvisioningUpdates

if [ ! -d "$ARCHIVE_PATH" ]; then
    echo "ERROR: Archive failed"
    exit 1
fi

echo "Archive created: $ARCHIVE_PATH"

# Check if archive-only mode
if [ "$1" == "--archive-only" ]; then
    echo ""
    echo "=== Archive Only Mode ==="
    echo "Archive ready at: $ARCHIVE_PATH"
    echo "Open in Xcode: open $ARCHIVE_PATH"
    exit 0
fi

# Export for App Store
echo "[4/5] Exporting for App Store..."

# Create export options plist
cat > "$PROJECT_DIR/build/ExportOptions.plist" << 'EOF'
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
    <key>method</key>
    <string>app-store-connect</string>
    <key>destination</key>
    <string>upload</string>
    <key>signingStyle</key>
    <string>automatic</string>
    <key>uploadSymbols</key>
    <true/>
    <key>manageAppVersionAndBuildNumber</key>
    <false/>
</dict>
</plist>
EOF

xcodebuild -exportArchive \
    -archivePath "$ARCHIVE_PATH" \
    -exportOptionsPlist "$PROJECT_DIR/build/ExportOptions.plist" \
    -exportPath "$EXPORT_PATH" \
    -allowProvisioningUpdates

echo "[5/5] Upload complete!"
echo ""
echo "=== Next Steps ==="
echo "1. Go to App Store Connect: https://appstoreconnect.apple.com"
echo "2. Select 'Opta' app"
echo "3. Create new version if needed"
echo "4. Select the uploaded build"
echo "5. Fill in What's New text"
echo "6. Submit for review"
echo ""
echo "Archive: $ARCHIVE_PATH"
echo "Exported: $EXPORT_PATH"
```

**Update RELEASE_CHECKLIST.md:**

Add v9.0 specific items to the checklist:
- Update version references from v8.0 to v9.0
- Add Games Library verification
- Add Agent Mode verification
- Add notification permission check

Key: Script uses automatic signing for simplicity. Team ID comes from Xcode settings.
  </action>
  <verify>
```bash
ls -la /Users/matthewbyrden/Documents/Opta/opta-native/scripts/archive-and-upload.sh
head -20 /Users/matthewbyrden/Documents/Opta/opta-native/scripts/archive-and-upload.sh
```
Expected: Script exists and is executable
  </verify>
  <done>Archive script created and release checklist updated</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Assets.xcassets/Contents.json exists
- [ ] Assets.xcassets/AppIcon.appiconset/Contents.json has all 10 macOS icon sizes
- [ ] Assets.xcassets/AccentColor.colorset/Contents.json has purple (#8B5CF6)
- [ ] project.pbxproj includes Assets.xcassets reference
- [ ] Info.plist version is 9.0.0
- [ ] Info.plist category is utilities
- [ ] APPSTORE_METADATA.md exists with description, keywords, screenshots list
- [ ] scripts/archive-and-upload.sh exists and is executable
- [ ] RELEASE_CHECKLIST.md updated for v9.0
</verification>

<success_criteria>
- Xcode project opens without asset catalog errors
- App icon structure ready for PNG files
- Accent color matches design system purple
- App Store metadata documented for submission
- One-command archive and upload workflow
- Version correctly set to 9.0.0
</success_criteria>

<output>
After completion, create `.planning/phases/74-app-store-preparation/74-01-SUMMARY.md`
</output>
