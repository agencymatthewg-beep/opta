# Opta Local iOS — Guardrails

> Hard rules that must NEVER be violated. Read before writing code.

---

## Global Compliance (Inherited — Do Not Modify)

From `~/Synced/AI26/2-Bot-Ops/2A-Compliance/RULES-GLOBAL.md`:

- **C01:** No data exfiltration without approval
- **C02:** No destructive commands without "yes, delete"
- **C03:** No external posts/emails without approval
- **C04:** No modifying RULES-GLOBAL.md
- **C05:** No bypassing authentication
- **C06:** No executing untrusted code without review

## Credential Management

- **NEVER** hardcode API keys, admin keys, or tokens in source code
- Admin keys stored in iOS Keychain — never UserDefaults
- No credentials in Info.plist or asset catalogs
- If a key is accidentally committed, rotate immediately

---

## Platform Rules

- **G-I01:** SwiftUI only — no UIKit unless absolutely necessary (e.g., camera)
- **G-I02:** iOS 17+ minimum deployment target
- **G-I03:** Swift strict concurrency — all `@Observable` classes are `@MainActor`
- **G-I04:** SF Symbols only — no custom icon assets
- **G-I05:** `/frontend-design` skill MUST be used for ALL view creation
- **G-I06:** No force unwraps (`!`) — `guard let` or `if let` always
- **G-I07:** No `AnyView` — use `@ViewBuilder` and concrete types
- **G-I08:** No Combine — prefer async/await and Observation framework
- **G-I09:** No Alamofire or third-party HTTP — URLSession only
- **G-I10:** Dark mode only — OLED background `#09090b`
- **G-I11:** Spring physics for all animations — `.optaSpring` modifier
- **G-I12:** Haptic feedback via `OptaHaptics.shared` — never raw `UIImpactFeedbackGenerator`

## Performance Floors

- **G-P01:** App launch to dashboard: <2 seconds
- **G-P02:** Bonjour discovery: <1 second on same subnet
- **G-P03:** Streaming chat first token: <200ms after send (LAN)
- **G-P04:** Memory usage: <100MB during active chat
- **G-P05:** No blocking the main thread — all I/O is async

## Architecture Rules

- **G-A01:** Protocol-oriented — depend on protocols, not concrete types
- **G-A02:** All network calls through `LMXClientProtocol` — no raw URLSession in views
- **G-A03:** ViewModels are `@Observable @MainActor` — never raw state in views
- **G-A04:** Error states handled in every view — no silent failures
- **G-A05:** Background SSE suspended when app backgrounded (battery)

## Anti-Features (Explicitly Rejected)

- **Never** add on-device model inference
- **Never** add a light theme
- **Never** add cloud API fallback
- **Never** add a full file browser or IDE
- **Never** store credentials in UserDefaults or plist

## Testing Requirements

- All ViewModels must have unit tests with mock LMXClient
- Bonjour discovery must be testable with mock NWBrowser
- Critical flows (connect, chat, load model) tested
- `swift build` must succeed before any commit

---

*Violating these rules is a bug. If a guardrail needs changing, update this file and record in docs/DECISIONS.md.*

*Generated by OPIS v2.0 — 2026-02-18*
