---
phase: 18-windows-platform
plan: 02
type: execute
wave: 1
depends_on: []
files_modified: [mcp-server/src/opta_mcp/conflicts.py, mcp-server/src/opta_mcp/windows_registry.py]
autonomous: true
---

<objective>
Enhance Windows conflict detection with Registry-based installed program scanning for more comprehensive detection of optimization tools.

Purpose: Process-based detection only catches RUNNING tools. Registry scanning catches INSTALLED tools even when not running, giving users complete visibility into potential conflicts.
Output: Windows Registry scanning module and enhanced conflict detection.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@mcp-server/src/opta_mcp/conflicts.py
@mcp-server/src/opta_mcp/processes.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Windows Registry scanning module</name>
  <files>mcp-server/src/opta_mcp/windows_registry.py</files>
  <action>
Create new module for Windows Registry operations:

1. Function `is_windows()` - Check if running on Windows
2. Function `scan_installed_programs()` - Scan Windows Registry for installed programs:
   - Check HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall
   - Check HKLM\SOFTWARE\WOW6432Node\Microsoft\Windows\CurrentVersion\Uninstall (32-bit apps on 64-bit)
   - Check HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall (user installs)
   - Return list of dicts with: name, publisher, install_location, uninstall_string
3. Function `check_registry_key_exists(key_path)` - Check if specific registry key exists

Use winreg module (stdlib, Windows-only). Guard all winreg imports with platform check.
On non-Windows, functions should return empty results gracefully (no errors).
Do NOT use ctypes or win32api - stick to winreg for simplicity.
  </action>
  <verify>python -c "from opta_mcp.windows_registry import scan_installed_programs; print(scan_installed_programs())" (returns empty list on macOS/Linux, list of programs on Windows)</verify>
  <done>Windows Registry module created with platform-safe scanning functions</done>
</task>

<task type="auto">
  <name>Task 2: Enhance conflict detection with Registry scanning</name>
  <files>mcp-server/src/opta_mcp/conflicts.py</files>
  <action>
Update conflicts.py to use Registry scanning on Windows:

1. Add import: from opta_mcp.windows_registry import scan_installed_programs, is_windows
2. Add REGISTRY_PATTERNS dict mapping tool_id to registry name patterns:
   - "geforce_experience": ["NVIDIA GeForce Experience", "NVIDIA Corporation"]
   - "razer_cortex": ["Razer Cortex", "Razer Synapse"]
   - "msi_afterburner": ["MSI Afterburner", "RivaTuner Statistics Server"]
   - "omen_hub": ["OMEN Gaming Hub", "HP OMEN Command Center"]
3. Create function `detect_installed_conflicts()` - On Windows, scan registry and match against REGISTRY_PATTERNS
4. Modify `get_conflict_summary()` to merge installed conflicts with running conflicts:
   - Add "installed" field to conflict info (bool)
   - Add "running" field to conflict info (bool)
   - A tool can be installed=true, running=false (or both)
5. Update return format to include both detection methods

Maintain backward compatibility - existing fields remain unchanged.
macOS/Linux behavior unchanged (registry scanning returns empty).
  </action>
  <verify>python -c "from opta_mcp.conflicts import get_conflict_summary; import json; print(json.dumps(get_conflict_summary(), indent=2))"</verify>
  <done>Conflict detection enhanced with Registry scanning, returns installed + running status</done>
</task>

<task type="auto">
  <name>Task 3: Update TypeScript types for enhanced conflicts</name>
  <files>src/types/conflicts.ts</files>
  <action>
Update ConflictInfo interface to include new fields:
1. Add `installed: boolean` - Whether tool is installed (from Registry)
2. Add `running: boolean` - Whether tool is currently running (from processes)

These fields are optional for backward compatibility (existing code may not send them).
Add JSDoc comments explaining each field.
  </action>
  <verify>npx tsc --noEmit (no type errors)</verify>
  <done>TypeScript types updated with installed/running fields</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] windows_registry.py exists with scan_installed_programs function
- [ ] conflicts.py imports and uses Registry scanning on Windows
- [ ] conflicts.ts has installed/running fields
- [ ] npm run build succeeds
- [ ] Python module imports work: python -c "from opta_mcp.conflicts import detect_running_conflicts"
</verification>

<success_criteria>
- All tasks completed
- Registry scanning works on Windows, gracefully skips on macOS/Linux
- Conflict info includes both installed and running status
- No breaking changes to existing API
</success_criteria>

<output>
After completion, create `.planning/phases/18-windows-platform/18-02-SUMMARY.md`
</output>
