# Plan 15-02: macOS-Specific Polish

wave: 1
autonomous: true

## Overview

Test and polish all flows on macOS Intel and ARM, fix platform-specific issues.

## Tasks

### 1. Test on macOS Intel
**Environment**: Mac with Intel processor

Run full test suite:
- [ ] App launches successfully
- [ ] Window management works (resize, minimize, fullscreen)
- [ ] Native menus function correctly
- [ ] GPU detection works (if discrete GPU present)
- [ ] Process management functions
- [ ] File system access works (~/.opta/)

### 2. Test on macOS ARM (Apple Silicon)
**Environment**: Mac with M-series chip

Run full test suite:
- [ ] App launches successfully (native ARM build)
- [ ] Performance is acceptable (no Rosetta lag)
- [ ] GPU detection returns Apple GPU info
- [ ] All telemetry functions work
- [ ] MCP server runs natively

### 3. Fix Platform-Specific Styling
**File**: `src/index.css`

macOS-specific adjustments:

```css
/* macOS vibrancy support */
@supports (-webkit-backdrop-filter: blur(10px)) {
  .glass {
    -webkit-backdrop-filter: blur(20px);
    backdrop-filter: blur(20px);
  }
}

/* macOS window controls spacing */
.titlebar-drag-region {
  -webkit-app-region: drag;
  height: 28px;
}

/* Respect system accent color */
@media (prefers-color-scheme: dark) {
  :root {
    --primary: var(--system-accent, 142 76% 36%);
  }
}
```

### 4. Test Window Behavior
**File**: `src-tauri/tauri.conf.json`

Verify macOS window settings:

```json
{
  "windows": [
    {
      "title": "Opta",
      "width": 1200,
      "height": 800,
      "minWidth": 800,
      "minHeight": 600,
      "titleBarStyle": "Overlay",
      "hiddenTitle": true,
      "transparent": true
    }
  ]
}
```

### 5. Test Native Dialogs
**File**: `src-tauri/src/lib.rs`

Verify native dialogs work:

```rust
#[tauri::command]
async fn show_native_dialog(message: &str) -> Result<bool, String> {
    use tauri::api::dialog::{ask, MessageDialogKind};

    ask(None::<&str>, "Opta", message, MessageDialogKind::Info)
        .await
        .map_err(|e| e.to_string())
}
```

### 6. Test File System Access
**File**: Various

Verify all file operations work:

```tsx
// Test paths
const paths = [
  '~/.opta/profile.json',
  '~/.opta/badges/',
  '~/.opta/sessions/',
];

for (const path of paths) {
  const exists = await checkPath(path);
  console.log(`${path}: ${exists ? 'OK' : 'MISSING'}`);
}
```

### 7. Menu Bar Integration
**File**: `src-tauri/src/lib.rs`

Verify macOS menu bar works:

```rust
// Check menu items
// - Opta menu (About, Preferences, Quit)
// - Edit menu (Cut, Copy, Paste)
// - Window menu (Minimize, Zoom, etc.)
```

### 8. Document Known Issues
**File**: `.planning/phases/15-performance-launch/KNOWN_ISSUES.md` (new)

```markdown
# macOS Known Issues

## Verified Working
- App launch on Intel and ARM
- Window management
- GPU detection (discrete and integrated)
- File system access

## Known Limitations
- [List any discovered limitations]

## Workarounds
- [List any necessary workarounds]
```

## Verification

1. Build and run on macOS Intel → All tests pass
2. Build and run on macOS ARM → All tests pass
3. Test window controls → Minimize, maximize, close work
4. Test file dialogs → Native dialogs appear
5. Test menu bar → All menu items function

## Files Modified

- `src/index.css` (platform-specific styles)
- `src-tauri/tauri.conf.json` (window config)
- `src-tauri/src/lib.rs` (native dialogs)
- `.planning/phases/15-performance-launch/KNOWN_ISSUES.md` (new)

## Estimated Duration

20-25 minutes (depends on testing thoroughness)
