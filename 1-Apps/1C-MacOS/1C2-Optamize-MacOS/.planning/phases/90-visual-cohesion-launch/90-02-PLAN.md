---
phase: 90-visual-cohesion-launch
plan: 02
title: Visual Consistency Audit & Build Verification
subsystem: qa
wave: 2
depends_on: ["90-01"]
files_modified: [opta-native/OptaApp/OptaApp/Views/Components/CircularMenuView.swift, opta-native/OptaApp/OptaApp/Views/Components/SparklineView.swift]
autonomous: true
scope: small
tags: [swift, audit, accessibility, performance, verification, build]
---

# Plan 90-02: Visual Consistency Audit & Build Verification

## Objective

Final QA pass for the v11.0 Refined Obsidian Aesthetic milestone. Verify:
1. No remaining inconsistencies in color temperature adoption
2. Organic motion modifiers applied where needed (gaps from Phase 88)
3. Accessibility (reduce-motion) respected across all animated components
4. Clean build with no warnings related to v11.0 work
5. Document the final state of the aesthetic system

## Execution Context

### V11.0 Aesthetic System (Phases 81-89)
- **Phase 81**: Obsidian ring material (OptaRingView Metal rendering)
- **Phase 82**: Branch energy shader (wgpu render pipeline)
- **Phase 83**: Obsidian panel system (glass panels with depth)
- **Phase 84**: Energy branch components (CircularMenu, TextZone)
- **Phase 85**: Dashboard obsidian refresh (3 plans)
- **Phase 86**: Navigation energy language (CircularMenu + navigation)
- **Phase 87**: Settings & library alignment (games, settings, profiles)
- **Phase 88**: Organic motion system (modifiers, springs, reduce-motion)
- **Phase 89**: Color temperature refinement (state machine, environment)
- **Phase 90-01**: Complete temperature conversion (remaining files)

### Organic Motion Modifiers Available
- `.organicAppear(delay:)` — staggered entrance animation
- `.organicHover()` — subtle hover scale + shadow
- `.organicPulse(intensity:)` — breathing animation for active elements
- `.organicFloat(amplitude:)` — floating idle animation

### Files Already Using Organic Motion
- QuickActions.swift (organicAppear, organicHover)
- ScoreDisplay.swift (organicPulse)
- TelemetryCard.swift (organicAppear)
- GameCardView.swift (organicHover)
- GamesLibraryView.swift (organicAppear)

### Files That May Need Organic Motion
- GameDetailView.swift — section headers could use organicAppear
- ProfileManagerView.swift — profile cards could use organicHover
- KeyboardShortcutsView.swift — shortcut rows could use organicAppear
- MenuBarView.swift — popover content could use organicAppear
- SettingsView.swift — tab navigation items

## Tasks

### Task 1: Organic Motion Gap Analysis & Application

**Audit scope:** All files converted in 90-01 that don't yet have organic motion.

**Analysis rules:**
- **organicAppear**: Apply to list items, cards, sections that animate in (with stagger delays: 0.05 * index)
- **organicHover**: Apply to interactive cards/buttons that have hover states
- **organicPulse**: Only for continuously active indicators (score rings, status dots)
- **organicFloat**: Only for decorative elements (not interactive content)
- **DO NOT over-apply**: Skip if the view is purely structural (backgrounds, dividers, static labels)
- **Reduce-motion**: All organic modifiers already respect `@Environment(\.accessibilityReduceMotion)` internally — no extra work needed per-view

**Changes (targeted additions only):**

1. **GamesLibraryView.swift** — Verify game list items have `organicAppear` (may already have from Phase 88)
2. **GameDetailView.swift** — Add `.organicAppear(delay: 0.05 * index)` to section ForEach items (optimization profiles, performance metrics) if they don't have entrance animation
3. **ProfileManagerView.swift** — Add `.organicHover()` to profile cards if they have hover states
4. **SettingsView.swift** — Add `.organicAppear(delay:)` to settings sections/rows if not present
5. **KeyboardShortcutsView.swift** — Add `.organicAppear()` to shortcut item rows
6. **MenuBarView.swift** — Add `.organicAppear()` to popover content sections

**IMPORTANT**: Before adding any modifier, READ the file to verify it's not already present. Phase 88 may have covered more than documented.

**Verification:** Build compiles, no animation regressions

### Task 2: Static Sector Colors & Default Params Cleanup

**Files:** `CircularMenuView.swift`, `SparklineView.swift`

**Changes for CircularMenuView defaultSectors:**
1. The static `defaultSectors` uses `Color(hex: "8B5CF6")` for all 4 sectors — this was explicitly noted as out-of-scope in 89-03 (accessibility view)
2. However, for v11.0 completion, convert these to use a fixed `.purple` system color instead of the hex literal — this removes the hardcoded hex while keeping accessibility-safe behavior
3. Change lines 25-28: Replace `Color(hex: "8B5CF6")` with `Color.purple` (system purple is accessibility-safe and close enough for the static fallback)

**Changes for SparklineView:**
1. If 90-01 made the color parameter optional, verify the default behavior works when no color is passed
2. The `TelemetryCard` passes its own color — verify it uses `colorTemp.violetColor` from its environment-aware implementation (already done in 89-02)
3. No additional changes if 90-01 handled this correctly

**Verification:** Build compiles, circular menu accessibility and sparklines work correctly

### Task 3: Final Build Verification & Audit Report

**No file modifications — verification only.**

**Steps:**
1. Run full build:
   ```bash
   cd opta-native && xcodebuild build -project OptaApp/OptaApp.xcodeproj -scheme OptaApp -destination 'platform=macOS' 2>&1 | tail -20
   ```

2. Audit remaining hardcoded violet (should only be exclusions):
   ```bash
   grep -rn "8B5CF6\|8b5cf6" opta-native/OptaApp/OptaApp/ --include="*.swift" | grep -v "ColorTemperature\|README\|ThemeCustomization\|Game\.swift\|AgentModeManager\|OptaRingView\|OptaTextStyle\|// "
   ```

3. Verify all view files have temperature environment OR documented exclusion:
   ```bash
   # Files that SHOULD have @Environment(\.colorTemperature):
   grep -rL "colorTemperature" opta-native/OptaApp/OptaApp/Views/ opta-native/OptaApp/OptaApp/MenuBar/ --include="*.swift" | grep -v "MetalRenderView\|ContentView\|OptaText"
   ```

4. Verify organic motion coverage:
   ```bash
   grep -rl "organicAppear\|organicHover\|organicPulse\|organicFloat" opta-native/OptaApp/OptaApp/Views/ opta-native/OptaApp/OptaApp/MenuBar/ --include="*.swift" | sort
   ```

5. Count temperature-aware files (target: 17+ files):
   ```bash
   grep -rl "colorTemperature" opta-native/OptaApp/OptaApp/ --include="*.swift" | wc -l
   ```

6. Verify reduce-motion respected in OrganicMotionModifiers.swift (read and confirm guard clause exists)

**Expected Results:**
- BUILD SUCCEEDED with zero v11.0-related warnings
- Only documented exclusions remain with hardcoded violet
- 17+ files use `@Environment(\.colorTemperature)`
- 10+ view files use organic motion modifiers
- OrganicMotionModifiers respects reduce-motion

**Verification:** All audit checks pass

## Verification

After all tasks:
```bash
cd opta-native && xcodebuild build -project OptaApp/OptaApp.xcodeproj -scheme OptaApp -destination 'platform=macOS' 2>&1 | tail -5
```

Expected: **BUILD SUCCEEDED**

## Success Criteria

- [ ] Organic motion applied to GameDetailView section items
- [ ] Organic motion applied to ProfileManagerView cards (if hover-capable)
- [ ] Organic motion applied to SettingsView rows
- [ ] Organic motion applied to KeyboardShortcutsView items
- [ ] Organic motion applied to MenuBarView popover sections
- [ ] CircularMenuView defaultSectors uses Color.purple (accessibility-safe)
- [ ] SparklineView default color verified working with temperature
- [ ] Final build succeeds
- [ ] Hardcoded violet audit passes (only exclusions remain)
- [ ] 17+ files use colorTemperature environment
- [ ] 10+ view files use organic motion modifiers
- [ ] Reduce-motion verified in OrganicMotionModifiers
- [ ] v11.0 Refined Obsidian Aesthetic milestone ready for release

## Output

- SUMMARY.md with audit results, coverage numbers, final state documentation
- Per-task atomic commits (only Tasks 1-2 produce commits; Task 3 is verification-only)
- Milestone completion readiness confirmation
