---
phase: 86-navigation-energy-language
plan: 02
title: Swift Navigation Obsidian Refresh
type: feature
wave: 2
autonomous: true
depends_on: [86-01]
files_modified:
  - opta-native/OptaApp/OptaApp/Views/Components/CircularMenuView.swift
  - opta-native/OptaApp/OptaApp/Bridge/CircularMenuBridge.swift
  - opta-native/OptaApp/OptaApp/MenuBar/MenuBarCircularMenuButton.swift
  - opta-native/OptaApp/OptaApp/Navigation/CircularMenuNavigation.swift
files_created: []
estimated_tasks: 3
---

<objective>
Update all Swift circular menu views to match the obsidian aesthetic: obsidian containers,
branch-energy violet hover states, organic animations, and unified keyboard focus indicators.
Remove per-sector colors in favor of unified violet palette.
</objective>

<execution_context>
@opta-native/OptaApp/OptaApp/Views/Components/CircularMenuView.swift
@opta-native/OptaApp/OptaApp/Bridge/CircularMenuBridge.swift
@opta-native/OptaApp/OptaApp/MenuBar/MenuBarCircularMenuButton.swift
@opta-native/OptaApp/OptaApp/Navigation/CircularMenuNavigation.swift
</execution_context>

<context>
Plan 86-01 rewrote the Rust shader and FFI to support obsidian + branch energy.
This plan updates the Swift layer to:
1. Match the obsidian visual language in SwiftUI overlays
2. Use the new FFI (branch_energy_level, removed glow_color)
3. Apply unified violet palette to menu bar and navigation triggers
4. Add keyboard focus branch glow indicators

Current state:
- CircularMenuView: Per-sector colors (blue, green, amber, purple), glass-like center indicator
- CircularMenuBridge: setGlowColor(r,g,b) → removed in 86-01
- MenuBarCircularMenuButton: Blue-purple gradient ring, multi-color sector dots
- CircularMenuNavigation: Per-destination accent colors (blue, green, amber, purple, red, cyan)

Target state:
- All sectors use unified violet palette (8B5CF6/7C3AED/A855F7)
- Center indicator: obsidian fill (0A0A0F) with subtle violet ring
- Sector highlight: violet glow with branch-energy radial gradient
- Menu bar button: obsidian base with violet ring, branch-energy hover glow
- Keyboard focus: branch glow ring around focused sector (violet shadow)
- Navigation colors: unified violet (functional icons still use SF Symbols for distinction)
</context>

<tasks>
<task id="1" name="circular-menu-view-obsidian">
<description>
Update CircularMenuView.swift for obsidian aesthetic and unified violet.

Changes:
1. CircularMenuSector.defaultSectors: All colors → Color(hex: "8B5CF6")
2. sectorView: Replace per-sector color fills with obsidian:
   - Background: Color(hex: "0A0A0F") with subtle inner shadow
   - Highlighted: radial gradient glow from violet (branch-energy style)
   - Border: 1px white 0.08 opacity (non-highlighted), 1.5px violet 0.5 (highlighted)
3. centerIndicator: Replace gradient with solid obsidian fill (0A0A0F),
   violet strokeBorder (8B5CF6 0.3), branch-energy icon glow
4. Glow effect on highlighted sector:
   - Replace colored blur stroke with violet radial gradient
   - Scale from inner edge outward (branch growth direction)
5. Keyboard focus indicator:
   - When keyboardIndex matches sector, add violet shadow glow ring (0.4 opacity, radius 6)
   - Distinct from hover highlight (thinner, pulsing)
6. Icon styling: All icons use white 0.7 (normal) → white 1.0 (highlighted)
   Remove per-sector color from icons
7. Background dimming: Keep black 0.3 but add subtle violet tint (0.02)
8. reduceMotion: Skip all glow/gradient effects, use solid violet border for highlight

Remove dependency on configurable glowColor property (hardcode violet).
</description>
<verification>
- Xcode builds without errors
- Preview shows obsidian sectors with violet highlight
- Keyboard navigation shows focus ring
- reduceMotion shows simplified highlight
</verification>
</task>

<task id="2" name="circular-menu-bridge-update">
<description>
Update CircularMenuBridge.swift to match new FFI from 86-01.

Changes:
1. Remove setGlowColor(r:g:b:) method and setGlowColor(_ color:) method
2. Remove glowColor from CircularMenuConfig struct
3. Add branchEnergyLevel: Float = 0.5 to CircularMenuConfig
4. Add obsidianRoughness: Float = 0.03 to CircularMenuConfig
5. Update ffiConfig computed property:
   - Remove glow_color_r/g/b, glow_intensity
   - Add branch_energy_level, obsidian_roughness
6. Add setBranchEnergy(_ energy: Float) method:
   - Calls opta_circular_menu_set_branch_energy(menu, energy)
   - Updates config.branchEnergyLevel
7. Add branchEnergyLevel computed property (get only, reads from config)
8. Update CircularMenuView.configureMenu():
   - Remove glowColor extraction logic
   - Set config.branchEnergyLevel from system energy (or default 0.5)

Also update CircularMenuNavigation.swift:
- CircularMenuDestination.color: All cases → Color(hex: "8B5CF6")
- Keep iconName distinct per destination (icons provide differentiation)
- Remove per-destination color switching
</description>
<verification>
- Xcode builds without errors
- Bridge correctly creates menu without glow color params
- setBranchEnergy updates internal state
</verification>
</task>

<task id="3" name="menu-bar-obsidian-refresh">
<description>
Update MenuBarCircularMenuButton.swift for obsidian aesthetic.

MenuBarCircularMenuButton changes:
1. Ring icon: Replace blue-purple gradient with solid violet (8B5CF6) strokeBorder
2. Sector indicator dots: All use violet (8B5CF6) instead of per-sector colors
3. Background: Replace white opacity fills with obsidian (0A0A0F) base
4. Hover state: violet radial glow (branch-energy style) instead of white opacity
5. Border: violet 0.2 opacity (normal), violet 0.4 (hovered)

MenuBarQuickNavigateRow changes:
1. Icon gradient: Solid violet instead of blue-purple gradient
2. Background: obsidian fill with violet border on hover
3. Keyboard shortcut badge: obsidian fill (0A0A0F) with violet 0.2 border

CompactCircularMenuTrigger changes:
1. Background ring: obsidian fill with violet radial glow on hover
2. Ring outline: solid violet (8B5CF6) instead of gradient
3. Center dot: violet (8B5CF6) — unchanged

Remove sectorColor() helper (no longer needed with unified palette).
</description>
<verification>
- Xcode builds without errors
- Menu bar button shows obsidian styling
- Hover states show violet glow
- Compact trigger matches aesthetic
</verification>
</task>
</tasks>

<output>
After this plan:
- All circular menu UI uses obsidian containers with branch-energy violet highlights
- Menu bar triggers match the refined aesthetic
- Keyboard focus has distinct branch glow indicator
- Navigation uses unified violet palette (icons provide destination distinction)
- Ready for Phase 87 (Settings & Library Alignment)
</output>
