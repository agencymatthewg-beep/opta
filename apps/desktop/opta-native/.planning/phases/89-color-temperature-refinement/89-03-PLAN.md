---
phase: 89-color-temperature-refinement
plan: 03
title: Menu Bar & Games Temperature Integration
subsystem: ui
wave: 2
depends_on: ["89-01"]
files_modified: [opta-native/OptaApp/OptaApp/MenuBar/MenuBarCircularMenuButton.swift, opta-native/OptaApp/OptaApp/Views/Games/GameCardView.swift, opta-native/OptaApp/OptaApp/Views/Components/CircularMenuView.swift, opta-native/OptaApp/OptaApp/OptaAppApp.swift]
autonomous: true
scope: small
tags: [swift, swiftui, color-temperature, menu-bar, games, app-root]
---

# Plan 89-03: Menu Bar & Games Temperature Integration

## Objective

Apply ColorTemperature to remaining violet-heavy components (menu bar buttons, game cards, circular menu) and install the ColorTemperatureProvider at the app root. After this plan, every component in the app responds to color temperature state — no hardcoded `#8B5CF6` remains for accent colors.

## Execution Context

### Patterns from 89-01
- `@Environment(\.colorTemperature) private var colorTemp` — read current state
- `colorTemp.violetColor` — state-appropriate violet
- `colorTemp.tintColor` — primary tint (violet/amber)
- `colorTemp.glowOpacity` — glow intensity
- `.withColorTemperature()` — provider modifier for app root

### Key References
- `opta-native/OptaApp/OptaApp/Design/ColorTemperature.swift` — state model (from 89-01)
- `opta-native/OptaApp/OptaApp/Design/ColorTemperatureEnvironment.swift` — environment + provider (from 89-01)

## Context

### Current State
- **MenuBarCircularMenuButton.swift**: 3 structs each define `private let branchViolet = Color(hex: "8B5CF6")` — 3 duplicate definitions
- **GameCardView.swift**: Branch-energy RadialGradient hover uses inline `Color(hex: "8B5CF6")` references from Phase 87
- **CircularMenuView.swift**: Has `private let branchViolet = Color(hex: "8B5CF6")` for accent
- **OptaAppApp.swift**: App entry point — needs `.withColorTemperature()` to publish state

### Design Rules
- Menu bar: respect temperature but keep visibility (even dormant state needs some contrast for usability)
- GameCardView: temperature affects hover glow color, but functional game status colors stay
- CircularMenuView: temperature affects sector accents
- OptaAppApp.swift: minimal change — just add `.withColorTemperature()` modifier
- Keep all organic motion modifiers from Phase 88 unchanged
- Keep branch-energy RadialGradient logic from Phase 87 — only the COLOR source changes

## Tasks

### Task 1: App Root Temperature Provider

**Files:** `opta-native/OptaApp/OptaApp/OptaAppApp.swift`

**Changes:**
1. Add `.withColorTemperature()` modifier to the root `WindowGroup` content view (or the outermost view body)
2. This single addition makes `@Environment(\.colorTemperature)` available to every view in the hierarchy
3. No other changes to this file — keep existing window configuration, menu bar setup, etc.

**Verification:** Build compiles, app launches with temperature environment available

### Task 2: MenuBarCircularMenuButton Temperature Colors

**Files:** `opta-native/OptaApp/OptaApp/MenuBar/MenuBarCircularMenuButton.swift`

**Changes:**
1. Add `@Environment(\.colorTemperature) private var colorTemp` to all 3 structs that define `branchViolet`
2. Remove all `private let branchViolet = Color(hex: "8B5CF6")` definitions (3 total)
3. Replace all `branchViolet` usages with `colorTemp.violetColor`
4. For opacity multipliers: replace fixed opacity values with `colorTemp.glowOpacity`-scaled versions
5. Menu bar minimum visibility: in dormant state, ensure icons/text remain at least `.opacity(0.4)` for usability (don't let dormant make the menu bar invisible)
6. Keep the structural layout, button actions, and hover interactions unchanged

**Verification:** Build compiles, menu bar buttons change color with temperature state

### Task 3: GameCardView & CircularMenuView Temperature Colors

**Files:** `opta-native/OptaApp/OptaApp/Views/Games/GameCardView.swift`, `opta-native/OptaApp/OptaApp/Views/Components/CircularMenuView.swift`

**Changes for GameCardView:**
1. Add `@Environment(\.colorTemperature) private var colorTemp`
2. Replace inline `Color(hex: "8B5CF6")` references in the branch-energy RadialGradient hover with `colorTemp.violetColor`
3. Replace any `Color(hex: "8B5CF6")` used for borders/accents with `colorTemp.tintColor`
4. The RadialGradient structure stays (from Phase 87) — only the color source changes
5. Keep the `.organicHover()` modifier from Phase 88 unchanged
6. Game status colors (running=green, stopped=gray) stay functional

**Changes for CircularMenuView:**
1. Add `@Environment(\.colorTemperature) private var colorTemp`
2. Remove `private let branchViolet = Color(hex: "8B5CF6")` — replace with `colorTemp.violetColor`
3. Replace any opacity references with temperature-scaled values
4. Keep navigation behavior, sector layout, and animations unchanged

**Verification:** Build compiles, game cards and circular menu respond to temperature

## Verification

After all tasks:
```bash
cd opta-native && xcodebuild build -project OptaApp/OptaApp.xcodeproj -scheme OptaApp -destination 'platform=macOS' 2>&1 | tail -5
```

Expected: **BUILD SUCCEEDED**

## Success Criteria

- [ ] ColorTemperatureProvider installed at app root (OptaAppApp.swift)
- [ ] No hardcoded `branchViolet` or `Color(hex: "8B5CF6")` remains in menu bar components
- [ ] No hardcoded violet in GameCardView or CircularMenuView
- [ ] Menu bar remains usable in dormant state (minimum opacity enforced)
- [ ] Game card hover glow responds to temperature (dim when dormant, bright when active)
- [ ] Branch-energy RadialGradient (Phase 87) structure preserved — only color source changes
- [ ] Organic motion modifiers (Phase 88) preserved
- [ ] All 5 color temperature states visually distinct across the entire app
- [ ] Build succeeds with no new errors

## Output

- SUMMARY.md with files modified, decisions made
- Per-task atomic commits
