---
phase: 70-main-dashboard-ui
plan: 02
type: execute
wave: 2
depends_on: ["70-01"]
files_modified:
  - opta-native/OptaApp/OptaApp/Views/Components/OptaRingView.swift
  - opta-native/OptaApp/OptaApp/Views/DashboardView.swift
  - opta-native/OptaApp/OptaApp/OptaAppApp.swift
autonomous: true
---

<objective>
Integrate the OptaRing wgpu 3D component into the dashboard and wire up navigation.

Purpose: Connect the existing Metal/wgpu render infrastructure with the new DashboardView, displaying the 3D OptaRing as the centerpiece.
Output: DashboardView with integrated OptaRing, navigation from app entry point.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

**Phase 70-01 outputs:**
@.planning/phases/70-main-dashboard-ui/70-01-SUMMARY.md

**Existing render infrastructure:**
@opta-native/OptaApp/OptaApp/Views/MetalRenderView.swift
@opta-native/OptaApp/OptaApp/Rendering/RenderCoordinator.swift
@opta-native/OptaApp/OptaApp/Rendering/DisplayLinkController.swift

**Rust ring component (for reference):**
@opta-native/opta-render/src/components/mod.rs

**ViewModel ring state:**
- ringPhase: RingPhaseViewModel (.sleeping, .waking, .active, .exploding)
- ringIntensity: Float (0.0 - 1.0)
- ringExplodeProgress: Float (0.0 - 1.0)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create OptaRingView wrapper</name>
  <files>opta-native/OptaApp/OptaApp/Views/Components/OptaRingView.swift</files>
  <action>
Create a SwiftUI wrapper for the wgpu OptaRing:

1. OptaRingView struct accepting:
   - coordinator: RenderCoordinator (passed from parent)
   - phase: RingPhaseViewModel
   - intensity: Float
   - explodeProgress: Float
2. Use existing MetalRenderView internally:
   - Wrap MetalRenderView(coordinator: coordinator)
   - Configure ring-specific rendering mode
3. Add RingPhaseViewModel enum if not exists:
   - .sleeping - Ring dormant
   - .waking - Wake-up animation
   - .active - Normal state
   - .exploding - Explosion effect
4. Pass ring state to RenderCoordinator:
   - coordinator.setRingPhase(phase)
   - coordinator.setRingIntensity(intensity)
   - coordinator.setRingExplodeProgress(explodeProgress)
5. Add stub methods to RenderCoordinator if needed:
   - func setRingPhase(_ phase: RingPhaseViewModel)
   - func setRingIntensity(_ intensity: Float)
   - func setRingExplodeProgress(_ progress: Float)
6. Size: 300x300 pt for dashboard integration
7. Add tap gesture to toggle ring wake/sleep

Key: The actual wgpu rendering happens in RenderCoordinator. OptaRingView is the SwiftUI interface.
  </action>
  <verify>
```bash
cd /Users/matthewbyrden/Documents/Opta/opta-native/OptaApp && ls -la OptaApp/Views/Components/OptaRingView.swift
```
Expected: File exists
  </verify>
  <done>OptaRingView wrapper exists with ring state control</done>
</task>

<task type="auto">
  <name>Task 2: Integrate OptaRing into DashboardView</name>
  <files>opta-native/OptaApp/OptaApp/Views/DashboardView.swift</files>
  <action>
Update DashboardView to include the OptaRing:

1. Add @StateObject var renderCoordinator = RenderCoordinator()
2. Replace or augment ScoreDisplay with OptaRingView as centerpiece:
   - OptaRingView at top, 300x300 pt
   - ScoreDisplay overlaid or positioned below ring
3. Pass ring state from coreManager.viewModel:
   - phase: coreManager.viewModel.ringPhase
   - intensity: coreManager.viewModel.ringIntensity
   - explodeProgress: coreManager.viewModel.ringExplodeProgress
4. Layout adjustment:
   - Ring centered at top with ZStack overlay
   - Score display positioned inside or below ring
   - Telemetry cards below
   - Quick actions at bottom
5. Handle ring tap â†’ toggle stealth mode or wake ring:
   - .onTapGesture { coreManager.dispatch(.ringTapped) }
6. Ensure glass cards appear over the ring glow properly

Key: Ring should be the visual hero element. Score can overlay the ring center.
  </action>
  <verify>
```bash
grep -l "OptaRingView" /Users/matthewbyrden/Documents/Opta/opta-native/OptaApp/OptaApp/Views/DashboardView.swift
```
Expected: Match found
  </verify>
  <done>DashboardView includes OptaRing as centerpiece</done>
</task>

<task type="auto">
  <name>Task 3: Wire DashboardView into app navigation</name>
  <files>opta-native/OptaApp/OptaApp/OptaAppApp.swift</files>
  <action>
Update OptaAppApp to use DashboardView as main content:

1. Replace ContentView with navigation-aware structure:
   ```swift
   @State private var coreManager = OptaCoreManager()

   WindowGroup(id: "main") {
       NavigationStack {
           switch coreManager.viewModel.currentPage {
           case .dashboard:
               DashboardView(coreManager: coreManager)
           case .settings:
               SettingsView(coreManager: coreManager)
           case .games:
               Text("Games - Coming Soon") // Placeholder for Phase 72
           case .score:
               Text("Score Detail - Coming Soon") // Placeholder
           }
       }
       .preferredColorScheme(.dark)
   }
   ```
2. Update DashboardView to accept coreManager as parameter instead of creating its own
3. Pass coreManager to child views that need it
4. Keep RenderCoordinator in app scope for shared rendering
5. Add PageViewModel cases if not already in OptaViewModel:
   - .dashboard, .settings, .games, .score
6. Ensure menu bar and settings windows still work

Key: Navigation is driven by coreManager.viewModel.currentPage. Views dispatch navigation events.
  </action>
  <verify>
```bash
grep -l "DashboardView" /Users/matthewbyrden/Documents/Opta/opta-native/OptaApp/OptaApp/OptaAppApp.swift
```
Expected: Match found
  </verify>
  <done>App uses DashboardView with page-based navigation</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] OptaRingView.swift exists with MetalRenderView wrapper
- [ ] RenderCoordinator has ring state methods (or stubs)
- [ ] DashboardView includes OptaRing as centerpiece
- [ ] OptaAppApp.swift uses DashboardView with navigation
- [ ] Page-based navigation from viewModel.currentPage
- [ ] Ring responds to tap gestures
</verification>

<success_criteria>
- OptaRing displays as visual centerpiece of dashboard
- Ring state (phase, intensity, explode) controlled via ViewModel
- Navigation between pages works via CoreManager
- App entry point uses DashboardView instead of plain MetalRenderView
- All components receive shared coreManager instance
</success_criteria>

<output>
After completion, create `.planning/phases/70-main-dashboard-ui/70-02-SUMMARY.md`
</output>
