---
phase: 18-windows-platform
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [src-tauri/tauri.conf.json, src-tauri/windows/hooks.nsh]
autonomous: true
---

<objective>
Configure Tauri NSIS installer with custom hooks and branding for professional Windows installation experience.

Purpose: Create a polished Windows installer that matches Opta's quality standards, with proper branding, install/uninstall hooks, and Windows-native behavior.
Output: NSIS hook file and updated Tauri configuration ready for Windows builds.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@src-tauri/tauri.conf.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create NSIS installer hooks</name>
  <files>src-tauri/windows/hooks.nsh</files>
  <action>
Create NSIS hook file with four macros:
1. NSIS_HOOK_PREINSTALL - Check for conflicting optimization tools, warn user
2. NSIS_HOOK_POSTINSTALL - Register Opta in Windows Settings apps list, create Start Menu shortcut with proper icon
3. NSIS_HOOK_PREUNINSTALL - Offer to export user settings before removal
4. NSIS_HOOK_POSTUNINSTALL - Clean up app data directory (with user consent via MessageBox)

Use NSIS syntax with proper macro definitions. Include comments explaining each hook.
Do NOT use deprecated NSIS functions - use modern MUI2 patterns.
  </action>
  <verify>File exists at src-tauri/windows/hooks.nsh with all four macro definitions</verify>
  <done>NSIS hooks file created with pre/post install/uninstall macros</done>
</task>

<task type="auto">
  <name>Task 2: Configure Tauri for NSIS customization</name>
  <files>src-tauri/tauri.conf.json</files>
  <action>
Update tauri.conf.json bundle.windows.nsis section:
1. Set installerHooks to "./windows/hooks.nsh"
2. Set displayLanguageSelector to true (support multiple languages)
3. Set installerIcon to point to existing icon.ico
4. Set headerImage if header PNG exists, or skip if not

Keep all existing Windows configuration (certificateThumbprint, digestAlgorithm, timestampUrl).
Do NOT modify macOS or Linux sections.
  </action>
  <verify>npm run tauri build -- --target x86_64-pc-windows-msvc --ci (should parse config without errors, even if cross-compile fails)</verify>
  <done>tauri.conf.json has nsis section with installerHooks pointing to hooks.nsh</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] src-tauri/windows/hooks.nsh exists with all four macros
- [ ] tauri.conf.json has bundle.windows.nsis.installerHooks configured
- [ ] No JSON syntax errors in tauri.conf.json (npm run tauri info succeeds)
</verification>

<success_criteria>
- All tasks completed
- NSIS hooks ready for Windows installer builds
- Configuration validated
</success_criteria>

<output>
After completion, create `.planning/phases/18-windows-platform/18-01-SUMMARY.md`
</output>
