---
phase: 01-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [OptaMini.xcodeproj, OptaMini/OptaMiniApp.swift, OptaMini/AppDelegate.swift, OptaMini/ContentView.swift, OptaMini/Info.plist]
autonomous: true
---

<objective>
Create a working macOS menu bar app skeleton for Opta Mini.

Purpose: Establish the foundation for the Opta ecosystem hub - a menu bar app that shows/hides a popover when clicked.
Output: Xcode project configured as menu bar app with basic popover infrastructure.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Xcode project as menu bar app</name>
  <files>OptaMini.xcodeproj, OptaMini/Info.plist, OptaMini/OptaMiniApp.swift</files>
  <action>
Create new Xcode project in the "Opta Mini" directory:
- Product name: OptaMini
- Organization identifier: com.opta
- Interface: SwiftUI
- Language: Swift
- Deployment target: macOS 13.0 (Ventura)

Configure as menu bar app (no dock icon):
- Add `LSUIElement = true` to Info.plist (Application is agent/accessory)
- This hides the app from the Dock

Update OptaMiniApp.swift:
- Remove default WindowGroup
- Add @NSApplicationDelegateAdaptor for AppDelegate
- App struct should be minimal, delegating to AppDelegate

Do NOT use @main on both App and AppDelegate - only on the App struct.
  </action>
  <verify>
xcodebuild -project OptaMini.xcodeproj -scheme OptaMini -configuration Debug build 2>&1 | tail -5
Check Info.plist contains LSUIElement
  </verify>
  <done>
Project builds successfully.
App configured as menu bar app (LSUIElement = true).
No dock icon appears when running.
  </done>
</task>

<task type="auto">
  <name>Task 2: Set up menu bar infrastructure with AppDelegate</name>
  <files>OptaMini/AppDelegate.swift</files>
  <action>
Create AppDelegate.swift with:
- NSObject, NSApplicationDelegate conformance
- Private var statusItem: NSStatusItem?
- Private var popover: NSPopover

In applicationDidFinishLaunching:
1. Create NSStatusItem with variable length
2. Configure status item button:
   - Set image to NSImage(systemSymbolName: "circle.grid.2x2", accessibilityDescription: "Opta Mini")
   - Add action to toggle popover
3. Create NSPopover:
   - Set contentViewController to NSHostingController(rootView: ContentView())
   - Set behavior to .transient (closes when clicking outside)
   - Set contentSize to NSSize(width: 300, height: 400)

Add togglePopover method:
- If popover.isShown, close it
- Else, show relative to statusItem.button, preferredEdge: .minY

Use @objc for togglePopover since it's a selector target.
  </action>
  <verify>
Build and run - menu bar icon should appear.
Click icon - popover should show/hide.
  </verify>
  <done>
Menu bar icon visible in system menu bar.
Clicking icon toggles popover visibility.
Popover closes when clicking outside.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create basic SwiftUI ContentView</name>
  <files>OptaMini/ContentView.swift</files>
  <action>
Create ContentView.swift with placeholder UI:
- VStack with padding
- Text header: "Opta Mini"
- Text subheader: "Opta Ecosystem Hub"
- Divider
- Text placeholder: "Apps will appear here"
- Spacer to push content to top

Use system fonts:
- .title2.bold() for header
- .subheadline.foregroundColor(.secondary) for subheader

Match native macOS appearance - no custom colors yet (Phase 6).
Keep layout simple for now - Phase 3 will add the real app list.
  </action>
  <verify>
Build and run.
Click menu bar icon.
Verify popover shows ContentView with placeholder text.
  </verify>
  <done>
ContentView displays in popover.
Layout is clean and native-looking.
Foundation ready for Phase 2 (app detection) and Phase 3 (real UI).
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `xcodebuild -project OptaMini.xcodeproj -scheme OptaMini build` succeeds
- [ ] App runs without dock icon (LSUIElement working)
- [ ] Menu bar icon appears
- [ ] Clicking icon shows/hides popover
- [ ] ContentView renders in popover
</verification>

<success_criteria>

- All tasks completed
- Menu bar app runs and shows popover
- No build errors or warnings
- Foundation ready for Phase 2
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-01-SUMMARY.md`
</output>
