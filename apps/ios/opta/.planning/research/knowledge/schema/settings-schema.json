{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://opta.app/schemas/settings-schema.json",
  "title": "Opta Settings Interaction Schema",
  "description": "Schema for game/app settings interactions, dependencies, conflicts, and trade-offs in the Opta Settings Interaction Engine",
  "type": "object",
  "required": ["$schema", "domain", "lastUpdated", "settings"],
  "properties": {
    "$schema": {
      "type": "string",
      "const": "settings-schema.json"
    },
    "domain": {
      "type": "string",
      "enum": ["resolution-upscaling", "ray-tracing", "apple-silicon", "general-graphics", "display", "power"],
      "description": "Primary settings domain this file covers"
    },
    "subDomain": {
      "type": "string",
      "description": "Specific sub-domain (e.g., 'dlss-fsr', 'rt-shadows', 'metalfx')"
    },
    "lastUpdated": {
      "type": "string",
      "format": "date",
      "description": "ISO date of last update"
    },
    "lastVerified": {
      "type": "string",
      "format": "date",
      "description": "ISO date of last verification"
    },
    "confidence": {
      "type": "string",
      "enum": ["high", "medium", "low"],
      "description": "Overall confidence in this settings file"
    },
    "sources": {
      "type": "array",
      "items": {
        "$ref": "#/$defs/source"
      },
      "description": "Data sources for this settings file"
    },
    "settings": {
      "type": "array",
      "items": {
        "$ref": "#/$defs/settingInteraction"
      },
      "description": "Array of settings interaction entries"
    }
  },
  "$defs": {
    "source": {
      "type": "object",
      "required": ["name", "type"],
      "properties": {
        "name": {
          "type": "string",
          "description": "Source name or title"
        },
        "type": {
          "type": "string",
          "enum": ["gemini-research", "official-docs", "benchmark", "user-report", "derived", "game-analysis"],
          "description": "Type of data source"
        },
        "url": {
          "type": "string",
          "format": "uri",
          "description": "URL to source if available"
        },
        "date": {
          "type": "string",
          "format": "date",
          "description": "Date of source material"
        }
      }
    },
    "settingInteraction": {
      "type": "object",
      "required": ["id", "type", "settings", "relationship", "direction", "confidence"],
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^[a-z0-9-]+$",
          "description": "Unique identifier (kebab-case, e.g., 'dlss-native-resolution-conflict')"
        },
        "type": {
          "type": "string",
          "enum": ["dependency", "conflict", "tradeoff", "synergy"],
          "description": "Type of settings interaction"
        },
        "settings": {
          "type": "array",
          "minItems": 2,
          "items": {
            "$ref": "#/$defs/settingReference"
          },
          "description": "Array of setting references involved in this interaction"
        },
        "relationship": {
          "type": "string",
          "description": "Human-readable description of how settings interact"
        },
        "direction": {
          "type": "string",
          "enum": ["requires", "excludes", "affects", "enhances"],
          "description": "Direction of the relationship from first setting to second"
        },
        "bidirectional": {
          "type": "boolean",
          "default": false,
          "description": "Whether the relationship applies in both directions"
        },
        "conditions": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/condition"
          },
          "description": "Conditions under which this interaction applies"
        },
        "impact": {
          "$ref": "#/$defs/impactMetrics",
          "description": "Performance/quality/power/VRAM effects of this interaction"
        },
        "confidence": {
          "type": "string",
          "enum": ["high", "medium", "low"],
          "description": "Confidence level for this specific interaction"
        },
        "platforms": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["macos", "windows", "linux", "all"]
          },
          "default": ["all"],
          "description": "Platforms this interaction applies to"
        },
        "hardware": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Specific hardware this applies to (e.g., ['M3', 'M3 Pro', 'M4'])"
        },
        "games": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Specific games if not universal (empty = all games)"
        },
        "tags": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Searchable tags for this interaction"
        },
        "source": {
          "type": "string",
          "description": "Source reference for this specific entry"
        },
        "sourceDate": {
          "type": "string",
          "description": "Year or date of source"
        },
        "relatedInteractions": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "IDs of related setting interactions"
        },
        "recommendations": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Optimization recommendations when this interaction is detected"
        }
      }
    },
    "settingReference": {
      "type": "object",
      "required": ["category", "setting"],
      "properties": {
        "category": {
          "type": "string",
          "enum": ["graphics", "rt", "upscaling", "display", "power", "metal", "quality", "performance", "audio"],
          "description": "Setting category"
        },
        "setting": {
          "type": "string",
          "description": "Setting identifier (e.g., 'resolution', 'dlss', 'shadows')"
        },
        "value": {
          "oneOf": [
            { "type": "string" },
            { "type": "number" },
            { "type": "boolean" }
          ],
          "description": "Specific value that triggers this interaction (optional)"
        },
        "valueRange": {
          "$ref": "#/$defs/valueRange",
          "description": "Range of values that trigger this interaction (optional)"
        }
      },
      "description": "Reference to a game setting in format category:setting:value"
    },
    "valueRange": {
      "type": "object",
      "properties": {
        "min": {
          "oneOf": [
            { "type": "string" },
            { "type": "number" }
          ],
          "description": "Minimum value in range"
        },
        "max": {
          "oneOf": [
            { "type": "string" },
            { "type": "number" }
          ],
          "description": "Maximum value in range"
        },
        "includes": {
          "type": "array",
          "items": {
            "oneOf": [
              { "type": "string" },
              { "type": "number" }
            ]
          },
          "description": "Specific values included"
        },
        "excludes": {
          "type": "array",
          "items": {
            "oneOf": [
              { "type": "string" },
              { "type": "number" }
            ]
          },
          "description": "Specific values excluded"
        }
      },
      "description": "Range or set of values for a setting"
    },
    "condition": {
      "type": "object",
      "required": ["parameter", "operator", "value"],
      "properties": {
        "parameter": {
          "type": "string",
          "description": "What's being checked (e.g., 'vram_available', 'resolution', 'hardware_tier')"
        },
        "operator": {
          "type": "string",
          "enum": ["gt", "lt", "eq", "gte", "lte", "range", "in", "not_in"],
          "description": "Comparison operator"
        },
        "value": {
          "oneOf": [
            { "type": "number" },
            { "type": "string" },
            { "type": "boolean" },
            {
              "type": "array",
              "items": {
                "oneOf": [
                  { "type": "number" },
                  { "type": "string" }
                ]
              }
            },
            { "$ref": "#/$defs/rangeValue" }
          ],
          "description": "Value to compare against"
        },
        "unit": {
          "type": "string",
          "description": "Unit of measurement (e.g., 'GB', 'pixels', 'percent')"
        }
      }
    },
    "rangeValue": {
      "type": "object",
      "required": ["min", "max"],
      "properties": {
        "min": {
          "type": "number",
          "description": "Minimum value of range"
        },
        "max": {
          "type": "number",
          "description": "Maximum value of range"
        }
      },
      "description": "Range value for 'range' operator conditions"
    },
    "impactMetrics": {
      "type": "object",
      "properties": {
        "performance": {
          "$ref": "#/$defs/impactValue",
          "description": "FPS/performance impact (-100 to +100, negative = worse performance)"
        },
        "quality": {
          "$ref": "#/$defs/impactValue",
          "description": "Visual quality impact (-100 to +100, negative = worse quality)"
        },
        "power": {
          "$ref": "#/$defs/impactValue",
          "description": "Power consumption impact (-100 to +100, negative = less power usage)"
        },
        "vram": {
          "$ref": "#/$defs/impactValue",
          "description": "VRAM usage impact (-100 to +100, negative = less VRAM)"
        },
        "latency": {
          "$ref": "#/$defs/impactValue",
          "description": "Input latency impact (-100 to +100, negative = less latency)"
        }
      },
      "description": "Impact metrics on various system aspects"
    },
    "impactValue": {
      "type": "object",
      "required": ["value"],
      "properties": {
        "value": {
          "type": "number",
          "minimum": -100,
          "maximum": 100,
          "description": "Impact value on -100 to +100 scale"
        },
        "unit": {
          "type": "string",
          "description": "Specific unit if not on standard scale (e.g., 'fps', 'ms', 'MB')"
        },
        "min": {
          "type": "number",
          "description": "Minimum observed value"
        },
        "max": {
          "type": "number",
          "description": "Maximum observed value"
        },
        "typical": {
          "type": "number",
          "description": "Typical/median observed value"
        }
      }
    }
  }
}
