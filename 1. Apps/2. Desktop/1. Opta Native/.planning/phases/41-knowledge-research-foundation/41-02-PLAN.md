# Plan 41-02: Apple Silicon CPU Architecture Research

**Phase:** 41 - Knowledge Research Foundation
**Domain:** CPU & Processing Pipeline
**Focus:** Apple Silicon M1/M2/M3/M4 CPU mastery

---

## Metadata

```yaml
plan_id: 41-02
title: Apple Silicon CPU Architecture Research
estimated_effort: research
wave: 1
autonomous: true
dependencies: []
outputs:
  - .planning/research/prompts/41-02-cpu-architecture.md
  - .planning/research/templates/cpu-knowledge-template.md
```

---

## Objective

Create optimal Gemini Deep Research prompts that will produce comprehensive CPU knowledge documents for Apple Silicon. Focus on P-core/E-core behavior, scheduling patterns, and what game/app workloads can actually be optimized.

---

## Tasks

### Task 1: Craft CPU Architecture Deep Research Prompt

**Goal:** Create a Gemini 2.5 Pro Deep Research prompt that explores Apple Silicon CPU architecture with optimization focus.

**Prompt to Create:**

```markdown
# Gemini Deep Research Prompt: Apple Silicon CPU Architecture

## Research Mission

You are conducting deep research to build an optimization knowledge base for Apple Silicon CPUs. The goal is understanding exactly how P-cores and E-cores behave under gaming/productivity workloads, what can be optimized, and by how much.

## Core Questions to Explore

### Architecture Fundamentals
1. **Core Configurations**
   - Exact P-core and E-core counts for each variant:
     - M1: 4P+4E, M1 Pro: 8P+2E or 6P+2E, M1 Max: 8P+2E, M1 Ultra: 16P+4E
     - Same breakdown for M2, M3, M4 generations
   - Clock speeds: P-core boost, E-core max, sustained frequencies
   - How does binning affect core quality?

2. **Performance/Efficiency Core Behavior**
   - What triggers P-core vs E-core scheduling?
   - Thread affinity: Can apps request specific core types?
   - QoS (Quality of Service) classes in macOS and their core affinity
   - How does macOS handle single-threaded vs multi-threaded workloads?

3. **Cache Hierarchy**
   - L1, L2, L3 cache sizes per generation
   - Shared vs per-core cache architecture
   - Cache latency and bandwidth numbers
   - When does cache pressure become a bottleneck?

### Performance Curves (CRITICAL)
4. **Single-Thread Performance**
   - Geekbench/Cinebench single-thread scores by chip
   - Real-world IPC (instructions per clock) comparisons
   - Single-thread performance vs Intel/AMD equivalents
   - Games that are single-thread limited on Apple Silicon

5. **Multi-Thread Scaling**
   - How well do workloads scale from 1 to N threads?
   - P-core only vs P+E mixed workload performance
   - At what thread count do E-cores start being used?
   - Multi-thread efficiency: M1 vs M2 vs M3 vs M4 progression

6. **Sustained Performance**
   - Single-thread sustained vs burst (over 1, 5, 10 minutes)
   - Multi-thread sustained vs burst
   - How does device form factor affect CPU sustained performance?
   - Power consumption curves under different loads

### Optimization Levers
7. **Process Priority & Scheduling**
   - How does macOS schedule game processes?
   - Background process impact on game performance
   - Can we influence core affinity through process priority?
   - App Nap and related power management behaviors

8. **Rosetta 2 Translation**
   - CPU overhead of Rosetta 2 translation
   - Which instruction patterns translate poorly?
   - JIT compilation behavior and warmup effects
   - Native ARM vs translated x86 performance delta (typical ranges)

9. **Game-Specific CPU Patterns**
   - CPU-intensive game genres (strategy, simulation, MMO)
   - Draw call overhead on Apple Silicon
   - Physics simulation performance
   - AI/pathfinding workload characteristics

### Cross-Domain Interactions
10. **CPU ↔ Memory Interactions**
    - Memory latency impact on CPU-bound workloads
    - Memory bandwidth saturation scenarios
    - Unified memory: CPU and GPU competing for bandwidth

11. **CPU ↔ Thermal Interactions**
    - At what temperatures do P-cores throttle?
    - E-core throttle points vs P-core throttle points
    - Thermal headroom by device type

## Output Format Requirements

Structure your findings as:

1. **Executive Summary** - Key CPU optimization insights (1 page max)
2. **Core Configuration Tables** - All generations, all variants, exact numbers
3. **Performance Curves** - Single-thread, multi-thread, sustained
4. **Scheduling Behavior** - How macOS assigns work to cores
5. **Optimization Opportunities** - What Opta can actually influence
6. **Cross-Reference Matrix** - CPU interactions with GPU/Memory/Thermals

## Research Depth Guidance

- Prioritize real benchmark data over theoretical specifications
- Include Rosetta 2 performance considerations for games
- Focus on gaming/real-time workloads, not just synthetic benchmarks
- Flag uncertain data with confidence levels
- Distinguish between what apps can control vs OS-level behavior
```

**Output:** `.planning/research/prompts/41-02-cpu-architecture.md`

---

### Task 2: Create CPU Knowledge Document Template

**Goal:** Create a structured template for capturing CPU research findings.

**Template Structure:**

```markdown
# Apple Silicon CPU Knowledge Base

## Document Metadata
- **Generated:** [Date]
- **Source:** Gemini 2.5 Pro Deep Research
- **Domain:** CPU Architecture & Optimization
- **Confidence:** [High/Medium/Low per section]

---

## 1. Hardware Specifications

### Core Configurations by Generation

| Chip | P-Cores | E-Cores | P-Core Clock | E-Core Clock |
|------|---------|---------|--------------|--------------|
| M1 | 4 | 4 | X GHz | X GHz |
| M1 Pro | 6-8 | 2 | X GHz | X GHz |
| M1 Max | 8 | 2 | X GHz | X GHz |
| M1 Ultra | 16 | 4 | X GHz | X GHz |
| M2 | ... | ... | ... | ... |
| M3 | ... | ... | ... | ... |
| M4 | ... | ... | ... | ... |

### Cache Hierarchy

| Chip | L1 (per core) | L2 (shared) | L3/SLC |
|------|---------------|-------------|--------|
| M1 | X KB | X MB | X MB |
| ... | ... | ... | ... |

---

## 2. Performance Curves

### Single-Thread Performance (Relative, M1 = 100%)

| Chip | Relative ST | Geekbench ST | Notes |
|------|-------------|--------------|-------|
| M1 | 100% | ~1700 | Baseline |
| M2 | X% | ~X | ... |
| M3 | X% | ~X | ... |
| M4 | X% | ~X | ... |

### Multi-Thread Scaling

| Chip | 1T | 2T | 4T | 8T | All Cores |
|------|-----|-----|-----|-----|-----------|
| M1 | 100% | X% | X% | X% | X% |
| ... | ... | ... | ... | ... | ... |

### Sustained vs Burst (% of Peak After Time)

| Chip/Device | 10s | 1min | 5min | 10min |
|-------------|-----|------|------|-------|
| M1 MacBook Air | 100% | X% | X% | X% |
| M1 MacBook Pro | 100% | X% | X% | X% |
| M1 Mac Studio | 100% | X% | X% | X% |
| ... | ... | ... | ... | ... |

---

## 3. Scheduling Behavior

### QoS Class Core Affinity

| QoS Class | Typical Core Assignment | Use Case |
|-----------|------------------------|----------|
| User Interactive | P-cores | UI, game main thread |
| User Initiated | P-cores preferred | Game loading, response |
| Utility | Mixed | Background processing |
| Background | E-cores preferred | Indexing, updates |

### Thread Count Thresholds

- E-cores activated when thread count exceeds: X
- Mixed P+E scheduling begins at: X threads
- Typical game main thread behavior: [description]

---

## 4. Rosetta 2 Translation

### Performance Overhead

| Workload Type | Native ARM | Rosetta 2 | Overhead |
|---------------|------------|-----------|----------|
| Integer-heavy | 100% | X% | -X% |
| Float-heavy | 100% | X% | -X% |
| SIMD-heavy | 100% | X% | -X% |
| Typical game | 100% | X% | -X% |

### Translation Patterns

- Well-translated patterns: [list]
- Poorly-translated patterns: [list]
- JIT warmup period: [typical duration]

---

## 5. Optimization Opportunities

### What Opta Can Influence

| Lever | Impact | Method |
|-------|--------|--------|
| Background process management | X% FPS improvement | Identify and suggest closing |
| Process priority hints | X% improvement | QoS class recommendations |
| ... | ... | ... |

### What's Outside Opta's Control

- Core scheduling (OS-level)
- Clock frequency (automatic)
- ...

---

## 6. Cross-Domain Interactions

### CPU ↔ GPU

- Draw call CPU overhead: [quantified]
- CPU-GPU synchronization points: [description]

### CPU ↔ Memory

- Memory latency impact: [quantified]
- Bandwidth competition scenarios: [description]

### CPU ↔ Thermal

- P-core throttle temperature: X°C
- E-core throttle temperature: X°C
- Thermal impact on sustained performance: [description]

---

## 7. Game-Specific Patterns

### CPU-Intensive Genres

| Genre | Typical CPU Load | Bottleneck Pattern |
|-------|------------------|-------------------|
| RTS/4X | High | AI, pathfinding |
| MMO | High | Network, entity management |
| Open World | Medium-High | Streaming, physics |
| FPS | Medium | Physics, AI |

---

## 8. Confidence Notes

| Section | Confidence | Notes |
|---------|------------|-------|
| Core configurations | High | Official specs |
| Performance curves | Medium | Benchmark aggregation |
| Scheduling behavior | Medium | Observed, not documented |
| Rosetta overhead | Medium | Varies by workload |
```

**Output:** `.planning/research/templates/cpu-knowledge-template.md`

---

## Success Criteria

- [ ] Deep Research prompt covers P-core/E-core behavior comprehensively
- [ ] Rosetta 2 translation overhead is addressed
- [ ] Scheduling and QoS patterns are explored
- [ ] Template captures gaming-relevant CPU data
- [ ] Cross-domain interactions are addressed

---

## Notes

- User runs prompt with Gemini 2.5 Pro Deep Research offline
- Findings populate template and feed Phase 47 Configuration Calculator
- This is research phase — validation against real hardware comes later
