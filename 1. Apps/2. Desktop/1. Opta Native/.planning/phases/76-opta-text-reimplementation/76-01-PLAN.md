---
phase: 76-opta-text-reimplementation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - opta-native/OptaApp/OptaApp/Design/OptaTextStyle.swift
  - opta-native/OptaApp/OptaApp/Animation/CharacterAnimator.swift
autonomous: true
---

<objective>
Build the foundational design system and animation infrastructure for Opta text reimplementation.

Purpose: Establish the typography, color palette, glow effects, and character animation system that will power all Opta branded text components in the native macOS app.

Output:
- OptaTextStyle.swift with complete text design system
- CharacterAnimator.swift with character-by-character animation support
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Reference implementation from React app (key patterns to port):
# - Ignition animation: opacity 0→1, y -10→0, brightness 0.5→1, blur 4px→0px over 800ms
# - Spring physics: smooth (stiffness: 200, damping: 25), snappy (500, 30), gentle (150, 20)
# - Stagger delay: 40ms between items
# - Neon glow colors: purple (139 92 246), blue (59 130 246), green (34 197 94)
# - Text glow: text-shadow 0 0 10px rgba(color, 0.5)

# Existing SwiftUI patterns:
@opta-native/OptaApp/OptaApp/Views/Components/QuickActions.swift
@opta-native/OptaApp/OptaApp/Views/Dashboard/DashboardView.swift

# Existing animation system in Rust (for reference, not to use):
@opta-native/opta-render/src/animation/spring.rs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create OptaTextStyle Design System</name>
  <files>opta-native/OptaApp/OptaApp/Design/OptaTextStyle.swift</files>
  <action>
Create a comprehensive text design system for Opta branding. Include:

1. **Color Palette** (static properties):
   - `dormantViolet`: Color(hex: "3B1D5A") - deep violet for inactive state
   - `activeViolet`: Color(hex: "9333EA") - electric violet for active state
   - `glowPurple`: Color(hex: "8B5CF6") - primary glow color
   - `glowBlue`, `glowGreen`, `glowAmber`, `glowRed`, `glowCyan` variants

2. **Font Styles** (computed properties returning Font):
   - `hero`: system 32pt bold, -0.02em tracking (for main "OPTA" display)
   - `title`: system 24pt semibold (for section headers)
   - `body`: system 14pt medium (for text zone messages)
   - `caption`: system 12pt regular (for hints/timestamps)

3. **Glow Modifiers** (ViewModifier implementations):
   - `GlowModifier(color: Color, intensity: Double)` - applies text shadow
   - Extension on View: `.textGlow(color:intensity:)` modifier
   - Intensity 0.0-1.0 maps to shadow radius 0-20px and opacity 0.0-0.6

4. **State-based Styling**:
   - `TextState` enum: neutral, positive, warning, error
   - `glowColor(for state: TextState) -> Color` function
   - `stateColor(for state: TextState) -> Color` function (foreground)

5. **Animation Timing Constants**:
   - `ignitionDuration`: 0.8 seconds
   - `staggerDelay`: 0.04 seconds (40ms)
   - `springResponse`: 0.5 seconds
   - `springDamping`: 0.7

Use SwiftUI native patterns. The Color(hex:) initializer already exists in the codebase.
  </action>
  <verify>Build succeeds: `cd opta-native/OptaApp && xcodebuild -scheme OptaApp -configuration Debug build 2>&1 | tail -20`</verify>
  <done>OptaTextStyle.swift exists with all color, font, glow, and timing definitions. No compiler errors.</done>
</task>

<task type="auto">
  <name>Task 2: Create Character Animation System</name>
  <files>opta-native/OptaApp/OptaApp/Animation/CharacterAnimator.swift</files>
  <action>
Create a character-by-character animation system for text reveals. Include:

1. **AnimatableCharacter** struct:
   - `character: Character`
   - `index: Int`
   - `opacity: Double` (0.0-1.0)
   - `offsetY: Double` (starts at -10, animates to 0)
   - `brightness: Double` (starts at 0.5, animates to 1.0)
   - `blur: Double` (starts at 4.0, animates to 0.0)

2. **CharacterAnimator** class (ObservableObject):
   - `@Published var characters: [AnimatableCharacter]`
   - `init(text: String)` - creates characters with initial hidden state
   - `func animate()` - triggers staggered reveal animation
   - `func reset()` - resets all characters to hidden state
   - Private timer-based stagger implementation using DispatchQueue

3. **AnimatedTextView** SwiftUI View:
   - Takes `text: String` and optional `style: Font`
   - Uses CharacterAnimator internally
   - Renders each character with individual transforms
   - Uses `.animation(.spring(response:dampingFraction:))` for smooth motion
   - Applies brightness and blur using SwiftUI modifiers
   - Auto-triggers animation on appear

4. **Spring Configuration**:
   - `smooth`: response 0.5, damping 0.7
   - `snappy`: response 0.3, damping 0.8
   - `gentle`: response 0.6, damping 0.6

Implementation notes:
- Use `withAnimation` for coordinated state changes
- Use `.brightness()` modifier for brightness effect
- Use `.blur(radius:)` modifier for blur effect
- Handle empty strings gracefully
- Support re-animation when text changes
  </action>
  <verify>Build succeeds: `cd opta-native/OptaApp && xcodebuild -scheme OptaApp -configuration Debug build 2>&1 | tail -20`</verify>
  <done>CharacterAnimator.swift exists with AnimatableCharacter, CharacterAnimator, and AnimatedTextView. Animation triggers on appear with staggered character reveal.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `xcodebuild -scheme OptaApp build` succeeds without errors
- [ ] OptaTextStyle.swift contains all color definitions
- [ ] OptaTextStyle.swift contains font style computed properties
- [ ] OptaTextStyle.swift contains GlowModifier and .textGlow extension
- [ ] CharacterAnimator.swift contains AnimatableCharacter struct
- [ ] CharacterAnimator.swift contains CharacterAnimator ObservableObject
- [ ] CharacterAnimator.swift contains AnimatedTextView
- [ ] No SwiftUI preview crashes
</verification>

<success_criteria>
- All tasks completed
- Build passes without errors or warnings
- Text design system ready for use by Plan 76-02
- Character animation system ready for use by Plan 76-02
</success_criteria>

<output>
After completion, create `.planning/phases/76-opta-text-reimplementation/76-01-SUMMARY.md`
</output>
