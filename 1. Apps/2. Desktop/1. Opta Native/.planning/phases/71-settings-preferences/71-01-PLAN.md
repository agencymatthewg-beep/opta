---
phase: 71-settings-preferences
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - opta-native/OptaApp/OptaApp/Views/SettingsView.swift
  - opta-native/OptaApp/OptaApp/Views/Settings/ProfileManagerView.swift
  - opta-native/OptaApp/OptaApp/Views/Settings/KeyboardShortcutsView.swift
  - opta-native/OptaApp/OptaApp/Views/Settings/ThemeCustomizationView.swift
  - opta-native/OptaApp/OptaApp/Models/OptimizationProfile.swift
autonomous: true
---

<objective>
Expand SettingsView with profile management, keyboard shortcuts, and theme customization.

Purpose: Provide complete configuration interface allowing users to save optimization profiles, customize keyboard shortcuts, and personalize the visual theme.
Output: Full settings system with profile save/load/export, keyboard shortcut editor, and theme customization options.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

**Phase 70 navigation context:**
@.planning/phases/70-main-dashboard-ui/70-02-SUMMARY.md

**Existing settings:**
@opta-native/OptaApp/OptaApp/Views/SettingsView.swift

**CoreManager for event dispatch:**
@opta-native/OptaApp/OptaApp/Managers/OptaCoreManager.swift

**Design reference:**
- OLED background (#09090B)
- Glass effects with .ultraThinMaterial
- Purple accent (#8B5CF6)
- Spring animations
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create OptimizationProfile model and ProfileManagerView</name>
  <files>
opta-native/OptaApp/OptaApp/Models/OptimizationProfile.swift
opta-native/OptaApp/OptaApp/Views/Settings/ProfileManagerView.swift
  </files>
  <action>
**OptimizationProfile.swift:**
1. Create Codable struct for optimization profiles:
   ```swift
   struct OptimizationProfile: Codable, Identifiable {
       let id: UUID
       var name: String
       var qualityLevel: Int // 0-4 (Low to Adaptive)
       var enableHaptics: Bool
       var autoOptimize: Bool
       var processTerminationList: [String]
       var createdAt: Date
       var lastUsedAt: Date?
   }
   ```
2. Add ProfileManager class with:
   - save(profile:) - Save to ~/Library/Application Support/Opta/profiles/
   - load(id:) -> OptimizationProfile?
   - loadAll() -> [OptimizationProfile]
   - delete(id:)
   - export(profile:) -> URL (JSON file in Downloads)
   - import(url:) -> OptimizationProfile?
3. Use FileManager for persistence
4. Create Settings/ directory if not exists

**ProfileManagerView.swift:**
1. List view showing all saved profiles with:
   - Profile name and creation date
   - Last used indicator
   - Quality level badge
   - Swipe to delete
2. Add profile button (shows sheet with name input)
3. Profile row tap → applies profile settings
4. Export button (share sheet with JSON)
5. Import button (file picker for .json)
6. Glass card styling for profile rows
7. Empty state when no profiles

Key: Profiles persist to disk, not @AppStorage. Use ~/Library/Application Support/Opta/profiles/ directory.
  </action>
  <verify>
```bash
ls -la /Users/matthewbyrden/Documents/Opta/opta-native/OptaApp/OptaApp/Models/OptimizationProfile.swift
ls -la /Users/matthewbyrden/Documents/Opta/opta-native/OptaApp/OptaApp/Views/Settings/ProfileManagerView.swift
```
Expected: Both files exist
  </verify>
  <done>Profile model and manager view exist with save/load/export/import functionality</done>
</task>

<task type="auto">
  <name>Task 2: Create KeyboardShortcutsView</name>
  <files>opta-native/OptaApp/OptaApp/Views/Settings/KeyboardShortcutsView.swift</files>
  <action>
Create keyboard shortcuts configuration view:

1. List of configurable shortcuts:
   - Quick Optimize: ⌘⇧P (default)
   - Toggle Menu Bar: ⌘⇧M
   - Open Dashboard: ⌘⇧O
   - Toggle FPS Overlay: ⌘⇧F
   - Pause Rendering: ⌘.
   - Show/Hide Window: ⌘⇧H
2. Each row shows:
   - Action description
   - Current shortcut (KeyboardShortcut display)
   - Edit button → sheet for recording new shortcut
3. ShortcutRecorder view:
   - Captures key + modifiers
   - Shows visual representation of key combo
   - Clear button to reset to default
4. Store shortcuts in @AppStorage as JSON string
5. Conflict detection (warn if duplicate)
6. Reset all to defaults button

Key: Use NSEvent.ModifierFlags for modifier detection. Display using standard macOS symbols (⌘⇧⌥⌃).
  </action>
  <verify>
```bash
ls -la /Users/matthewbyrden/Documents/Opta/opta-native/OptaApp/OptaApp/Views/Settings/KeyboardShortcutsView.swift
```
Expected: File exists
  </verify>
  <done>KeyboardShortcutsView exists with editable shortcuts and conflict detection</done>
</task>

<task type="auto">
  <name>Task 3: Create ThemeCustomizationView and integrate into SettingsView</name>
  <files>
opta-native/OptaApp/OptaApp/Views/Settings/ThemeCustomizationView.swift
opta-native/OptaApp/OptaApp/Views/SettingsView.swift
  </files>
  <action>
**ThemeCustomizationView.swift:**
1. Theme options:
   - Accent color picker (Purple default, also Blue, Green, Orange, Pink, custom)
   - Background darkness slider (OLED black ↔ Dark gray)
   - Glass blur intensity (Low, Medium, High)
   - Ring glow intensity (Low, Medium, High)
   - Animation speed (Slow, Normal, Fast)
2. Preview section showing:
   - Sample glass card with current settings
   - Sample button with accent color
   - Mini ring preview with glow
3. Save as custom theme option
4. Preset themes:
   - Obsidian (default - purple, OLED black)
   - Ocean (blue, dark gray)
   - Forest (green, very dark green tint)
   - Sunset (orange/pink gradient accent)
5. Store in @AppStorage as JSON
6. Real-time preview updates

**SettingsView.swift update:**
1. Refactor into sections using NavigationLink:
   - General (existing toggles)
   - Rendering (existing quality picker)
   - Profiles → ProfileManagerView
   - Keyboard Shortcuts → KeyboardShortcutsView
   - Appearance → ThemeCustomizationView
   - About (existing info)
   - Advanced (existing reset/clear cache)
2. Add section headers with SF Symbols
3. Use List with .insetGrouped style
4. Add CoreManager integration:
   - Accept coreManager parameter (optional for standalone window)
   - Dispatch settings change events if connected
5. Keep SettingsWindowView for standalone window

Key: SettingsView becomes the navigation hub. Each section is a NavigationLink to detail view.
  </action>
  <verify>
```bash
ls -la /Users/matthewbyrden/Documents/Opta/opta-native/OptaApp/OptaApp/Views/Settings/ThemeCustomizationView.swift
grep -l "ProfileManagerView\|KeyboardShortcutsView\|ThemeCustomizationView" /Users/matthewbyrden/Documents/Opta/opta-native/OptaApp/OptaApp/Views/SettingsView.swift
```
Expected: ThemeCustomizationView exists and SettingsView references all new views
  </verify>
  <done>ThemeCustomizationView exists and SettingsView refactored with NavigationLinks to all sections</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] OptimizationProfile.swift exists with Codable model and ProfileManager
- [ ] ProfileManagerView.swift exists with list/add/delete/export/import
- [ ] KeyboardShortcutsView.swift exists with shortcut editor
- [ ] ThemeCustomizationView.swift exists with color/blur/glow options
- [ ] SettingsView.swift refactored with NavigationLinks to all sections
- [ ] Settings/ subdirectory created for section views
- [ ] Glass styling applied to new views
</verification>

<success_criteria>
- Profiles can be saved, loaded, exported, and imported
- Keyboard shortcuts are configurable with conflict detection
- Theme colors, blur, and glow can be customized
- SettingsView navigates to all configuration sections
- All views follow Opta glass design system
</success_criteria>

<output>
After completion, create `.planning/phases/71-settings-preferences/71-01-SUMMARY.md`
</output>
