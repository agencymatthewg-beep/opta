---
phase: 06.1-aesthetic-alignment
plan: 02
title: Enhanced Glass Components
subsystem: design
wave: 1
autonomous: true
tags: [glass, obsidian, glassmorphism, status-badge, glow-effects, swiftui]

# Dependency graph
requires:
  - phase: 05-streaming-state
    provides: MessageBubble, ThinkingIndicator, ClawdbotColors
provides:
  - ClawdbotGlassModifiers.swift with 3-level glass depth system
  - Obsidian glass variants (dormant, interactive, active)
  - OptaStatusBadge component ("OPTA INTELLIGENCE • ACTIVE")
  - ClawdbotGlowEffects.swift with glow utilities
  - Enhanced ClawdbotColors with missing tokens
affects: [06.1-03-animations, 06-rich-text, 07-rich-visual]
---

# Phase 06.1-02: Enhanced Glass Components

**Implement 3-level glass depth system, obsidian variants, status badge component, and glow effect utilities matching the Opta Life Manager aesthetic**

## Objective

Port the web/desktop glass depth system to SwiftUI. Create obsidian glass variants for dormant/interactive/active states. Build the "OPTA INTELLIGENCE • ACTIVE" status badge component. Add glow effect utilities.

## Execution Context

@.planning/phases/06.1-aesthetic-alignment/
@Sources/ClawdbotKit/Design/ClawdbotColors.swift
@apps/desktop/opta-native/DESIGN_SYSTEM.md

## Context

**Glass Depth System (from DESIGN_SYSTEM.md v5.0):**

| Level | Blur | Opacity | Usage |
|-------|------|---------|-------|
| Level 1: Subtle | 8px | 0.3-0.4 | Background elements |
| Level 2: Content | 12px | 0.5 | Cards, sheets |
| Level 3: Overlay | 16-20px | 0.6-0.7 | Modals, overlays |

**Obsidian Glass System:**
- **0% (Dormant)**: Dark obsidian, minimal glow, default state
- **50% (Interactive)**: Brightens on hover, purple glow emerges
- **Active**: Sustained 50%, full glow

**Current ClawdbotKit state:**
- Has `clawdbotSurface` colors
- Uses basic `.ultraThinMaterial`
- No glass depth variants
- No obsidian system
- No status badge component
- No glow utilities

## Tasks

### Task 1: Create ClawdbotGlassModifiers.swift

Create `Sources/ClawdbotKit/Design/ClawdbotGlassModifiers.swift`:

```swift
import SwiftUI

// MARK: - Glass Level Enum

public enum GlassLevel {
    case subtle    // Level 1: Background
    case content   // Level 2: Cards, sheets
    case overlay   // Level 3: Modals, hero
}

// MARK: - Glass Modifiers

public extension View {
    /// Level 1: Subtle glass for background elements
    /// Blur: ~8pt, Opacity: 0.3-0.4
    func glassSubtle() -> some View {
        self
            .background(.ultraThinMaterial)
            .background(Color.clawdbotSurface.opacity(0.3))
    }

    /// Level 2: Content glass for cards and sheets
    /// Blur: ~12pt, Opacity: 0.5
    func glassContent() -> some View {
        self
            .background(.thinMaterial)
            .background(Color.clawdbotSurface.opacity(0.5))
    }

    /// Level 3: Overlay glass for modals and hero elements
    /// Blur: ~16-20pt, Opacity: 0.6
    func glassOverlay() -> some View {
        self
            .background(.regularMaterial)
            .background(Color.clawdbotSurface.opacity(0.6))
    }

    /// Generic glass modifier with level parameter
    func glass(_ level: GlassLevel) -> some View {
        Group {
            switch level {
            case .subtle: self.glassSubtle()
            case .content: self.glassContent()
            case .overlay: self.glassOverlay()
            }
        }
    }
}

// MARK: - Glass Card Component

/// A glass card container with configurable depth level
public struct GlassCard<Content: View>: View {
    let level: GlassLevel
    let cornerRadius: CGFloat
    let padding: CGFloat
    let content: Content

    public init(
        level: GlassLevel = .content,
        cornerRadius: CGFloat = 16,
        padding: CGFloat = 16,
        @ViewBuilder content: () -> Content
    ) {
        self.level = level
        self.cornerRadius = cornerRadius
        self.padding = padding
        self.content = content()
    }

    public var body: some View {
        content
            .padding(padding)
            .glass(level)
            .clipShape(RoundedRectangle(cornerRadius: cornerRadius))
            .overlay(
                RoundedRectangle(cornerRadius: cornerRadius)
                    .stroke(Color.clawdbotBorder.opacity(0.5), lineWidth: 1)
            )
    }
}
```

**Commit after completion:** `feat(06.1-02): create ClawdbotGlassModifiers with 3-level glass system`

### Task 2: Implement obsidian glass variants

Add to `ClawdbotGlassModifiers.swift`:

```swift
// MARK: - Obsidian Glass System

/// Obsidian activation state
public enum ObsidianState {
    case dormant      // 0% - Default resting state
    case interactive  // 0% to 50% transition on hover
    case active       // Sustained 50% glow
}

public extension View {
    /// Base obsidian glass - dormant 0% state
    /// Dark, minimal glow, resting
    func obsidian() -> some View {
        self
            .background(Color.clawdbotSurface.opacity(0.4))
            .overlay(
                RoundedRectangle(cornerRadius: 16)
                    .stroke(Color.clawdbotBorder.opacity(0.3), lineWidth: 1)
            )
    }

    /// Interactive obsidian - transitions 0% to 50% on hover
    /// Use with @State isHovered binding
    func obsidianInteractive(isHovered: Bool) -> some View {
        self
            .background(
                Color.clawdbotSurface.opacity(isHovered ? 0.6 : 0.4)
            )
            .overlay(
                RoundedRectangle(cornerRadius: 16)
                    .stroke(
                        isHovered ? Color.clawdbotPurple.opacity(0.5) : Color.clawdbotBorder.opacity(0.3),
                        lineWidth: isHovered ? 1.5 : 1
                    )
            )
            .shadow(
                color: isHovered ? Color.clawdbotPurple.opacity(0.3) : .clear,
                radius: isHovered ? 20 : 0
            )
            .animation(.clawdbotSpring, value: isHovered)
    }

    /// Active obsidian - sustained 50% glow state
    func obsidianActive() -> some View {
        self
            .background(Color.clawdbotSurface.opacity(0.6))
            .overlay(
                RoundedRectangle(cornerRadius: 16)
                    .stroke(Color.clawdbotPurple.opacity(0.5), lineWidth: 1.5)
            )
            .shadow(color: Color.clawdbotPurple.opacity(0.3), radius: 20)
    }

    /// Obsidian with explicit state parameter
    func obsidian(_ state: ObsidianState, isHovered: Bool = false) -> some View {
        Group {
            switch state {
            case .dormant: self.obsidian()
            case .interactive: self.obsidianInteractive(isHovered: isHovered)
            case .active: self.obsidianActive()
            }
        }
    }
}
```

**Commit after completion:** `feat(06.1-02): implement obsidian glass variants`

### Task 3: Create OptaStatusBadge component

Create `Sources/ClawdbotKit/Design/OptaStatusBadge.swift`:

```swift
import SwiftUI

// MARK: - Status Badge

/// Status indicator badge matching Opta Life Manager style
/// Displays "OPTA INTELLIGENCE • ACTIVE" or custom text
public struct OptaStatusBadge: View {
    public enum Status {
        case active
        case inactive
        case connecting
    }

    let status: Status
    let label: String?

    @State private var glowPulse = false

    public init(status: Status, label: String? = nil) {
        self.status = status
        self.label = label
    }

    public var body: some View {
        HStack(spacing: 8) {
            // Status indicator dot
            Circle()
                .fill(statusColor)
                .frame(width: 6, height: 6)
                .shadow(color: statusColor.opacity(glowPulse ? 0.8 : 0.4), radius: glowPulse ? 8 : 4)

            // Label text
            Text(displayText)
                .font(.soraBadge)
                .trackingBadge()
                .textCase(.uppercase)
                .foregroundColor(statusTextColor)
        }
        .padding(.horizontal, 12)
        .padding(.vertical, 6)
        .background(statusBackground)
        .clipShape(Capsule())
        .overlay(
            Capsule()
                .stroke(statusBorderColor, lineWidth: 1)
        )
        .onAppear {
            if status == .active {
                withAnimation(.easeInOut(duration: 2).repeatForever(autoreverses: true)) {
                    glowPulse = true
                }
            }
        }
    }

    private var displayText: String {
        if let label = label {
            return label
        }
        switch status {
        case .active: return "OPTA INTELLIGENCE • ACTIVE"
        case .inactive: return "OPTA INTELLIGENCE • OFFLINE"
        case .connecting: return "OPTA INTELLIGENCE • CONNECTING"
        }
    }

    private var statusColor: Color {
        switch status {
        case .active: return .clawdbotGreen
        case .inactive: return .clawdbotTextMuted
        case .connecting: return .clawdbotAmber
        }
    }

    private var statusTextColor: Color {
        switch status {
        case .active: return .clawdbotPurple
        case .inactive: return .clawdbotTextMuted
        case .connecting: return .clawdbotAmber
        }
    }

    private var statusBackground: some ShapeStyle {
        switch status {
        case .active:
            return AnyShapeStyle(
                LinearGradient(
                    colors: [
                        Color.clawdbotPurple.opacity(0.2),
                        Color.clawdbotBlue.opacity(0.1)
                    ],
                    startPoint: .leading,
                    endPoint: .trailing
                )
            )
        case .inactive, .connecting:
            return AnyShapeStyle(Color.clawdbotSurface.opacity(0.4))
        }
    }

    private var statusBorderColor: Color {
        switch status {
        case .active: return .clawdbotPurple.opacity(0.4)
        case .inactive: return .clawdbotBorder.opacity(0.3)
        case .connecting: return .clawdbotAmber.opacity(0.4)
        }
    }
}

// MARK: - Compact Badge Variant

public extension OptaStatusBadge {
    /// Compact version with just the dot indicator
    struct Compact: View {
        let status: OptaStatusBadge.Status

        @State private var glowPulse = false

        public init(status: OptaStatusBadge.Status) {
            self.status = status
        }

        public var body: some View {
            Circle()
                .fill(statusColor)
                .frame(width: 8, height: 8)
                .shadow(color: statusColor.opacity(glowPulse ? 0.8 : 0.4), radius: glowPulse ? 8 : 4)
                .onAppear {
                    if status == .active {
                        withAnimation(.easeInOut(duration: 2).repeatForever(autoreverses: true)) {
                            glowPulse = true
                        }
                    }
                }
        }

        private var statusColor: Color {
            switch status {
            case .active: return .clawdbotGreen
            case .inactive: return .clawdbotTextMuted
            case .connecting: return .clawdbotAmber
            }
        }
    }
}

#if DEBUG
struct OptaStatusBadge_Previews: PreviewProvider {
    static var previews: some View {
        VStack(spacing: 20) {
            OptaStatusBadge(status: .active)
            OptaStatusBadge(status: .inactive)
            OptaStatusBadge(status: .connecting)
            OptaStatusBadge.Compact(status: .active)
        }
        .padding()
        .background(Color.clawdbotBackground)
        .previewLayout(.sizeThatFits)
    }
}
#endif
```

**Commit after completion:** `feat(06.1-02): create OptaStatusBadge component`

### Task 4: Create ClawdbotGlowEffects.swift

Create `Sources/ClawdbotKit/Design/ClawdbotGlowEffects.swift`:

```swift
import SwiftUI

// MARK: - Glow Intensity

public enum GlowIntensity {
    case sm    // 8pt radius
    case md    // 16pt radius
    case lg    // 24pt radius
    case intense  // 40pt radius
}

// MARK: - Glow Effect Modifiers

public extension View {
    /// Purple glow effect
    func glowPurple(_ intensity: GlowIntensity = .md) -> some View {
        self.shadow(color: Color.clawdbotPurple.opacity(glowOpacity(intensity)), radius: glowRadius(intensity))
    }

    /// Cyan glow effect
    func glowCyan(_ intensity: GlowIntensity = .md) -> some View {
        self.shadow(color: Color.clawdbotCyan.opacity(glowOpacity(intensity)), radius: glowRadius(intensity))
    }

    /// Green glow effect
    func glowGreen(_ intensity: GlowIntensity = .md) -> some View {
        self.shadow(color: Color.clawdbotGreen.opacity(glowOpacity(intensity)), radius: glowRadius(intensity))
    }

    /// Amber glow effect
    func glowAmber(_ intensity: GlowIntensity = .md) -> some View {
        self.shadow(color: Color.clawdbotAmber.opacity(glowOpacity(intensity)), radius: glowRadius(intensity))
    }

    /// Red glow effect
    func glowRed(_ intensity: GlowIntensity = .md) -> some View {
        self.shadow(color: Color.clawdbotRed.opacity(glowOpacity(intensity)), radius: glowRadius(intensity))
    }

    /// Custom color glow effect
    func glow(color: Color, intensity: GlowIntensity = .md) -> some View {
        self.shadow(color: color.opacity(glowOpacity(intensity)), radius: glowRadius(intensity))
    }

    // MARK: - Helper Functions

    private func glowRadius(_ intensity: GlowIntensity) -> CGFloat {
        switch intensity {
        case .sm: return 8
        case .md: return 16
        case .lg: return 24
        case .intense: return 40
        }
    }

    private func glowOpacity(_ intensity: GlowIntensity) -> Double {
        switch intensity {
        case .sm: return 0.3
        case .md: return 0.4
        case .lg: return 0.5
        case .intense: return 0.5
        }
    }
}

// MARK: - Multi-Layer Glow

public extension View {
    /// Layered glow effect for intense prominence
    func glowLayered(color: Color = .clawdbotPurple) -> some View {
        self
            .shadow(color: color.opacity(0.3), radius: 8)
            .shadow(color: color.opacity(0.2), radius: 16)
            .shadow(color: color.opacity(0.1), radius: 24)
    }
}
```

**Commit after completion:** `feat(06.1-02): create ClawdbotGlowEffects with glow utilities`

### Task 5: Update ClawdbotColors with missing tokens

Modify `Sources/ClawdbotKit/Design/ClawdbotColors.swift`:

Add missing color tokens:

```swift
// Add to ClawdbotColors extension

/// Cyan accent color (info/cool accent)
public static let clawdbotCyan = Color(red: 6/255, green: 182/255, blue: 212/255)  // #06b6d4

/// Indigo color (gradient end)
public static let clawdbotIndigo = Color(red: 99/255, green: 102/255, blue: 241/255)  // #6366f1

/// Pink accent (optional highlights)
public static let clawdbotPink = Color(red: 236/255, green: 72/255, blue: 153/255)  // #ec4899

/// Coral accent (warm highlights)
public static let clawdbotCoral = Color(red: 251/255, green: 113/255, blue: 133/255)  // #fb7185
```

**Commit after completion:** `feat(06.1-02): add missing color tokens to ClawdbotColors`

### Task 6: Apply glass to MessageBubble

Modify `Sources/ClawdbotKit/Chat/MessageBubble.swift`:

Update bot message styling to use glass:

```swift
// In bubble background, for bot messages:
.background(
    Group {
        if isUserMessage {
            RoundedRectangle(cornerRadius: 16)
                .fill(Color.clawdbotPurple)
        } else {
            RoundedRectangle(cornerRadius: 16)
                .fill(Color.clawdbotSurface.opacity(0.6))
                .background(.ultraThinMaterial)
        }
    }
)
.overlay(
    Group {
        if !isUserMessage {
            RoundedRectangle(cornerRadius: 16)
                .stroke(Color.clawdbotBorder.opacity(0.3), lineWidth: 1)
        }
    }
)
```

**Commit after completion:** `feat(06.1-02): apply glass styling to MessageBubble`

### Task 7: Apply obsidian to ThinkingIndicator

Modify `Sources/ClawdbotKit/Chat/ThinkingIndicator.swift`:

Apply obsidian styling to the thinking indicator container:

```swift
// Update container styling
.padding(.horizontal, 16)
.padding(.vertical, 12)
.obsidianActive()  // Use active state for thinking
.clipShape(RoundedRectangle(cornerRadius: 16))
```

**Commit after completion:** `feat(06.1-02): apply obsidian styling to ThinkingIndicator`

### Task 8: Export glass components from Design module

Modify `Sources/ClawdbotKit/Design/Design.swift`:

```swift
// Add exports
@_exported import struct ClawdbotKit.GlassCard
@_exported import struct ClawdbotKit.OptaStatusBadge
@_exported import enum ClawdbotKit.GlassLevel
@_exported import enum ClawdbotKit.ObsidianState
@_exported import enum ClawdbotKit.GlowIntensity
```

**Commit after completion:** `feat(06.1-02): export glass components from Design module`

### Task 9: Add glass component tests

Create `Tests/ClawdbotKitTests/ClawdbotGlassTests.swift`:

Test cases:
1. GlassCard renders with correct level
2. Glass modifiers apply correct backgrounds
3. Obsidian states render correctly
4. OptaStatusBadge displays correct text
5. OptaStatusBadge.Compact renders indicator
6. Glow effects apply correct shadows
7. Status badge animations trigger

**Commit after completion:** `test(06.1-02): add glass component unit tests`

## Verification

```bash
cd apps/ios/ClawdbotKit
swift build
swift test --filter Glass
```

Expected: Build succeeds, all tests pass

## Success Criteria

- [ ] 3-level glass depth system working (.glassSubtle, .glassContent, .glassOverlay)
- [ ] Obsidian glass variants (.obsidian, .obsidianInteractive, .obsidianActive)
- [ ] OptaStatusBadge displays "OPTA INTELLIGENCE • ACTIVE"
- [ ] Glow effect utilities work (.glowPurple, .glowCyan, etc.)
- [ ] Missing color tokens added to ClawdbotColors
- [ ] MessageBubble uses glass styling for bot messages
- [ ] ThinkingIndicator uses obsidian styling
- [ ] 7+ glass component tests pass
- [ ] All existing 115+ tests still pass

## Output

Files created:
- `Sources/ClawdbotKit/Design/ClawdbotGlassModifiers.swift`
- `Sources/ClawdbotKit/Design/OptaStatusBadge.swift`
- `Sources/ClawdbotKit/Design/ClawdbotGlowEffects.swift`
- `Tests/ClawdbotKitTests/ClawdbotGlassTests.swift`

Files modified:
- `Sources/ClawdbotKit/Design/ClawdbotColors.swift`
- `Sources/ClawdbotKit/Chat/MessageBubble.swift`
- `Sources/ClawdbotKit/Chat/ThinkingIndicator.swift`
- `Sources/ClawdbotKit/Design/Design.swift`

---
*Phase: 06.1-aesthetic-alignment*
*Plan: 02 of 03*
*Wave: 1*
