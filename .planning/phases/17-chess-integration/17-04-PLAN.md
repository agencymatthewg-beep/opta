---
phase: 17-chess-integration
plan: 04
type: execute
wave: 4
depends_on: ["17-03"]
files_modified: [src/pages/Chess.tsx, src/App.tsx, src/components/Layout.tsx]
autonomous: false
---

<objective>
Integrate chess feature into Opta with ChessPage and navigation.

Purpose: Complete the chess feature by creating the main page with three-mode architecture and adding navigation.
Output: Fully functional chess page accessible from sidebar; visual verification of ambient chess experience.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
@~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/17-chess-integration/17-RESEARCH.md
@.planning/phases/17-chess-integration/17-03-SUMMARY.md
@DESIGN_SYSTEM.md

@src/components/chess/ChessBoard.tsx
@src/components/chess/GameControls.tsx
@src/components/chess/MoveHistory.tsx
@src/hooks/useChessGame.ts
@src/hooks/useStockfish.ts
@src/types/chess.ts
@src/App.tsx
@src/components/Layout.tsx
@src/pages/Games.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ChessPage with three-mode architecture</name>
  <files>src/pages/Chess.tsx</files>
  <action>
Create the main Chess page implementing the three-mode architecture from 17-RESEARCH.md. Follow patterns from existing pages (Games.tsx, Score.tsx).

**Three Modes (from research):**

1. **Casual Mode** (default, ambient):
   - Play against AI with adjustable difficulty
   - No time pressure
   - Undo available
   - "Take your time" messaging
   - Game auto-saves to localStorage

2. **Puzzle Mode** (placeholder for v2.1):
   - Show "Coming soon" with explanation
   - Will integrate Lichess puzzle API

3. **Analysis Mode** (placeholder for v2.1):
   - Show "Coming soon" with explanation
   - Will add Stockfish evaluation bar

**Page Layout:**
```
┌─────────────────────────────────────────┐
│  Mode Tabs: [Casual] [Puzzles] [Analysis]│
├─────────────────────────────────────────┤
│                                         │
│  ┌───────────┐  ┌───────────────────┐   │
│  │           │  │  Game Controls    │   │
│  │  Chess    │  │  (difficulty,     │   │
│  │  Board    │  │   new game, etc)  │   │
│  │           │  ├───────────────────┤   │
│  │           │  │  Move History     │   │
│  └───────────┘  └───────────────────┘   │
│                                         │
│  [Game Status / Result Banner]          │
└─────────────────────────────────────────┘
```

Implementation:
1. State: mode, chessSettings (from types), gameResult
2. useChessGame hook for game logic
3. useStockfish hook for AI opponent
4. Mode tabs using button group (existing pattern or custom)
5. Main layout: board left, controls+history right
6. Responsive: stack vertically on mobile
7. Game flow:
   - Player makes move via ChessBoard
   - If player's move valid, trigger AI move
   - Show "AI thinking..." during calculation
   - AI move animated on board
   - Check for game over after each move
8. Game over: show result banner with option to play again
9. LocalStorage persistence:
   - Save current game FEN
   - Save settings (difficulty, etc)
   - Restore on mount

**Ambient UX (from research):**
- No visible win/loss counter
- Soft colors and subtle animations
- "Take your time" gentle prompts after 30s inactivity
- No aggressive notifications

Framer Motion for mode transitions and result banner.
  </action>
  <verify>Page renders without errors; can start a new game and make moves</verify>
  <done>ChessPage renders with working Casual mode, AI opponent responds to moves</done>
</task>

<task type="auto">
  <name>Task 2: Add Chess navigation to App</name>
  <files>src/App.tsx, src/components/Layout.tsx</files>
  <action>
Add Chess page to app navigation and routing.

1. **Update Layout.tsx sidebar:**
   - Add Chess navigation item with Lucide icon (use Swords or Crown icon)
   - Position after Games in nav order
   - Follow existing nav item pattern

2. **Update App.tsx routing:**
   - Import Chess page (lazy load like other pages)
   - Add 'chess' case to page routing
   - Update PageType if exists

3. **Nav item styling:**
   - Same pattern as other nav items
   - Active state with border-l-2 border-primary

Order in sidebar:
1. Dashboard
2. Optimize
3. Games
4. **Chess** (new)
5. Score
6. Settings
  </action>
  <verify>Chess appears in sidebar; clicking navigates to Chess page</verify>
  <done>Chess page accessible from sidebar navigation</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete ambient chess experience with AI opponent</what-built>
  <how-to-verify>
    1. Run: npm run tauri dev
    2. Navigate to Chess in sidebar
    3. Verify board loads with starting position
    4. Make a move (e.g., e2-e4) by dragging
    5. Verify AI responds with a move (wait for "thinking" indicator)
    6. Test difficulty selector - change to Beginner
    7. Play a few moves - AI should make occasional mistakes at low levels
    8. Test Undo button - should revert last move pair
    9. Test New Game - should reset board
    10. Verify glass styling matches Opta aesthetic
    11. Verify no UI freezing during AI thinking
    12. Check mobile responsive layout (resize window)
    13. Verify Puzzles and Analysis tabs show "Coming soon"
  </how-to-verify>
  <resume-signal>Type "approved" if chess feature works correctly, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] Chess page renders with board and controls
- [ ] AI opponent responds to player moves
- [ ] Difficulty selector affects AI strength
- [ ] Navigation works from sidebar
- [ ] Glass styling consistent with Opta design
- [ ] No main thread blocking during AI thinking
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Human verification approved
- Ambient chess experience feels relaxed and polished
</success_criteria>

<output>
After completion, create `.planning/phases/17-chess-integration/17-04-SUMMARY.md`
</output>
